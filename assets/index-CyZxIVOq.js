var Kt=h=>{throw TypeError(h)};var kt=(h,t,e)=>t.has(h)||Kt("Cannot "+e);var o=(h,t,e)=>(kt(h,t,"read from private field"),e?e.call(h):t.get(h)),u=(h,t,e)=>t.has(h)?Kt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e),l=(h,t,e,n)=>(kt(h,t,"write to private field"),n?n.call(h,e):t.set(h,e),e),E=(h,t,e)=>(kt(h,t,"access private method"),e);var Yt=(h,t,e,n)=>({set _(i){l(h,t,i,e)},get _(){return o(h,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const qt={GAME_WIDTH:244,GAME_HEIGHT:192,SELECTED_PARTICLE:10,SELECTED_CATEGORY:1,BRUSH_MAX_SIZE:42,BRUSH_CUR_SIZE:4,BRUSH_SENSITIVITY:.02,CURRENT_PRESSURE:0,CURRENT_CONCENTRATION:1,DEBUG_START_ENABLED:!0,DEBUG_OVERLAY_START_ENABLED:!1,RENDER_UPDATE_INTERVAL:16.667,PHYSICS_UPDATE_INTERVAL:25},jt={lerp(h,t,e){return h+(t-h)*e},shuffleArray(h){const t=[...h];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t},calculateRepose(h){let t=Math.max(10,Math.min(h,80));const e=t*Math.PI/180;let n=[];if(n.push([{dx:0,dy:-1}]),t<50){n.push([{dx:1,dy:-1},{dx:-1,dy:-1}]);const i=Math.round(1/Math.tan(e));n.push([{dx:i,dy:-1},{dx:i*-1,dy:-1}])}else{const i=Math.round(Math.tan(e));n.push([{dx:1,dy:-i},{dx:-1,dy:-i}])}return n}};async function fe(h){try{const t=await fetch(h);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return await t.text()}catch(t){throw console.error(`Failed to read particle data from ${h}:`,t),new Error("Failed to load particle data.")}}async function me(h){const t=await fe(h);let e={},n=new Set,i=null;for(const a of t.split(`
`)){const r=a.trim();if(!(r.length===0||r.startsWith("#"))){if(r.startsWith("[")&&r.endsWith("]")){const d=r.slice(1,-1),c=parseInt(d,10);if(isNaN(c)||c<10){i=null;continue}if(n.has(c)){console.warn(`[Loader] Duplicate ID found: ${c}. Ignoring.`),i=null;continue}n.add(c),i=c,e[c]={};continue}if(i!==null){const d=r.split(":").map(c=>c.trim());if(d.length===2){const c=d[0],p=d[1],f=e[i];switch(c){case"name":f.name=p;break;case"category":f.category=parseInt(p,10);break;case"base_color":f.base_color=p;break;case"variant_color":f.variant_color=p;break;case"is_movable":f.is_movable=p==="true";break;case"density":f.density=parseFloat(p);break;case"max_concentration":f.max_concentration=parseInt(p);break;case"repose_angle":f.repose_angle=parseFloat(p);break}}}}}const s={};for(const a in e){const r=e[a],d=parseInt(a,10);if(r.name===void 0||r.category===void 0||r.base_color===void 0||r.variant_color===void 0||r.is_movable===void 0||r.density===void 0){console.warn(`[Loader] Corrupted particle block found of ID: ${d}. Missing core properties.`);continue}let c={id:d,name:r.name,baseColor:r.base_color,variantColor:r.variant_color,isMovable:r.is_movable,density:r.density};r.category===1?s[d]={...c,category:1}:r.category===2?s[d]={...c,maxConcentration:r.max_concentration,category:2}:r.category===3?s[d]={...c,category:3}:r.category===4?s[d]={...c,category:4,reposeAngle:r.repose_angle,reposeDirections:jt.calculateRepose(r.repose_angle)}:r.category===5&&(s[d]={...c,category:5})}return s[0]={id:0,name:"Empty",category:0,baseColor:"#0E0E11",variantColor:"#0E0E11",isMovable:!0,density:0},s}var Y,q,U,G,F,tt,$,Q,Jt,te,ee;class ge{constructor(t,e){u(this,Q);u(this,Y);u(this,q);u(this,U);u(this,G);u(this,F);u(this,tt);u(this,$);l(this,Y,t),l(this,q,o(this,Y).getContext("2d")),l(this,U,e.GAME_WIDTH),l(this,G,e.GAME_HEIGHT),l(this,F,new Uint8ClampedArray(o(this,U)*o(this,G)*4)),l(this,tt,[]),l(this,$,new Map),o(this,Y).width=o(this,U),o(this,Y).height=o(this,G),o(this,q).imageSmoothingEnabled=!1,o(this,q).translate(0,o(this,Y).height),o(this,q).scale(1,-1)}queueParticles(t,e){if(o(this,tt).push(...t),e){const n=o(this,U),i=o(this,G);for(const s of t){const r=(i-1-s.position.y)*n+s.position.x;o(this,$).set(r,e)}}}queueOverlayPixels(t){for(const e of t)o(this,$).set(e.index,e.value)}renderThisFrame(){E(this,Q,Jt).call(this);let t=new Uint8ClampedArray(o(this,F));E(this,Q,ee).call(this,t);const e=new ImageData(t,o(this,U),o(this,G));o(this,q).putImageData(e,0,0),o(this,tt).length=0,o(this,$).clear()}}Y=new WeakMap,q=new WeakMap,U=new WeakMap,G=new WeakMap,F=new WeakMap,tt=new WeakMap,$=new WeakMap,Q=new WeakSet,Jt=function(){const t=o(this,tt),e=o(this,U),n=o(this,G);for(const i of t){const s=i.position.x,a=i.position.y,d=(n-1-a)*e+s;let c=E(this,Q,te).call(this,i);o(this,F)[d*4+0]=c[0],o(this,F)[d*4+1]=c[1],o(this,F)[d*4+2]=c[2],o(this,F)[d*4+3]=c[3]}},te=function(t){return t.color},ee=function(t){const e=o(this,$);if(e.size!==0)for(const[n,i]of e){const s=t[n*4+0],a=t[n*4+1],r=t[n*4+2],d=t[n*4+3],c=i[0],p=i[1],f=i[2],m=i[3],y=m/255,g=Math.round(c*y+s*(1-y)),C=Math.round(p*y+a*(1-y)),I=Math.round(f*y+r*(1-y)),A=Math.min(d,m);t[n*4+0]=g,t[n*4+1]=C,t[n*4+2]=I,t[n*4+3]=A}};const Zt=Object.freeze({WHITE:new Uint8ClampedArray([255,255,255,255]),BLACK:new Uint8ClampedArray([0,0,0,255]),GRAY:new Uint8ClampedArray([128,128,128,255]),RED:new Uint8ClampedArray([255,0,0,255]),GREEN:new Uint8ClampedArray([0,255,0,255]),BLUE:new Uint8ClampedArray([0,0,255,255]),YELLOW:new Uint8ClampedArray([255,255,0,255]),CYAN:new Uint8ClampedArray([0,255,255,255]),MAGENTA:new Uint8ClampedArray([255,0,255,255]),TRANSPARENT_BLACK:new Uint8ClampedArray([0,0,0,0]),SEMI_TRANSPARENT_WHITE:new Uint8ClampedArray([255,255,255,128])}),lt={createColor(h){return this.hexToColor(h)},hexToColor(h){if(h==null)return Zt.BLACK;let t=h.replace("#","");if(t.length===6)t+="FF";else if(t.length===3){let n="";for(const i of t)n+=i,n+=i;t=n+"FF"}else return Zt.BLACK;const e=parseInt(t,16);return new Uint8ClampedArray([e>>24&255,e>>16&255,e>>8&255,e&255])},colorToHex(h){const[t,e,n,i]=h,s=a=>a.toString(16).padStart(2,"0");return`#${s(t)}${s(e)}${s(n)}${s(i)}`},lerpColor(h,t,e){const n=h[0]+(t[0]-h[0])*e,i=h[1]+(t[1]-h[1])*e,s=h[2]+(t[2]-h[2])*e,a=h[3]+(t[3]-h[3])*e;return new Uint8ClampedArray([n,i,s,a])},createColorRamp(h,t,e){if(e<2)return[h,t];const n=1/(e-1),i=new Array(e);for(let s=0;s<e;s++){const a=s*n;i[s]=this.lerpColor(h,t,a)}return i},invertColor(h){const t=255-h[0],e=255-h[1],n=255-h[2],i=h[3];return new Uint8ClampedArray([t,e,n,i])},getLuminance(h){const t=h[0],e=h[1],n=h[2];return .299*t+.587*e+.114*n}},ye=Object.freeze({ALL_NEIGHBORS:[{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}]}),Tt=Object.freeze({UP_LEFT:{dx:-1,dy:1},UP:{dx:0,dy:1},UP_RIGHT:{dx:1,dy:1},LEFT:{dx:-1,dy:0},RIGHT:{dx:1,dy:0},DOWN_LEFT:{dx:-1,dy:-1},DOWN:{dx:0,dy:-1},DOWN_RIGHT:{dx:1,dy:-1}});var P,z,at,$t,ie;class Ee{constructor(t,e,n){u(this,at);u(this,P);u(this,z);this.width=t,this.height=e,l(this,P,new Array(t*e)),l(this,z,new Set),this.ParticleDataBlueprint=n,E(this,at,ie).call(this,0)}get data(){return o(this,P)}get dirtyParticles(){return o(this,z)}createParticleAt(t,e,n,i,s){if(!this.isInBounds(t,e))return!1;let a=E(this,at,$t).call(this,n);return a.position.x=t,a.position.y=e,a.index=e*this.width+t,i&&this.markDirty(a,s),o(this,P)[e*this.width+t]=a,!0}getParticleAt(t,e){return this.isInBounds(t,e)?o(this,P)[e*this.width+t]:null}tryMoveParticle(t,e,n=!1,i=!1,s=!1){for(const a of e){if(!a)continue;const r=jt.shuffleArray(a);for(const d of r){let c=d.dx;n&&Math.random()>.5&&(c=d.dx*-1);const p=t.position.x+c,f=t.position.y+d.dy,m=this.getParticleAt(p,f);if(m&&m.isMovable&&t.density>m.density){o(this,P)[m.index]=t,o(this,P)[t.index]=m;const y={x:t.position.x,y:t.position.y},g=t.index;return t.position=m.position,t.index=m.index,m.position=y,m.index=g,i&&(this.markDirty(t,s),this.markDirty(m,s)),m}}}return null}swapParticles(t,e,n,i){o(this,P)[t.index]=e,o(this,P)[e.index]=t;const s={x:t.position.x,y:t.position.y},a=t.index;t.position=e.position,t.index=e.index,e.position=s,e.index=a,n&&(this.markDirty(t,i),this.markDirty(e,i))}getNeighborOf(t,e){const n=t.position.x+e.dx,i=t.position.y+e.dy;return this.getParticleAt(n,i)}getNeighborsOf(t,e,n,i){return e.map(a=>this.getNeighborOf(t,a)).filter(a=>a!==null).filter(a=>{const r=n===void 0||a.category===n,d=i===void 0||a.id===i;return r&&d})}markDirty(t,e){if(o(this,z).add(t.index),e){const n=this.getNeighborsOf(t,ye.ALL_NEIGHBORS);for(const i of n)o(this,z).add(i.index)}}isInBounds(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}fillCircleAt(t,e,n,i){for(let s=-n;s<=n;s++)for(let a=-n;a<=n;a++){if(s*s+a*a>n*n)continue;const r=t+s,d=e+a;if(!this.isInBounds(r,d))continue;const c=this.getParticleAt(r,d);(i===0||c===null||c.id===0)&&this.createParticleAt(r,d,i,!0,!0)}}}P=new WeakMap,z=new WeakMap,at=new WeakSet,$t=function(t){const e=this.ParticleDataBlueprint[t];if(!e)return null;let i=Math.random(),a=6-1,r=Math.round(i*a)/a;const d=lt.hexToColor(e.baseColor),c=lt.hexToColor(e.variantColor),p=lt.lerpColor(d,c,r);let f={handle:-1,id:e.id,name:e.name,color:p,position:{x:-1,y:-1},index:0,isMovable:e.isMovable,density:e.density};return e.category===0?{...f,category:0}:e.category===1?{...f,category:1}:e.category===2?{...f,category:2,concentration:0,maxConcentration:e.maxConcentration}:e.category===3?{...f,category:3}:e.category===4?{...f,category:4,reposeAngle:e.reposeAngle,reposeDirections:e.reposeDirections}:e.category===5?{...f,category:5,node:-1}:null},ie=function(t){const e=this.width,n=this.height;l(this,P,new Array(e*n));for(let i=0;i<n;i++)for(let s=0;s<e;s++){let a=i*e+s,r=E(this,at,$t).call(this,t);r&&(r.position.x=s,r.position.y=i,r.index=a,o(this,P)[a]=r,o(this,z).add(r.index))}};const Qt=Object.keys(Tt);var et,xt,ht,_t,Ct,b,v,X,W,Dt,ut,V,j,pt,St,ft,S,ne,se,oe,ae,re;class we{constructor(t,e,n,i,s){u(this,S);u(this,et);u(this,xt);u(this,ht);u(this,_t);u(this,Ct);u(this,b);u(this,v);u(this,X);u(this,W);u(this,Dt);u(this,ut);u(this,V);u(this,j);u(this,pt,0);u(this,St,60);u(this,ft,t=>{if(!o(this,X))return;if(!o(this,V)){l(this,V,t),l(this,W,requestAnimationFrame(o(this,ft)));return}const e=t-o(this,V);l(this,V,t),o(this,xt).processInput(o(this,b),o(this,et)),l(this,j,o(this,j)+e);let n=0;for(;o(this,j)>=o(this,ut);){const i=[];for(const a of o(this,b).dirtyParticles)i.push(o(this,b).data[a]);Yt(this,pt)._++,o(this,pt)>o(this,St)&&(o(this,b).dirtyParticles.clear(),l(this,pt,0));const s=new Uint8ClampedArray([210,55,55,180]);o(this,et).queueParticles(i,o(this,ht).isOverlayEnabled?s:void 0),E(this,S,ne).call(this,i),this.tickCount++,l(this,j,o(this,j)-o(this,ut)),n++,n>60&&l(this,j,0)}o(this,et).renderThisFrame(),o(this,ht).updateDisplay(t,this),l(this,W,requestAnimationFrame(o(this,ft)))});l(this,et,n),l(this,xt,i),l(this,ht,s),l(this,_t,e.GAME_WIDTH),l(this,Ct,e.GAME_HEIGHT),l(this,b,new Ee(o(this,_t),o(this,Ct),t)),l(this,v,new Set),l(this,X,!1),l(this,W,null),l(this,Dt,qt.RENDER_UPDATE_INTERVAL),l(this,ut,qt.PHYSICS_UPDATE_INTERVAL),l(this,V,null),l(this,j,0),this.tickCount=0}start(){o(this,X)||(l(this,X,!0),o(this,ft).call(this,0))}stop(){l(this,X,!1),o(this,W)&&(cancelAnimationFrame(o(this,W)),l(this,W,null))}groupParticles(t,e){const n=t.width,i=t.height,s=[],a=[],r={};for(let c=i-1;c>=0;c--)for(let p=0;p<n;p++){const f=c*n+p,m=t.getParticleAt(p,c);if(!m||m.category!==e||m.category!==e)continue;const y=t.getNeighborOf(m,Tt.UP),g=t.getNeighborOf(m,Tt.LEFT),C=y&&y.id===m.id,I=g&&g.id===m.id;let A=-1;I&&(A=c*n+(p-1));let rt=-1;C&&(rt=(c+1)*n+p);const J=y&&y.id===0;if(!I&&!C){const w=a.length;s.push([f]),a.push({liquidParticle:[],emptyParticle:[]}),J&&(a[w].liquidParticle.push(m),a[w].emptyParticle.push(y)),r[f]=w}else if(I&&!C){const w=r[A];s[w].push(f),J&&(a[w].liquidParticle.push(m),a[w].emptyParticle.push(y)),r[f]=w}else if(!I&&C){const w=r[rt];s[w].push(f),J&&(a[w].liquidParticle.push(m),a[w].emptyParticle.push(y)),r[f]=w}else{const w=r[rt];s[w].push(f),J&&(a[w].liquidParticle.push(m),a[w].emptyParticle.push(y)),r[f]=w;const O=r[A];if(O!==w){const dt=a[O];for(const H of dt.liquidParticle)a[w].liquidParticle.push(H);for(const H of dt.emptyParticle)a[w].emptyParticle.push(H);const wt=s[O];for(const H of wt)r[H]=w;s[O]=[],a[O]={liquidParticle:[],emptyParticle:[]}}}}return a.filter(c=>c.liquidParticle.length>30)}}et=new WeakMap,xt=new WeakMap,ht=new WeakMap,_t=new WeakMap,Ct=new WeakMap,b=new WeakMap,v=new WeakMap,X=new WeakMap,W=new WeakMap,Dt=new WeakMap,ut=new WeakMap,V=new WeakMap,j=new WeakMap,pt=new WeakMap,St=new WeakMap,ft=new WeakMap,S=new WeakSet,ne=function(t){o(this,v).clear(),t=jt.shuffleArray(t),t.sort((n,i)=>n.position.y-i.position.y);for(const n of t)if(n&&!o(this,v).has(n.index))switch(n.category){case 1:break;case 2:E(this,S,se).call(this,n);break;case 3:E(this,S,oe).call(this,n);break;case 4:E(this,S,ae).call(this,n);break;case 5:break;default:continue}let e=this.groupParticles(o(this,b),2);E(this,S,re).call(this,e)},se=function(t){let e=[[{dx:0,dy:-1}],[{dx:-1,dy:-1},{dx:1,dy:-1}],[{dx:-1,dy:0},{dx:1,dy:0}]];const n=o(this,b).tryMoveParticle(t,e,!1,!0,!0);n&&(o(this,v).add(t.index),o(this,v).add(n.index))},oe=function(t){const e=Qt[Math.floor(Math.random()*Qt.length)];let i=[[Tt[e]]];const s=o(this,b).tryMoveParticle(t,i,!1,!0,!0);s&&(o(this,v).add(t.index),o(this,v).add(s.index))},ae=function(t){let e=t.reposeDirections;const n=o(this,b).tryMoveParticle(t,e,!0,!0,!0);n&&(o(this,v).add(t.index),o(this,v).add(n.index))},re=function(t){for(const e of t){const n=e.liquidParticle.sort((d,c)=>c.position.y-d.position.y),i=e.emptyParticle.sort((d,c)=>d.position.y-c.position.y),s=n.length;let a=0;const r=s/4;for(let d=0;d<s;d++){const c=n[d],p=i[d];if(Math.sqrt(c.position.x*p.position.x+c.position.y*p.position.y),c.position.y>p.position.y&&(o(this,b).swapParticles(c,p,!0,!0),o(this,v).add(c.index),o(this,v).add(p.index),a++,a>=r))break}}};var Mt,K,it,vt,L,Z,Pt,bt,k,T,D,At,Rt,R,_,M,x,de,zt,Xt,ce,ct,le,he,Bt,Ot,Ht,Lt,It,Nt,Ut,Gt,Ft,Wt;class xe{constructor(t,e,n,i,s){u(this,x);u(this,Mt);u(this,K);u(this,it);u(this,vt);u(this,L);u(this,Z);u(this,Pt);u(this,bt);u(this,k);u(this,T);u(this,D);u(this,At);u(this,Rt);u(this,R);u(this,_);u(this,M);u(this,Bt,t=>{l(this,M,t.pointerId),t.button===0?(this.isPainting=!0,this.isErasing=!1,this.activeButton="left"):t.button===2?(this.isErasing=!0,this.isPainting=!1,this.activeButton="right"):(this.isPainting=!1,this.isErasing=!1,this.activeButton="none");try{o(this,L).setPointerCapture(t.pointerId)}catch{}const e=o(this,L).getBoundingClientRect(),n=o(this,K)/e.width,i=o(this,it)/e.height;this.latestMouseCoords.x=(t.clientX-e.left)*n,this.latestMouseCoords.y=o(this,L).height-(t.clientY-e.top)*i});u(this,Ot,t=>{if(o(this,M)===t.pointerId){l(this,M,null),this.activeButton="none";try{o(this,L).releasePointerCapture(t.pointerId)}catch{}}this.isPainting=!1,this.isErasing=!1});u(this,Ht,t=>{const e=o(this,L).getBoundingClientRect(),n=o(this,K)/e.width,i=o(this,L).height/e.height;if(this.latestMouseCoords.x=(t.clientX-e.left)*n,this.latestMouseCoords.y=o(this,L).height-(t.clientY-e.top)*i,typeof t.buttons=="number"){const s=(t.buttons&1)===1,a=(t.buttons&2)===2;this.isPainting=s,this.isErasing=a}});u(this,Lt,t=>{if(this.isPainting=!1,this.isErasing=!1,o(this,M)===t.pointerId){try{o(this,L).releasePointerCapture(t.pointerId)}catch{}l(this,M,null),this.activeButton="none"}});u(this,It,()=>{this.isPainting=!1,this.isErasing=!1,l(this,M,null),this.activeButton="none"});u(this,Nt,()=>{document.hidden&&(this.isPainting=!1,this.isErasing=!1,l(this,M,null),this.activeButton="none")});u(this,Ut,t=>{t.preventDefault(),this.shouldChangeBrushSize=!0,this.changeBrushSizeDir=t.deltaY});u(this,Gt,t=>{t.preventDefault()});u(this,Ft,t=>{this.isDrawingOverlay=!0});u(this,Wt,t=>{this.isDrawingOverlay=!1});l(this,Mt,s),l(this,K,i.GAME_WIDTH),l(this,it,i.GAME_HEIGHT),l(this,vt,e),l(this,L,n),l(this,Z,t),l(this,Pt,i.BRUSH_SENSITIVITY),l(this,bt,i.BRUSH_MAX_SIZE),l(this,k,i.SELECTED_PARTICLE),l(this,T,i.SELECTED_CATEGORY),l(this,D,i.BRUSH_CUR_SIZE),l(this,At,i.CURRENT_PRESSURE),l(this,Rt,i.CURRENT_CONCENTRATION),l(this,R,null),l(this,_,null),l(this,M,null),this.isPainting=!1,this.isErasing=!1,this.isDrawingOverlay=!0,this.shouldChangeBrushSize=!1,this.changeBrushSizeDir=0,this.latestMouseCoords={x:0,y:0},this.activeButton="none";const a=document.getElementById("particle-category-bar");if(!a)throw new Error("DOM element of id 'particle-category-bar' does not exist.");E(this,x,ce).call(this,a);const r=document.getElementById("particle-button-container");if(!r)throw new Error("DOM element of id 'particle-button-container' does not exist.");E(this,x,le).call(this,r),E(this,x,he).call(this),o(this,_)&&E(this,x,zt).call(this,o(this,_))}processInput(t,e){const n=this.latestMouseCoords.x,i=this.latestMouseCoords.y,s={x:Math.floor(n),y:Math.floor(i)};if(this.isDrawingOverlay){const a=E(this,x,de).call(this,s.x,s.y);e.queueOverlayPixels(a)}if(this.isPainting||this.isErasing){const a=s.x<o(this,K)+o(this,D)&&s.x>=0-o(this,D),r=s.y<o(this,it)+o(this,D)&&s.y>=0-o(this,D);if(a&&r){const d=s.x,c=s.y,p=this.isPainting?o(this,k):0;t.fillCircleAt(d,c-1,o(this,D),p)}}if(this.shouldChangeBrushSize){const a=this.changeBrushSizeDir*o(this,Pt);let r=o(this,D)-a;r=Math.floor(r),r=Math.min(o(this,bt),r),r=Math.max(0,r),l(this,D,r),this.changeBrushSizeDir=0}}}Mt=new WeakMap,K=new WeakMap,it=new WeakMap,vt=new WeakMap,L=new WeakMap,Z=new WeakMap,Pt=new WeakMap,bt=new WeakMap,k=new WeakMap,T=new WeakMap,D=new WeakMap,At=new WeakMap,Rt=new WeakMap,R=new WeakMap,_=new WeakMap,M=new WeakMap,x=new WeakSet,de=function(t,e){const n=o(this,D),i=[],s=227,a=227,r=227,d=180,c=o(this,K),p=o(this,it),f=[-1,1],m=(I,A)=>{for(const rt of f)for(const J of f){const w=t+I*J,O=e+A*rt,dt=t+A*J,wt=e+I*rt;if(w>=0&&w<c&&O>=0&&O<p){const H=(p-O)*c+w;i.push({index:H,value:new Uint8ClampedArray([s,a,r,d])})}if(dt>=0&&dt<c&&wt>=0&&wt<p){const H=(p-wt)*c+dt;i.push({index:H,value:new Uint8ClampedArray([s,a,r,d])})}}};let y=n,g=0,C=n-n;for(m(y,g);g<y;)g++,C<0?C+=2*g+1:(y--,C+=2*(g-y)+1),m(y,g);return i},zt=function(t){o(this,_)&&o(this,_).classList.remove("selected"),t.classList.add("selected"),l(this,_,t);const e=parseInt(t.dataset.categoryId);l(this,T,e||1);let n=null;if(o(this,Z)[o(this,k)]!==void 0){const i=o(this,Z)[o(this,k)];i&&i.category===o(this,T)&&o(this,R)&&(n=o(this,R))}document.querySelectorAll(".particle-button").forEach(i=>{const s=i,a=s.dataset.category;a&&parseInt(a)===o(this,T)?(s.style.display="",n||(n=s)):s.style.display="none"}),E(this,x,Xt).call(this,n)},Xt=function(t){if(!t)return;o(this,R)&&o(this,R).classList.remove("selected"),t.classList.add("selected"),l(this,R,t);const e=parseInt(t.dataset.particleId);l(this,k,e||0)},ce=function(t){t.innerHTML="";let e=E(this,x,ct).call(this,1,"Solids","./assets/icons/solid.svg");t.appendChild(e),o(this,T)==1&&l(this,_,e);let n=E(this,x,ct).call(this,2,"Liquids","./assets/icons/liquid.svg");t.appendChild(n),o(this,T)==2&&l(this,_,n);let i=E(this,x,ct).call(this,3,"Gases","./assets/icons/gas.svg");t.appendChild(i),o(this,T)==3&&l(this,_,i);let s=E(this,x,ct).call(this,4,"Sands","./assets/icons/sand.svg");t.appendChild(s),o(this,T)==4&&l(this,_,s);let a=E(this,x,ct).call(this,5,"Electronics","./assets/icons/electronics.svg");t.appendChild(a),o(this,T)==5&&l(this,_,a),o(this,_)||l(this,_,s)},ct=function(t,e,n){const i=document.createElement("button");i.className="category-button";const s=document.createElement("img");return s.src=n,s.alt=e,s.classList.add("category-icon"),i.dataset.categoryId=t.toString(),i.appendChild(s),i},le=function(t){t.innerHTML="";for(const e in o(this,Z)){const n=o(this,Z)[e];if(!n)continue;const i=document.createElement("button");i.className="particle-button",i.textContent=n.name;const s=n.baseColor,a=n.variantColor,d=lt.getLuminance(lt.hexToColor(s))>210?"#323238":"#FFFFFFFF",c=lt.hexToColor(d);i.style.setProperty("--particle-button-base-color",s),i.style.setProperty("--particle-button-variant-color",a),i.style.color=d,i.style.textShadow=`1px 1px 2px rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.6)`,i.dataset.particleId=n.id.toString(),i.dataset.category=n.category.toString(),t.appendChild(i),n.id===o(this,k)&&l(this,R,i)}},he=function(){const t=o(this,L),e=document.getElementById("particle-category-bar"),n=document.getElementById("particle-button-container");if(!e||!n)throw new Error("Cannot find category bar and/ or button container");t.addEventListener("pointerdown",o(this,Bt)),t.addEventListener("pointermove",o(this,Ht)),t.addEventListener("pointerup",o(this,Ot)),t.addEventListener("pointercancel",o(this,Lt)),t.addEventListener("lostpointercapture",o(this,Lt)),t.addEventListener("pointerenter",o(this,Ft)),t.addEventListener("pointerleave",o(this,Wt)),t.addEventListener("wheel",o(this,Ut),{passive:!1}),o(this,vt).addEventListener("contextmenu",o(this,Gt)),window.addEventListener("pointerup",o(this,It)),window.addEventListener("mouseup",o(this,It)),document.addEventListener("visibilitychange",o(this,Nt)),e.addEventListener("click",i=>{if(!i.target)return;const a=i.target.closest(".category-button");a&&a&&E(this,x,zt).call(this,a)}),n.addEventListener("click",i=>{if(!i.target)return;const a=i.target.closest(".particle-button");a&&E(this,x,Xt).call(this,a)})},Bt=new WeakMap,Ot=new WeakMap,Ht=new WeakMap,Lt=new WeakMap,It=new WeakMap,Nt=new WeakMap,Ut=new WeakMap,Gt=new WeakMap,Ft=new WeakMap,Wt=new WeakMap;var nt,st,B,ot,mt,gt,yt,Et,ue,pe;class _e{constructor(t){u(this,Et);u(this,nt);u(this,st);u(this,B);u(this,ot);u(this,mt);u(this,gt);u(this,yt);l(this,nt,!1),l(this,st,!1),l(this,B,new Map),l(this,ot,0),l(this,mt,0),l(this,gt,0),l(this,yt,0),E(this,Et,pe).call(this,t)}get isOverlayEnabled(){return o(this,st)}enableDebug(t){l(this,nt,!0),t&&l(this,st,!0)}disableDebug(){l(this,nt,!1),l(this,st,!1)}updateDisplay(t,e){if(!o(this,nt))return;E(this,Et,ue).call(this,t,e);const n=o(this,B).get("fps");n&&(n.textContent=`FPS: ${o(this,mt).toFixed(2)}`);const i=o(this,B).get("tps");i&&(i.textContent=`TPS: ${o(this,gt).toFixed(2)}`)}}nt=new WeakMap,st=new WeakMap,B=new WeakMap,ot=new WeakMap,mt=new WeakMap,gt=new WeakMap,yt=new WeakMap,Et=new WeakSet,ue=function(t,e){const n=t-o(this,yt);n>=1e3&&(l(this,mt,o(this,ot)*1e3/n),l(this,gt,e.tickCount*1e3/n),l(this,ot,0),e.tickCount=0,l(this,yt,t)),Yt(this,ot)._++},pe=function(t){const e=document.createElement("div");e.classList.add("debug-container"),t.appendChild(e),o(this,B).set("debug-container",e);const n=document.createElement("div");n.classList.add("debug-info-container"),e.appendChild(n),o(this,B).set("info-container",n);const i=document.createElement("div");i.classList.add("debug-info"),n.appendChild(i),o(this,B).set("fps",i);const s=document.createElement("div");s.classList.add("debug-info"),n.appendChild(s),o(this,B).set("tps",s)};const N=class N{constructor(t,e,n,i,s){this._onFocus=()=>{this._isFocused||(N.currentZIndex++,this._window.style.zIndex=N.currentZIndex.toString())},this._onPointerDown=a=>{if(a.stopPropagation(),this._onFocus(),a.button===0){this._titlebar.setPointerCapture(a.pointerId);const r=this._window.getBoundingClientRect();this._dragOffset.x=a.clientX-r.left,this._dragOffset.y=a.clientY-r.top,this._isDragging=!0}else this._isDragging=!1},this._onPointerUp=a=>{this._isDragging&&(this._titlebar.releasePointerCapture(a.pointerId),this._isDragging=!1)},this._onPointerMove=a=>{if(this._isDragging){const r=a.clientX-this._dragOffset.x,d=a.clientY-this._dragOffset.y;this._moveWindow(r,d)}},this._onCloseButtonClick=a=>{this._closeWindow()},this._onViewportResize=()=>{this._snapWindowBacc()},this._stopDragPropagation=a=>{a.stopPropagation()},this._handleGlobalClick=a=>{document.querySelectorAll(".dropdown-list.is-open").forEach(r=>{const d=r.closest(".custom-dropdown-container");d&&!d.contains(a.target)&&r.classList.remove("is-open")})},this.hostElement=t,i.x=Math.max(40,Math.min(i.x,s.x)),i.y=Math.max(40,Math.min(i.y,s.y)),this._size=i,this._maxSize=s,this._isFocused=!1,this._isDragging=!1,this._dragOffset={x:0,y:0},this._initWindow(e,n),this._addEventListener(),this._onFocus(),document.addEventListener("click",this._handleGlobalClick)}destroy(){this._closeWindow(),document.removeEventListener("click",this._handleGlobalClick)}_initWindow(t,e){const n=document.createElement("div");n.classList.add("ui-window"),this.hostElement.appendChild(n),this._window=n,this._window.style.width=`${this._size.x}px`,this._window.style.height=`${this._size.y}px`,this._window.style.maxWidth=`${this._maxSize.x}px`,this._window.style.maxHeight=`${this._maxSize.y}px`;const i=document.createElement("div");i.classList.add("ui-window__titlebar"),this._window.appendChild(i),this._titlebar=i;const s=document.createElement("span");s.classList.add("ui-window__title"),s.textContent=t,i.appendChild(s);const a=document.createElement("div");a.classList.add("ui-window__controls"),this._titlebar.appendChild(a);const r=document.createElement("button");r.classList.add("ui-window__title-button"),r.innerHTML="⚙️",a.appendChild(r),this._settingsButton=r;const d=document.createElement("button");d.classList.add("ui-window__title-button"),d.innerHTML="📌",a.appendChild(d),this._pinButton=d;const c=document.createElement("button");c.classList.add("ui-window__title-button"),c.innerHTML="❎",a.appendChild(c),this._closeButton=c;const p=document.createElement("div");p.classList.add("ui-window__content"),this._window.appendChild(p),this._container=p,this._window.style.left=`${e.x}px`,this._window.style.top=`${e.y}px`}_addEventListener(){this._window.addEventListener("mousedown",this._onFocus),this._titlebar.addEventListener("pointerdown",this._onPointerDown),this._titlebar.addEventListener("pointermove",this._onPointerMove),this._titlebar.addEventListener("pointerup",this._onPointerUp),this._closeButton.addEventListener("click",this._onCloseButtonClick),this._closeButton.addEventListener("pointerdown",this._stopDragPropagation),window.addEventListener("resize",this._onViewportResize)}_closeWindow(){window.removeEventListener("resize",this._onViewportResize),this._titlebar.removeEventListener("pointerdown",this._onPointerDown),this._titlebar.removeEventListener("pointermove",this._onPointerMove),this._titlebar.removeEventListener("pointerup",this._onPointerUp),this._window.removeEventListener("mousedown",this._onFocus),this._window&&this._window.parentElement&&this._window.parentElement.removeChild(this._window)}_moveWindow(t,e){const n=this._window.offsetWidth,i=this._window.offsetHeight,s=Math.max(0,Math.min(t,window.innerWidth-n)),a=Math.max(0,Math.min(e,window.innerHeight-i));this._window.style.left=`${s}px`,this._window.style.top=`${a}px`}_snapWindowBacc(){const t=this._window.offsetWidth,e=this._window.offsetHeight,n=Math.max(0,window.innerWidth-t),i=Math.max(0,window.innerHeight-e),s=this._window.offsetLeft,a=this._window.offsetTop;let r=s,d=a;s>n?r=n:s<0&&(r=0),a>i?d=i:a<0&&(d=0),(r!==s||d!==a)&&(this._window.style.left=`${r}px`,this._window.style.top=`${d}px`)}addTitle(t){const e=document.createElement("h2");return e.classList.add("ui-title"),e.textContent=t,this._container.appendChild(e),e}addSection(t){const e=document.createElement("h4");return e.classList.add("ui-section"),e.textContent=t,this._container.appendChild(e),e}addDivider(){const t=document.createElement("div");return t.classList.add("ui-window__divider"),this._container.appendChild(t),t}addText(t,e,n,i){const s=document.createElement("p");return s.classList.add("ui-text"),s.textContent=t,e&&(s.style.color=e),n&&(s.style.fontWeight=n),i&&(s.id=i),this._container.appendChild(s),s}addBoldText(t,e,n){const i=document.createElement("p");return i.classList.add("ui-text"),i.innerHTML=`<strong>${t}</strong>`,e&&(i.style.color=e),n&&(i.id=n),this._container.appendChild(i),i}addLink(t,e){const n=document.createElement("p");n.classList.add("ui-text");const i=document.createElement("a");return i.href=e,i.textContent=t,i.target="_blank",n.appendChild(i),this._container.appendChild(n),n}addBulletedList(t){const e=document.createElement("ul");return e.classList.add("ui-text"),t.forEach(n=>{const i=document.createElement("li");i.textContent=n,e.appendChild(i)}),this._container.appendChild(e),e}addNumberedList(t){const e=document.createElement("ol");return e.classList.add("ui-text"),t.forEach(n=>{const i=document.createElement("li");i.textContent=n,e.appendChild(i)}),this._container.appendChild(e),e}addImage(t,e,n,i="Placeholder Image"){const s=document.createElement("img");return s.classList.add("ui-image"),s.src=t,s.alt=i,s.width=e,s.height=n,this._container.appendChild(s),s}addSlider(t,e,n,i){const s=t+":",a=document.createElement("div");a.classList.add("flex-row");const r=document.createElement("label");r.textContent=s,a.appendChild(r);const d=document.createElement("input");d.type="range",d.id=e+"-range",d.min=n.x.toString(),d.max=n.y.toString(),d.value=i.toString(),n.y-n.x<2&&n.y>n.x&&(d.step=.01.toString()),a.appendChild(d);const c=document.createElement("input");return c.style.minWidth="40px",c.type="number",c.id=e+"-number",c.min=n.x.toString(),c.max=n.y.toString(),c.value=i.toString(),d.oninput=()=>c.value=d.value,c.onchange=()=>{const p=Math.max(n.x,Math.min(n.y,parseInt(c.value))).toString();d.value=p,c.value=p},a.appendChild(c),this._container.appendChild(a),a}addTextInput(t,e,n="",i=""){const s=document.createElement("div");s.classList.add("flex-row","ui-text-input-container");const a=document.createElement("label");a.textContent=t+":",a.htmlFor=e,s.appendChild(a);const r=document.createElement("input");return r.type="text",r.id=e,r.placeholder=n,r.value=i,s.appendChild(r),this._container.appendChild(s),s}addButton(t,e,n){const i=document.createElement("button");return i.classList.add("ui-window__content__Button"),i.textContent=t,i.id=e,n&&(i.style.backgroundColor=n),this._container.appendChild(i),i}addDropdown(t,e,n){const i=t+":",s=document.createElement("div");s.classList.add("flex-row");const a=document.createElement("label");a.textContent=i,s.appendChild(a);const r=document.createElement("div");r.classList.add("custom-dropdown-container");const d=document.createElement("div");d.classList.add("dropdown-button"),d.innerHTML=`
          <span id="${e}-display">${n[0]}</span>
      `,r.appendChild(d);const c=document.createElement("ul");c.classList.add("dropdown-list"),c.id=e+"-list",r.appendChild(c);let p=0,f=[];return n.forEach((m,y)=>{const g=document.createElement("li");g.style.marginBottom="0px",g.classList.add("dropdown-item"),g.textContent=m,g.dataset.value=m.toLowerCase().replace(/\s/g,"-"),g.dataset.index=y.toString(),y===p&&g.classList.add("is-selected"),g.addEventListener("click",C=>{C.stopPropagation(),f[p].classList.remove("is-selected"),p=y,g.classList.add("is-selected"),document.getElementById(`${e}-display`).textContent=m,c.classList.remove("is-open")}),c.appendChild(g),f.push(g)}),d.addEventListener("click",m=>{if(m.stopPropagation(),document.querySelectorAll(".dropdown-list.is-open").forEach(g=>{g!==c&&g.classList.remove("is-open")}),c.classList.toggle("is-open")){const g=N.DROPDOWN_ITEM_HEIGHT,C=N.DROPDOWN_BUTTON_HEIGHT,I=p*g,A=C-I;c.style.transform=`translateY(${A-C-6}px)`,c.style.top="0px",c.scrollTop=I}}),s.appendChild(r),this._container.appendChild(s),s}addToggleSwitch(t,e,n=!1){const i=t+":",s=document.createElement("div");s.classList.add("flex-row");const a=document.createElement("label");a.textContent=i,s.appendChild(a);const r=document.createElement("div");r.classList.add("toggle-container");const d=document.createElement("div");return d.classList.add("toggle-switch"),d.id=e+"-switch",n&&d.classList.add("is-on"),d.innerHTML=`
          <span class="toggle-indicator indicator-o">O</span> 
          <span class="toggle-indicator indicator-i">I</span> 
          <div class="toggle-slider"></div>
      `,d.addEventListener("click",()=>{d.classList.toggle("is-on")}),r.appendChild(d),s.appendChild(r),this._container.appendChild(s),s}};N.currentZIndex=100,N.DROPDOWN_ITEM_HEIGHT=30,N.DROPDOWN_BUTTON_HEIGHT=30;let Vt=N;async function Ce(){try{let h=qt;const t=400,e=40,n=1e3,i=4;h.GAME_WIDTH=Math.max(e,Math.min(t,h.GAME_WIDTH)),h.GAME_HEIGHT=Math.max(e,Math.min(t,h.GAME_HEIGHT)),h.PHYSICS_UPDATE_INTERVAL=Math.max(i,Math.min(n,h.PHYSICS_UPDATE_INTERVAL)),Object.freeze(h);const s=document.getElementById("main-canvas");if(!(s instanceof HTMLCanvasElement))throw new Error("HTML element 'main-canvas' does not exist.");const a=document.getElementById("main-panel");if(!(a instanceof HTMLDivElement))throw new Error("HTML element 'main-panel' does not exist.");const r=new ge(s,h),d=await me("./src/data/particles.data"),c=new xe(d,a,s,h,r),p=new _e(a);p.enableDebug(!1),new we(d,h,r,c,p).start(),console.log(d),ve(a)}catch(h){console.error("ERROR: Failed to initialize engine due to data loading failure.",h)}}function ve(h){const t=new Vt(h,"New Window",{x:80,y:80},{x:400,y:600},{x:400,y:600});t.addTitle("Particle Emitter Controls"),t.addImage("assets/preview_image.jpg",300,100,"Preview Image"),t.addText("Status: Core System Active","#4cae50"),t.addDivider(),t.addSection("Emitter"),t.addTextInput("Name","emitter-name","Enter emitor name..."),t.addDivider(),t.addSection("Brush Parameters"),t.addSlider("Brush Size","brush-size",{x:1,y:100},20),t.addSlider("Opacity","opacity-val",{x:0,y:1},.7),t.addToggleSwitch("Smooth","brush-smooth",!1),t.addDropdown("Render Mode","render-mode",["Fastest","High Quality","Wireframe","Debug"]),t.addDivider(),t.addSection("Particle Type");for(let e=1;e<=3;e++)t.addButton(`Particle Type ${e}`,`particle-${e}`);t.addDivider(),t.addButton("Start Simulation","start-sim","#4c5dbb"),t.addButton("Save Preset","save-preset")}Ce();
