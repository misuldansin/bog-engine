var H=c=>{throw TypeError(c)};var R=(c,t,e)=>t.has(c)||H("Cannot "+e);var x=(c,t,e)=>(R(c,t,"read from private field"),e?e.call(c):t.get(c)),B=(c,t,e)=>t.has(c)?H("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(c):t.set(c,e),O=(c,t,e,n)=>(R(c,t,"write to private field"),n?n.call(c,e):t.set(c,e),e),D=(c,t,e)=>(R(c,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();class V{constructor(t,e){this.boggedState=t,this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.frameBuffer=new Uint8ClampedArray(this.boggedState.gameWidth*this.boggedState.gameHeight*4),this.queuedParticles=[],this.queuedOverlayPixels=[],this.queuedUIPixels=[],this.canvas.style.aspectRatio=(this.boggedState.gameWidth/this.boggedState.gameHeight).toString(),this.canvas.width=this.boggedState.gameWidth,this.canvas.height=this.boggedState.gameHeight,this.ctx.imageSmoothingEnabled=!1,this.ctx.translate(0,this.canvas.height),this.ctx.scale(1,-1)}queueUIPixels(t){this.queuedUIPixels=[],this.queuedUIPixels=t}queueParticles(t,e){if(this.queuedParticles.push(...t),e){const n=this.boggedState.gameWidth,i=this.boggedState.gameHeight;for(const s of t){const a=(i-1-s.position.y)*n+s.position.x;this.queuedOverlayPixels.push({index:a,value:e})}}}queueOverlayPixels(t){this.queuedOverlayPixels.push(...t)}renderThisFrame(){if(this.boggedState.isBrushOutlineVisible){const n=this.getBrushOutline(Math.floor(this.boggedState.mouseX),Math.floor(this.boggedState.mouseY));this.queuedUIPixels=n}this.processQueuedParticles();let t=new Uint8ClampedArray(this.frameBuffer);this.addBuffer(t,this.queuedOverlayPixels),this.addBuffer(t,this.queuedUIPixels);const e=new ImageData(t,this.boggedState.gameWidth,this.boggedState.gameHeight);this.ctx.putImageData(e,0,0),this.queuedParticles.length=0,this.queuedOverlayPixels=[],this.queuedUIPixels=[]}processQueuedParticles(){const t=this.queuedParticles,e=this.boggedState.gameWidth,n=this.boggedState.gameHeight;for(const i of t){const s=i.position.x,o=i.position.y,l=(n-1-o)*e+s;let r=this.processParticleColor(i);this.frameBuffer[l*4+0]=r[0],this.frameBuffer[l*4+1]=r[1],this.frameBuffer[l*4+2]=r[2],this.frameBuffer[l*4+3]=r[3]}}processParticleColor(t){return t.color}addBuffer(t,e){for(const{index:n,value:i}of e){const s=t[n*4+0],o=t[n*4+1],a=t[n*4+2],l=t[n*4+3],r=i[0],d=i[1],h=i[2],m=i[3],u=m/255,p=Math.round(r*u+s*(1-u)),g=Math.round(d*u+o*(1-u)),w=Math.round(h*u+a*(1-u)),b=Math.min(l,m);t[n*4+0]=p,t[n*4+1]=g,t[n*4+2]=w,t[n*4+3]=b}}getBrushOutline(t,e){const n=this.boggedState.currentBrushSize,i=[],s=227,o=227,a=227,l=180,r=this.boggedState.gameWidth,d=this.boggedState.gameHeight,h=[-1,1],m=(w,b)=>{for(const y of h)for(const v of h){const f=t+w*v,E=e+b*y,L=t+b*v,P=e+w*y;if(f>=0&&f<r&&E>=0&&E<d){const _=(d-E)*r+f;i.push({index:_,value:new Uint8ClampedArray([s,o,a,l])})}if(L>=0&&L<r&&P>=0&&P<d){const _=(d-P)*r+L;i.push({index:_,value:new Uint8ClampedArray([s,o,a,l])})}}};let u=n,p=0,g=n-n;for(m(u,p);p<u;)p++,g<0?g+=2*p+1:(u--,g+=2*(p-u)+1),m(u,p);return i}}const U=Object.freeze({WHITE:new Uint8ClampedArray([255,255,255,255]),BLACK:new Uint8ClampedArray([0,0,0,255]),GRAY:new Uint8ClampedArray([128,128,128,255]),RED:new Uint8ClampedArray([255,0,0,255]),GREEN:new Uint8ClampedArray([0,255,0,255]),BLUE:new Uint8ClampedArray([0,0,255,255]),YELLOW:new Uint8ClampedArray([255,255,0,255]),CYAN:new Uint8ClampedArray([0,255,255,255]),MAGENTA:new Uint8ClampedArray([255,0,255,255]),TRANSPARENT_BLACK:new Uint8ClampedArray([0,0,0,0]),SEMI_TRANSPARENT_WHITE:new Uint8ClampedArray([255,255,255,128])}),A={createColor(c){return this.hexToColor(c)},hexToColor(c){if(c==null)return U.BLACK;let t=c.replace("#","");if(t.length===6)t+="FF";else if(t.length===3){let n="";for(const i of t)n+=i,n+=i;t=n+"FF"}else return U.BLACK;const e=parseInt(t,16);return new Uint8ClampedArray([e>>24&255,e>>16&255,e>>8&255,e&255])},colorToHex(c){const[t,e,n,i]=c,s=o=>o.toString(16).padStart(2,"0");return`#${s(t)}${s(e)}${s(n)}${s(i)}`},lerpColor(c,t,e){const n=c[0]+(t[0]-c[0])*e,i=c[1]+(t[1]-c[1])*e,s=c[2]+(t[2]-c[2])*e,o=c[3]+(t[3]-c[3])*e;return new Uint8ClampedArray([n,i,s,o])},createColorRamp(c,t,e){if(e<2)return[c,t];const n=1/(e-1),i=new Array(e);for(let s=0;s<e;s++){const o=s*n;i[s]=this.lerpColor(c,t,o)}return i},invertColor(c){const t=255-c[0],e=255-c[1],n=255-c[2],i=c[3];return new Uint8ClampedArray([t,e,n,i])},getLuminance(c){const t=c[0],e=c[1],n=c[2];return .299*t+.587*e+.114*n},getHexLuminance(c){const t=c.startsWith("#")?c.substring(1):c;if(t.length<6)return 0;const e=parseInt(t,16),n=e>>16&255,i=e>>8&255,s=e&255;return .299*n+.587*i+.114*s}},N={lerp(c,t,e){return c+(t-c)*e},shuffleArray(c){const t=[...c];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t},calculateRepose(c){let t=Math.max(10,Math.min(c,80));const e=t*Math.PI/180;let n=[];if(n.push([{dx:0,dy:-1}]),t<50){n.push([{dx:1,dy:-1},{dx:-1,dy:-1}]);const i=Math.round(1/Math.tan(e));n.push([{dx:i,dy:-1},{dx:i*-1,dy:-1}])}else{const i=Math.round(Math.tan(e));n.push([{dx:1,dy:-i},{dx:-1,dy:-i}])}return n}},X=Object.freeze({ALL_NEIGHBORS:[{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}]}),k=Object.freeze({UP_LEFT:{dx:-1,dy:1},UP:{dx:0,dy:1},UP_RIGHT:{dx:1,dy:1},LEFT:{dx:-1,dy:0},RIGHT:{dx:1,dy:0},DOWN_LEFT:{dx:-1,dy:-1},DOWN:{dx:0,dy:-1},DOWN_RIGHT:{dx:1,dy:-1}});var C,S,I,q,z;class K{constructor(t,e,n){B(this,I);B(this,C);B(this,S);this.width=t,this.height=e,O(this,C,new Array(t*e)),O(this,S,new Set),this.particleData=n,D(this,I,z).call(this,0)}get data(){return x(this,C)}get dirtyParticles(){return x(this,S)}createParticleAt(t,e,n,i,s){if(!this.isInBounds(t,e))return!1;let o=D(this,I,q).call(this,n);return o.position.x=t,o.position.y=e,o.index=e*this.width+t,i&&this.markDirty(o,s),x(this,C)[e*this.width+t]=o,!0}getParticleAt(t,e){return this.isInBounds(t,e)?x(this,C)[e*this.width+t]:null}tryMoveParticle(t,e,n=!1,i=!1,s=!1){for(const o of e){if(!o)continue;const a=N.shuffleArray(o);for(const l of a){let r=l.dx;n&&Math.random()>.5&&(r=l.dx*-1);const d=t.position.x+r,h=t.position.y+l.dy,m=this.getParticleAt(d,h);if(m&&m.isMovable&&t.density>m.density){x(this,C)[m.index]=t,x(this,C)[t.index]=m;const u={x:t.position.x,y:t.position.y},p=t.index;return t.position=m.position,t.index=m.index,m.position=u,m.index=p,i&&(this.markDirty(t,s),this.markDirty(m,s)),m}}}return null}swapParticles(t,e,n,i){x(this,C)[t.index]=e,x(this,C)[e.index]=t;const s={x:t.position.x,y:t.position.y},o=t.index;t.position=e.position,t.index=e.index,e.position=s,e.index=o,n&&(this.markDirty(t,i),this.markDirty(e,i))}getNeighborOf(t,e){const n=t.position.x+e.dx,i=t.position.y+e.dy;return this.getParticleAt(n,i)}getNeighborsOf(t,e,n,i){return e.map(o=>this.getNeighborOf(t,o)).filter(o=>o!==null).filter(o=>{const a=n===void 0||o.category===n,l=i===void 0||o.id===i;return a&&l})}markDirty(t,e){if(x(this,S).add(t.index),e){const n=this.getNeighborsOf(t,X.ALL_NEIGHBORS);for(const i of n)x(this,S).add(i.index)}}isInBounds(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}fillCircleAt(t,e,n,i){for(let s=-n;s<=n;s++)for(let o=-n;o<=n;o++){if(s*s+o*o>n*n)continue;const a=t+s,l=e+o;if(!this.isInBounds(a,l))continue;const r=this.getParticleAt(a,l);(i===0||r===null||r.id===0)&&this.createParticleAt(a,l,i,!0,!0)}}}C=new WeakMap,S=new WeakMap,I=new WeakSet,q=function(t){const e=this.particleData[t];if(!e)return null;let i=Math.random(),o=6-1,a=Math.round(i*o)/o;const l=A.hexToColor(e.baseColor),r=A.hexToColor(e.variantColor),d=A.lerpColor(l,r,a);let h={handle:-1,id:e.id,name:e.name,color:d,position:{x:-1,y:-1},index:0,isMovable:e.isMovable,density:e.density};return e.category===0?{...h,category:0}:e.category===1?{...h,category:1}:e.category===2?{...h,category:2,concentration:0,maxConcentration:e.maxConcentration}:e.category===3?{...h,category:3}:e.category===4?{...h,category:4,reposeAngle:e.reposeAngle,reposeDirections:e.reposeDirections}:e.category===5?{...h,category:5,node:-1}:null},z=function(t){const e=this.width,n=this.height;O(this,C,new Array(e*n));for(let i=0;i<n;i++)for(let s=0;s<e;s++){let o=i*e+s,a=D(this,I,q).call(this,t);a&&(a.position.x=s,a.position.y=i,a.index=o,x(this,C)[o]=a,x(this,S).add(a.index))}};var W,$;class j{constructor(t,e,n,i){B(this,W);this.isRunning=!1,this.animationFrameId=null,this.lastFrameTime=0,this.tickCount=0,this.accumulator=0,this.clearDirtyDelta=0,this.clearDirtyFreq=2,this.neighborKeys=Object.keys(k),this.gameLoop=s=>{if(!this.isRunning)return;this.lastFrameTime===0&&(this.lastFrameTime=s);const o=s-this.lastFrameTime;this.lastFrameTime=s,this.debug.updateDisplay(s,this),this.handleInput(),this.accumulator+=o;let a=0;for(;this.accumulator>=this.physicsInterval;)if(this.stepPhysics(),a++,this.tickCount++,this.accumulator-=this.physicsInterval,a>60){this.accumulator=0;break}this.renderer.renderThisFrame(),this.animationFrameId=requestAnimationFrame(this.gameLoop)},this.boggedState=t,this.renderer=e,this.inputManager=n,this.debug=i,this.currentGrid=new K(this.boggedState.gameWidth,this.boggedState.gameHeight,this.boggedState.particleData),this.particlesProcessed=new Set,this.renderInterval=this.boggedState.renderInterval,this.physicsInterval=this.boggedState.physicsInterval}start(){this.isRunning||(this.isRunning=!0,this.lastFrameTime=0,this.animationFrameId=requestAnimationFrame(this.gameLoop))}stop(){this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}handleInput(){this.boggedState.isLeftMouseButtonDown&&this.currentGrid.fillCircleAt(Math.floor(this.boggedState.mouseX),Math.floor(this.boggedState.mouseY),this.boggedState.currentBrushSize,this.boggedState.selectedParticleId),this.boggedState.isRightMouseButtonDown&&this.currentGrid.fillCircleAt(Math.floor(this.boggedState.mouseX),Math.floor(this.boggedState.mouseY),this.boggedState.currentBrushSize,0)}stepPhysics(){let t=[];for(const n of this.currentGrid.dirtyParticles)t.push(this.currentGrid.data[n]);this.clearDirtyDelta++,this.clearDirtyDelta>this.clearDirtyFreq&&(this.currentGrid.dirtyParticles.clear(),this.clearDirtyDelta=0),this.renderer.queueParticles(t,this.debug.isOverlayEnabled?new Uint8ClampedArray([210,55,55,180]):void 0),this.particlesProcessed.clear(),t=N.shuffleArray(t),t.sort((n,i)=>n.position.y-i.position.y);for(const n of t)if(n&&!this.particlesProcessed.has(n.index))switch(n.category){case 1:break;case 2:this.handleLiquids(n);break;case 3:this.handleGases(n);break;case 4:D(this,W,$).call(this,n);break;case 5:break;default:continue}let e=this.groupParticles(this.currentGrid,2);this.simulateEqualisation(e)}handleLiquids(t){let e=[[{dx:0,dy:-1}],[{dx:-1,dy:-1},{dx:1,dy:-1}],[{dx:-1,dy:0},{dx:1,dy:0}]];const n=this.currentGrid.tryMoveParticle(t,e,!1,!0,!0);n&&(this.particlesProcessed.add(t.index),this.particlesProcessed.add(n.index))}handleGases(t){const e=this.neighborKeys[Math.floor(Math.random()*this.neighborKeys.length)];let i=[[k[e]]];const s=this.currentGrid.tryMoveParticle(t,i,!1,!0,!0);s&&(this.particlesProcessed.add(t.index),this.particlesProcessed.add(s.index))}simulateEqualisation(t){for(const e of t){const n=e.liquidParticle.sort((l,r)=>r.position.y-l.position.y),i=e.emptyParticle.sort((l,r)=>l.position.y-r.position.y),s=n.length;let o=0;const a=s/4;for(let l=0;l<s;l++){const r=n[l],d=i[l];if(Math.sqrt(r.position.x*d.position.x+r.position.y*d.position.y),r.position.y>d.position.y&&(this.currentGrid.swapParticles(r,d,!0,!0),this.particlesProcessed.add(r.index),this.particlesProcessed.add(d.index),o++,o>=a))break}}}groupParticles(t,e){const n=t.width,i=t.height,s=[],o=[],a={};for(let r=i-1;r>=0;r--)for(let d=0;d<n;d++){const h=r*n+d,m=t.getParticleAt(d,r);if(!m||m.category!==e||m.category!==e)continue;const u=t.getNeighborOf(m,k.UP),p=t.getNeighborOf(m,k.LEFT),g=u&&u.id===m.id,w=p&&p.id===m.id;let b=-1;w&&(b=r*n+(d-1));let y=-1;g&&(y=(r+1)*n+d);const v=u&&u.id===0;if(!w&&!g){const f=o.length;s.push([h]),o.push({liquidParticle:[],emptyParticle:[]}),v&&(o[f].liquidParticle.push(m),o[f].emptyParticle.push(u)),a[h]=f}else if(w&&!g){const f=a[b];s[f].push(h),v&&(o[f].liquidParticle.push(m),o[f].emptyParticle.push(u)),a[h]=f}else if(!w&&g){const f=a[y];s[f].push(h),v&&(o[f].liquidParticle.push(m),o[f].emptyParticle.push(u)),a[h]=f}else{const f=a[y];s[f].push(h),v&&(o[f].liquidParticle.push(m),o[f].emptyParticle.push(u)),a[h]=f;const E=a[b];if(E!==f){const L=o[E];for(const _ of L.liquidParticle)o[f].liquidParticle.push(_);for(const _ of L.emptyParticle)o[f].emptyParticle.push(_);const P=s[E];for(const _ of P)a[_]=f;s[E]=[],o[E]={liquidParticle:[],emptyParticle:[]}}}}return o.filter(r=>r.liquidParticle.length>30)}}W=new WeakSet,$=function(t){let e=t.reposeDirections;const n=this.currentGrid.tryMoveParticle(t,e,!0,!0,!0);n&&(this.particlesProcessed.add(t.index),this.particlesProcessed.add(n.index))};const M=class M{constructor(t,e,n,i,s){this.contents=[],this.contentBarButtons=[],this.selectedContent=0,this.contentBarOrientation="left",this.isFocused=!1,this.isDragging=!1,this.dragOffset={x:0,y:0},this.onViewportResize=()=>{this.snapWindowBacc()},this.onWindowFocus=()=>{this.isFocused||(M.currentZIndex++,this.windowEl.style.zIndex=M.currentZIndex.toString())},this.onPointerDown=o=>{if(o.stopPropagation(),this.onWindowFocus(),o.button===0){this.titlebarEl.setPointerCapture(o.pointerId);const a=this.windowEl.getBoundingClientRect();this.dragOffset.x=o.clientX-a.left,this.dragOffset.y=o.clientY-a.top,this.isDragging=!0}else this.isDragging=!1},this.onPointerUp=o=>{this.isDragging&&(this.titlebarEl.releasePointerCapture(o.pointerId),this.isDragging=!1)},this.onPointerMove=o=>{if(this.isDragging){const a=this.hostEl.getBoundingClientRect(),l=o.clientX-this.dragOffset.x-a.left,r=o.clientY-this.dragOffset.y-a.top;this.setPosition({x:l,y:r})}},this.title=e,this.position=n,this.size=i,this.maxSize=s,this.isVisible=!1,this.hostEl=t,this.windowEl=this.createWindowElement(n,i,s,M.currentZIndex),this.titlebarEl=this.createTitlebarElement(e),this.controlBarEl=this.createControlBarElement(),this.contentWrapperEl=this.createContentWrapperElement(),this.contentBarEl=this.createContentBarElement(),this.contentContainerEl=this.createContentContainerElement(),this.hostEl.appendChild(this.windowEl),this.titlebarEl.appendChild(this.controlBarEl),this.windowEl.appendChild(this.titlebarEl),this.contentWrapperEl.appendChild(this.contentBarEl),this.contentWrapperEl.appendChild(this.contentContainerEl),this.windowEl.appendChild(this.contentWrapperEl),window.addEventListener("resize",this.onViewportResize)}destroy(){window.removeEventListener("resize",this.onViewportResize),this.windowEl.removeEventListener("mousedown",this.onWindowFocus),this.titlebarEl.removeEventListener("pointerdown",this.onPointerDown),this.titlebarEl.removeEventListener("pointermove",this.onPointerMove),this.titlebarEl.removeEventListener("pointerup",this.onPointerUp),this.windowEl&&this.windowEl.parentElement&&this.windowEl.parentElement.removeChild(this.windowEl),this.windowEl=null,this.titlebarEl=null,this.controlBarEl=null,this.contentWrapperEl=null,this.contentBarEl=null,this.contentContainerEl=null}setVisibility(t){t?this.windowEl.classList.add("is-visible"):this.windowEl.classList.remove("is-visible"),this.isVisible=t}setContentBarVisibility(t){t?this.contentBarEl.classList.add("is-visible"):this.contentBarEl.classList.remove("is-visible")}getContentBarButtonAtIndex(t){return this.contentBarButtons[t]}setPosition(t){const e=this.windowEl.offsetWidth,n=this.windowEl.offsetHeight,i=this.hostEl.offsetWidth,s=this.hostEl.offsetHeight,o=Math.max(0,Math.min(t.x,i-e)),a=Math.max(0,Math.min(t.y,s-n));this.windowEl.style.left=`${o}px`,this.windowEl.style.top=`${a}px`}setContentBarOrientation(t){this.contentWrapperEl.classList.remove("top","bottom","left","right"),this.contentWrapperEl.classList.add(t),this.contentBarOrientation=t}addNewContent(t,e,n){let i=this.contents.length;this.contents.length!==0&&(t.style.display="none"),t.id="container-"+i,this.contentContainerEl.appendChild(t);const s=document.createElement("button");s.classList.add("ui-window__content-bar__button"),s.title=e,this.contentBarEl.appendChild(s);const o=document.createElement("img");o.classList.add("ui-window__content-bar__button__icon"),o.alt=e,o.src=n,s.appendChild(o),s.addEventListener("click",()=>this.displayContentAtIndex(i)),this.contentBarButtons.push(s),this.contents.push(t)}displayContent(t){const e=this.contents;for(let n=0;n<e.length;n++){const i=e[n];if(i===t){this.contents.forEach((s,o)=>{s.style.display="none"}),i.style.display="",this.selectedContent=n,this.contentBarButtons.forEach((s,o)=>{o===n?s.classList.add("active"):s.classList.remove("active")});return}}}displayContentAtIndex(t){const e=this.contents[t];e&&this.displayContent(e)}addContentBarSeparator(t=!1){const e=document.createElement("div");return e.classList.add("ui-window__content-bar__separator"),t&&e.classList.add("is-spacer"),this.contentBarEl.appendChild(e),e}createWindowElement(t,e,n,i){const s=document.createElement("div");return s.classList.add("ui-window"),s.style.left=`${t.x}px`,s.style.top=`${t.y}px`,s.style.width=`${e.width}px`,s.style.height=`${e.height}px`,s.style.maxWidth=`${n.width}px`,s.style.maxHeight=`${n.height}px`,s.style.zIndex=i.toString(),s.addEventListener("mousedown",this.onWindowFocus),s}createTitlebarElement(t){const e=document.createElement("div");e.classList.add("ui-window__title-bar");const n=document.createElement("span");return n.classList.add("ui-window__title"),n.textContent=t,e.appendChild(n),e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),e}createControlBarElement(){const t=document.createElement("div");t.classList.add("ui-window__title-bar__button__wrapper");const e=document.createElement("button");e.classList.add("ui-window__title-bar__button");const n=document.createElement("img");return n.src="./assets/icons/close.svg",e.appendChild(n),t.appendChild(e),e.addEventListener("pointerdown",i=>{i.stopPropagation()}),e.addEventListener("click",()=>{this.setVisibility(!1)}),t}createContentWrapperElement(){const t=document.createElement("div");return t.classList.add("ui-window__content__wrapper","left"),t}createContentBarElement(){const t=document.createElement("div");return t.classList.add("ui-window__content-bar"),t}createContentContainerElement(){const t=document.createElement("div");return t.classList.add("ui-window__content-container"),t}snapWindowBacc(){const t=this.windowEl.offsetWidth,e=this.windowEl.offsetHeight,n=this.hostEl.offsetWidth,i=this.hostEl.offsetHeight,s=Math.max(0,n-t),o=Math.max(0,i-e),a=this.windowEl.offsetLeft,l=this.windowEl.offsetTop,r=Math.max(0,Math.min(a,s)),d=Math.max(0,Math.min(l,o));(r!==a||d!==l)&&(this.windowEl.style.left=`${r}px`,this.windowEl.style.top=`${d}px`)}};M.currentZIndex=100;let F=M;class Q{constructor(){this.contentElement=document.createElement("div"),this.contentElement.classList.add("ui-window__content")}addSeparator(t=1,e=!1){const n=document.createElement("div");if(n.classList.add("ui-window__content__separator"),n.style.height=`${t}px`,e){const i=document.createElement("div");i.classList.add("ui-window__content__separator__line"),n.appendChild(i)}return this.contentElement.appendChild(n),n}addTitle(t){const e=document.createElement("h3");return e.classList.add("ui-window__content__heading-title"),e.textContent=t,this.contentElement.appendChild(e),e}addSection(t){const e=document.createElement("h4");return e.classList.add("ui-window__content__heading-section"),e.textContent=t,this.contentElement.appendChild(e),e}addText(t,e,n,i){const s=document.createElement("p");return s.classList.add("ui-window__content__text"),s.textContent=t,e!=null&&(s.style.color=e),i!=null&&(s.id=i),n!=null&&(s.style.fontWeight=n),this.contentElement.appendChild(s),s}addLink(t,e,n){const i=document.createElement("p");i.classList.add("ui-window__content__text"),n!=null&&(i.id=n);const s=document.createElement("a");return s.href=e,s.textContent=t,s.target="_blank",i.appendChild(s),this.contentElement.appendChild(i),i}addBulletedList(t){const e=document.createElement("ul");return e.classList.add("ui-window__content"),t.forEach(n=>{const i=document.createElement("li");i.classList.add("ui-window__content"),i.textContent=n,e.appendChild(i)}),this.contentElement.appendChild(e),e}addNumberedList(t){const e=document.createElement("ol");return e.classList.add("ui-window__content"),t.forEach(n=>{const i=document.createElement("li");i.classList.add("ui-window__content"),i.textContent=n,e.appendChild(i)}),this.contentElement.appendChild(e),e}addImage(t,e,n,i){const s=document.createElement("img");return s.classList.add("ui-window__content__image"),s.src=e,s.alt=n,s.width=t.width,s.height=t.height,i!=null&&(s.id=i),this.contentElement.appendChild(s),s}addSlider(t,e,n,i,s,o){const a=document.createElement("div");a.classList.add("ui-window__helper__flex-row"),o!=null&&(a.id=o);const l=document.createElement("label");l.textContent=t+":",a.appendChild(l);const r=document.createElement("input");r.type="range",r.min=e.toString(),r.max=n.toString(),r.value=i.toString(),r.step=s.toString(),o!=null&&(r.id=o+"-range"),a.appendChild(r);const d=document.createElement("input");return d.style.minWidth="40px",d.type="number",d.min=e.toString(),d.max=n.toString(),d.value=i.toString(),d.step=s.toString(),o!=null&&(d.id=o+"-number"),a.appendChild(d),r.oninput=()=>d.value=r.value,d.onchange=()=>{const h=Math.max(e,Math.min(n,parseInt(d.value))).toString();r.value=h,d.value=h},this.contentElement.appendChild(a),a}addTextInput(t,e,n,i){const s=document.createElement("div");s.classList.add("ui-window__content__text-input__wrapper");const o=document.createElement("label");o.textContent=t+":",s.appendChild(o);const a=document.createElement("input");return a.type="text",a.placeholder=e,a.value=n,i!=null&&(a.id=i),s.appendChild(a),this.contentElement.appendChild(s),s}addButton(t,e,n){const i=document.createElement("button");return i.classList.add("ui-window__content__button"),i.textContent=t,e!=null&&(i.id=e),n!=null&&(i.style.backgroundColor=n),this.contentElement.appendChild(i),i}addDropdownButton(t,e,n=0,i){const s=document.createElement("div");s.classList.add("ui-window__helper__flex-row");const o=document.createElement("label");o.textContent=t+":",s.appendChild(o);const a=document.createElement("div");a.classList.add("ui-window__content__dropdown-button__wrapper"),s.appendChild(a);const l=document.createElement("div");l.classList.add("ui-window__content__dropdown-button");const r=document.createElement("span");r.textContent=e[0]?e[0]:"Template Item",i!=null&&(r.id=`${i}-display`),l.appendChild(r),a.appendChild(l);const d=document.createElement("ul");d.classList.add("ui-window__content__dropdown-list"),i!=null&&(d.id=`${i}-list`),a.appendChild(d);let h=Math.max(0,Math.min(n,e.length-1));const m=[];for(let u=0;u<e.length;u++){const p=e[u],g=document.createElement("li");g.style.marginBottom="0px",g.classList.add("ui-window__content__dropdown-item"),g.textContent=p,g.dataset.index=u.toString(),g.dataset.value=p.toLowerCase().replace(/\s/g,"-"),u===h&&(g.classList.add("is-selected"),r.textContent=p),g.addEventListener("click",w=>{w.stopPropagation(),m[h].classList.remove("is-selected"),h=u,g.classList.add("is-selected"),r.textContent=p,d.classList.remove("is-open")}),d.appendChild(g),m.push(g)}return l.addEventListener("click",u=>{if(u.stopPropagation(),d.classList.toggle("is-open")){d.parentElement,d.dataset.originId=a.id,document.body.appendChild(d);const g=l.getBoundingClientRect(),w=d.getBoundingClientRect(),b=d.scrollHeight||w.height,y=document.documentElement.clientHeight;d.style.position="absolute",d.style.left=`${g.left}px`,d.style.width=`${g.width}px`,d.style.zIndex="9999";const v=d.querySelector(".dropdown-item.is-selected");if(v){const f=v.offsetTop;let E=g.top-f;E<0&&(E=0),E+b>y&&(E=Math.max(0,y-b)),d.style.top=`${Math.round(E)}px`,d.scrollTop=f}else{let f=g.bottom;f+b>y&&(f=Math.max(0,y-b)),d.style.top=`${Math.round(f)}px`,d.scrollTop=0}}else d.parentElement===document.body&&a.appendChild(d)}),this.contentElement.appendChild(s),{button:l,items:m}}addToggleSwitch(t,e=!1,n){const i=document.createElement("div");i.classList.add("ui-window__helper__flex-row");const s=document.createElement("label");s.textContent=t+":",i.appendChild(s);const o=document.createElement("div");o.classList.add("ui-window__content__toggle-button__wrapper"),i.appendChild(o);const a=document.createElement("div");a.classList.add("ui-window__content__toggle-button"),a.dataset.state=e?"on":"off",e&&a.classList.add("is-on"),n!=null&&(a.id=n+"-switch"),o.appendChild(a);const l=document.createElement("span");l.classList.add("ui-window__content__toggle-button__indicator","indicator-o"),l.textContent="O",a.appendChild(l);const r=document.createElement("span");r.classList.add("ui-window__content__toggle-button__indicator","indicator-i"),r.textContent="I",a.appendChild(r);const d=document.createElement("div");return d.classList.add("ui-window__content__toggle-button__slider"),a.appendChild(d),a.addEventListener("click",()=>{const h=a.classList.toggle("is-on");a.dataset.state=h?"on":"off"}),this.contentElement.appendChild(i),a}}var T=(c=>(c[c.Palette=1]="Palette",c[c.DebugStats=2]="DebugStats",c[c.DebugQuickLook=3]="DebugQuickLook",c))(T||{});class Z{constructor(t,e){this.windows=new Map,this.selectedParticleButton=null,this.host=t,this.boggedState=e,this.addWindowDropdownListener()}openWindow(t,e){const n=this.getOrCreateWindow(t);n&&!n.isVisible&&n.setVisibility(!0)}closeWindow(t){const e=this.windows.get(t);e&&e.isVisible&&e.setVisibility(!1)}toggleWindow(t,e){const n=this.getOrCreateWindow(t);n&&(n.isVisible?n.setVisibility(!1):n.setVisibility(!0))}getOrCreateWindow(t){let e=this.windows.get(t);if(!e){switch(t){case 1:e=this.createPaletteWindow();break;case 2:e=this.createDebugStatsWindow();break;default:return}this.windows.set(t,e)}return e}createPaletteWindow(){const t=u=>{const p=[],g=document.createElement("div");g.classList.add("particle-palette-container"),u.addNewContent(g,"Solids","./assets/icons/solid.svg"),p.push(g);const w=document.createElement("div");w.classList.add("particle-palette-container"),u.addNewContent(w,"Liquids","./assets/icons/liquid.svg"),p.push(w);const b=document.createElement("div");b.classList.add("particle-palette-container"),u.addNewContent(b,"Gases","./assets/icons/gas.svg"),p.push(b);const y=document.createElement("div");y.classList.add("particle-palette-container"),u.addNewContent(y,"Sands","./assets/icons/sand.svg"),p.push(y);const v=document.createElement("div");v.classList.add("particle-palette-container"),u.addNewContent(v,"Electronics","./assets/icons/electronics.svg"),p.push(v);const f=new Q;let{button:E,items:L}=f.addDropdownButton("Orientation",["Top","Left","Right","Bottom"],3,"palette-orientation");return L.forEach(P=>{P.addEventListener("click",()=>{const _=P.dataset.value;_&&u.setContentBarOrientation(_)})}),u.addContentBarSeparator(!0),u.addNewContent(f.contentElement,"Settings","./assets/icons/settings.svg"),p.push(f.contentElement),p},e=(u,p,g)=>{p.addEventListener("click",()=>{if(this.boggedState.selectedCategoryId===g+1)return;this.selectedParticleButton&&this.selectedParticleButton.classList.remove("selected");const w=u.querySelector(".particle-button");w?(w.classList.add("selected"),this.selectedParticleButton=w,this.boggedState.selectedParticleId=parseInt(w.dataset.particleId||"0",10),this.boggedState.selectedCategoryId=parseInt(w.dataset.category||"0",10)):(this.boggedState.selectedParticleId=0,this.boggedState.selectedCategoryId=0)})},n=u=>{const p=document.createElement("button");p.className="particle-button",p.textContent=u.name;const g=A.getHexLuminance(u.baseColor)>210,w=g?"#323238":"#FFFFFF",b=g?"#FFFFFF":"#323238";return p.style.setProperty("--particle-button-base-color",u.baseColor),p.style.setProperty("--particle-button-variant-color",u.variantColor),p.style.color=w,p.style.textShadow=`1px 1px 2px rgba(${b[0]}, ${b[1]}, ${b[2]}, 0.6)`,p.dataset.particleId=u.id.toString(),p.dataset.category=u.category.toString(),p},i="Particle Palette",s={x:390,y:124},o={width:332,height:206},a={width:420,height:400},l=new F(this.host,i,s,o,a),r=t(l);for(let u=0;u<r.length-1;u++){const p=r[u],g=l.getContentBarButtonAtIndex(u);g!==void 0&&e(p,g,u)}l.setContentBarVisibility(!0),l.setContentBarOrientation("bottom");const d=2;l.displayContentAtIndex(d-1);const h=this.boggedState.particleData;let m=null;for(const u in h){const p=h[u],g=r[p.category-1];if(!g)continue;const w=n(p);w.addEventListener("click",()=>{this.selectedParticleButton&&this.selectedParticleButton.classList.remove("selected"),w.classList.add("selected"),this.selectedParticleButton=w,this.boggedState.selectedParticleId=p.id,this.boggedState.selectedCategoryId=p.category}),g.appendChild(w),!m&&p.category===d&&(m=w,m.classList.add("selected"),this.selectedParticleButton=m,this.boggedState.selectedParticleId=p.id,this.boggedState.selectedCategoryId=p.category)}return l}createDebugStatsWindow(){const t="Debug Stats",e={x:80,y:80},n={width:260,height:46},i={width:260,height:46},s=new F(this.host,t,e,n,i),o=document.createElement("div");o.classList.add("debug__stats-content"),s.addNewContent(o,"Stats Content","./assets/icons/settings.svg");const a=document.createElement("div");a.classList.add("debug__stats-content__info-container"),o.appendChild(a);const l=document.createElement("div");l.classList.add("debug__stats-content__info-container"),o.appendChild(l);const r=this.boggedState.debugInstance;return r&&r.setStatsElements(a,l),s}addWindowDropdownListener(){document.addEventListener("click",t=>{document.querySelectorAll(".ui-window__content__dropdown-list.is-open").forEach(e=>{const n=e.dataset.originId,i=n?document.getElementById(n):null;!e.contains(t.target)&&!i?.contains(t.target)&&(e.classList.remove("is-open"),i?.appendChild(e))})})}}class J{constructor(t,e,n){this.activePointerId=null,this.isAppMenuOpen=!1,this.boggedState=t,this.windowManager=new Z(e,t),this.viewport=e,this.canvas=n,this.initAppMenu(),this.bindCanvasEvents(),this.viewport.addEventListener("contextmenu",i=>{i.preventDefault()}),document.addEventListener("click",()=>{const i=document.querySelector(".app-menu__dropdown.is-open");i instanceof HTMLDivElement&&(i.classList.remove("is-open"),this.isAppMenuOpen=!1)}),this.windowManager.openWindow(T.Palette)}initAppMenu(){const t=[{id:"bog-menu-item",items:["Settings","Quit"]},{id:"world-item",items:["Particle Palette"]},{id:"debug-item",items:["Quick Look","Stats","Debug Menu"]},{id:"help-item",items:["About","Report Issue"]}],e=[];for(let n=0;n<t.length;n++){const i=t[n];if(!i)continue;const s=document.getElementById(i.id);if(!(s instanceof HTMLDivElement))continue;const o=this.createAppMenuDropdowns(s,i.items);o.items.forEach(l=>{e.push(l)});const a=o.menu;s.addEventListener("click",l=>{l.stopPropagation();const r=document.querySelector(".app-menu__dropdown.is-open");r&&r!==a&&r.classList.remove("is-open");const d=a.classList.toggle("is-open");this.isAppMenuOpen=d}),s.addEventListener("mouseenter",()=>{if(this.isAppMenuOpen&&!a.classList.contains("is-open")){const l=document.querySelector(".app-menu__dropdown.is-open");l&&l!==a&&l.classList.remove("is-open"),a.classList.add("is-open")}})}e.forEach(n=>{switch(n.textContent){case"Particle Palette":n.classList.remove("is-disabled"),n.addEventListener("click",()=>{this.windowManager.openWindow(T.Palette)});break;case"Stats":n.classList.remove("is-disabled"),n.addEventListener("click",()=>{this.windowManager.openWindow(T.DebugStats)});break;case"About":n.classList.remove("is-disabled"),n.addEventListener("click",()=>{window.open("https://github.com/misuldansin/bog-engine/","_blank")});break;case"Report Issue":n.classList.remove("is-disabled"),n.addEventListener("click",()=>{window.open("https://github.com/misuldansin/bog-engine/issues/new","_blank")});break}})}createAppMenuDropdowns(t,e){const n=document.createElement("div");n.classList.add("app-menu__dropdown");let i=[];return e.forEach(s=>{const o=document.createElement("div");o.classList.add("app-menu__dropdown-item","is-disabled"),o.textContent=s,n.appendChild(o),i.push(o)}),t.appendChild(n),{menu:n,items:i}}bindCanvasEvents(){const t=i=>{try{this.canvas.releasePointerCapture(i.pointerId)}catch{}},e=i=>{try{this.canvas.setPointerCapture(i.pointerId)}catch{}},n=i=>{const s=this.canvas.getBoundingClientRect(),o=this.boggedState.gameWidth/s.width,a=this.boggedState.gameHeight/s.height,l=(i.clientX-s.left)*o,r=this.canvas.height-(i.clientY-s.top)*a;this.boggedState.mouseX=l,this.boggedState.mouseY=r};this.canvas.addEventListener("pointerdown",i=>{switch(n(i),i.button){case 0:this.boggedState.isLeftMouseButtonDown=!0;break;case 2:this.boggedState.isRightMouseButtonDown=!0;break;default:this.boggedState.isLeftMouseButtonDown=!1,this.boggedState.isRightMouseButtonDown=!1;break}e(i),this.activePointerId=i.pointerId}),this.canvas.addEventListener("pointermove",i=>{n(i),typeof i.buttons=="number"&&(this.boggedState.isLeftMouseButtonDown=(i.buttons&1)===1,this.boggedState.isRightMouseButtonDown=(i.buttons&2)===2)}),this.canvas.addEventListener("pointerup",i=>{this.activePointerId===i.pointerId&&(t(i),this.activePointerId=null),this.boggedState.isLeftMouseButtonDown=!1,this.boggedState.isRightMouseButtonDown=!1}),this.canvas.addEventListener("pointercancel",i=>{this.activePointerId===i.pointerId&&(t(i),this.activePointerId=null),this.boggedState.isLeftMouseButtonDown=!1,this.boggedState.isRightMouseButtonDown=!1}),this.canvas.addEventListener("lostpointercapture",i=>{this.activePointerId===i.pointerId&&(t(i),this.activePointerId=null),this.boggedState.isLeftMouseButtonDown=!1,this.boggedState.isRightMouseButtonDown=!1}),this.canvas.addEventListener("pointerenter",()=>{this.boggedState.isBrushOutlineVisible=!0}),this.canvas.addEventListener("pointerleave",()=>{this.boggedState.isBrushOutlineVisible=!1}),this.canvas.addEventListener("focus",()=>{this.boggedState.isBrushOutlineVisible=!0}),this.canvas.addEventListener("blur",()=>{this.boggedState.isBrushOutlineVisible=!1}),this.canvas.addEventListener("wheel",i=>{i.preventDefault();const s=Math.floor(this.boggedState.currentBrushSize-i.deltaY*this.boggedState.brushSensitivity),o=Math.max(0,Math.min(s,this.boggedState.brushMaxSize));this.boggedState.currentBrushSize=o},{passive:!1}),window.addEventListener("pointerup",()=>{this.boggedState.isLeftMouseButtonDown=!1,this.boggedState.isRightMouseButtonDown=!1,this.activePointerId=null}),document.addEventListener("visibilitychange",()=>{document.hidden&&(this.boggedState.isLeftMouseButtonDown=!1,this.boggedState.isRightMouseButtonDown=!1,this.activePointerId=null)})}}class tt{constructor(t,e,n=!1){this.isStatsEnabled=!1,this.fpsElement=null,this.tpsElement=null,this.frameCount=0,this.fps=0,this.tps=0,this.lastStatsUpdateTime=0,this.boggedState=t,this.isEnabled=n,this.isOverlayEnabled=!1,this.elements=new Map,this.initDebug(e)}setStatsElements(t,e){this.fpsElement=t,this.tpsElement=e,this.isStatsEnabled=!0}enableDebug(t){this.isEnabled=!0,t&&(this.isOverlayEnabled=!0)}disableDebug(){this.isEnabled=!1,this.isOverlayEnabled=!1}updateDisplay(t,e){if(this.isEnabled){if(this.frameCount++,t>=this.lastStatsUpdateTime+1e3){const n=t-this.lastStatsUpdateTime;this.fps=this.frameCount*1e3/n,this.tps=e.tickCount*1e3/n,this.frameCount=0,e.tickCount=0,this.lastStatsUpdateTime=t}this.fpsElement&&(this.fpsElement.textContent=`FPS: ${this.fps.toFixed(0)}`),this.tpsElement&&(this.tpsElement.textContent=`TPS: ${this.tps.toFixed(0)}`)}}initDebug(t){const e=document.createElement("div");e.classList.add("debug-container"),t.appendChild(e),this.elements.set("debug-container",e);const n=document.createElement("div");n.classList.add("debug-info-container"),e.appendChild(n),this.elements.set("info-container",n)}}async function Y(c){try{const t=await fetch(c);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return await t.text()}catch(t){throw console.error(`Failed to read particle data from ${c}:`,t),new Error("Failed to load particle data.")}}async function et(c){const t=await Y(c);let e={},n=new Set,i=null;for(const o of t.split(`
`)){const a=o.trim();if(!(a.length===0||a.startsWith("#"))){if(a.startsWith("[")&&a.endsWith("]")){const l=a.slice(1,-1),r=parseInt(l,10);if(isNaN(r)||r<10){i=null;continue}if(n.has(r)){console.warn(`[Loader] Duplicate ID found: ${r}. Ignoring.`),i=null;continue}n.add(r),i=r,e[r]={};continue}if(i!==null){const l=a.split(":").map(r=>r.trim());if(l.length===2){const r=l[0],d=l[1],h=e[i];switch(r){case"name":h.name=d;break;case"category":h.category=parseInt(d,10);break;case"base_color":h.base_color=d;break;case"variant_color":h.variant_color=d;break;case"is_movable":h.is_movable=d==="true";break;case"density":h.density=parseFloat(d);break;case"max_concentration":h.max_concentration=parseInt(d);break;case"repose_angle":h.repose_angle=parseFloat(d);break}}}}}const s={};for(const o in e){const a=e[o],l=parseInt(o,10);if(a.name===void 0||a.category===void 0||a.base_color===void 0||a.variant_color===void 0||a.is_movable===void 0||a.density===void 0){console.warn(`[Loader] Corrupted particle block found of ID: ${l}. Missing core properties.`);continue}let r={id:l,name:a.name,baseColor:a.base_color,variantColor:a.variant_color,isMovable:a.is_movable,density:a.density};a.category===1?s[l]={...r,category:1}:a.category===2?s[l]={...r,maxConcentration:a.max_concentration,category:2}:a.category===3?s[l]={...r,category:3}:a.category===4?s[l]={...r,category:4,reposeAngle:a.repose_angle,reposeDirections:N.calculateRepose(a.repose_angle)}:a.category===5&&(s[l]={...r,category:5})}return s[0]={id:0,name:"Empty",category:0,baseColor:"#0E0E11",variantColor:"#0E0E11",isMovable:!0,density:0},s}async function nt(c){const t=await Y(c),e={},n=t.split(/\r?\n/);for(const i of n){const s=i.trim();if(s.length===0||s.startsWith("#"))continue;const o=s.indexOf("."),a=s.indexOf(":");if(a===-1||o===-1||o>=a)continue;const l=s.substring(0,o).trim(),r=s.substring(o+1,a).trim(),d=s.substring(a+1).trim();if(!l||!r||d===void 0||d.length===0)continue;let h;if(l==="engine")switch(r){case"width":h=parseInt(d),isNaN(h)||(e.gameWidth=h);break;case"height":h=parseInt(d),isNaN(h)||(e.gameHeight=h);break;case"render_interval":h=parseFloat(d),isNaN(h)||(e.renderInterval=h);break;case"physics_interval":h=parseFloat(d),isNaN(h)||(e.physicsInterval=h);break}else if(l==="input")switch(r){case"brush_size":h=parseInt(d),isNaN(h)||(e.brushSize=h);break;case"brush_max_size":h=parseInt(d),isNaN(h)||(e.brushMaxSize=h);break;case"brush_sensitivity":h=parseFloat(d),isNaN(h)||(e.brushSensitivity=h);break}else if(l==="debug")switch(r){case"start_enabled":d.toLowerCase()==="true"?e.debugEnabled=!0:d.toLowerCase()==="false"&&(e.debugEnabled=!1);break;case"overlay_start_enabled":d.toLowerCase()==="true"?e.debugOverlayEnabled=!0:d.toLowerCase()==="false"&&(e.debugOverlayEnabled=!1);break}}return{gameWidth:e.gameWidth??342,gameHeight:e.gameHeight??192,renderInterval:e.renderInterval??16.667,physicsInterval:e.physicsInterval??25,brushSize:e.brushSize??4,brushMaxSize:e.brushMaxSize??42,brushSensitivity:e.brushSensitivity??.02,debugEnabled:e.debugEnabled??!1,debugOverlayEnabled:e.debugOverlayEnabled??!1}}class it{constructor(t,e){this.debugInstance=null,this.mouseX=0,this.mouseY=0,this.isLeftMouseButtonDown=!1,this.isRightMouseButtonDown=!1,this.isBrushOutlineVisible=!0,this.gameWidth=t.gameWidth,this.gameHeight=t.gameHeight,this.particleData=e,this.brushMaxSize=t.brushMaxSize,this.brushSensitivity=t.brushSensitivity,this.selectedParticleId=0,this.selectedCategoryId=2,this.renderInterval=t.renderInterval,this.physicsInterval=t.physicsInterval,this.currentBrushSize=t.brushSize}}async function st(){try{const c=G("viewport",HTMLDivElement),t=G("render-surface",HTMLCanvasElement),e=await et("./src/data/particles.data");if(!e)throw new Error('Failed to load particle data from "./src/data/particles.data"');const n=await nt("./src/data/settings.data");if(!n)throw new Error('Failed to load settings from "./src/data/settings.data"');const i=new it(n,e),s=new V(i,t),o=new J(i,c,t),a=new tt(i,c);a.enableDebug(!1),i.debugInstance=a,new j(i,s,o,a).start()}catch(c){console.error("ERROR: Failed to initialize app:",c)}}function G(c,t){const e=document.getElementById(c);if(!(e instanceof t))throw new Error(`Missing or invalid <${t.name.toLowerCase()} id='${c}'> element in DOM.`);return e}st();
