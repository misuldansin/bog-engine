var zt=c=>{throw TypeError(c)};var Gt=(c,t,e)=>t.has(c)||zt("Cannot "+e);var i=(c,t,e)=>(Gt(c,t,"read from private field"),e?e.call(c):t.get(c)),d=(c,t,e)=>t.has(c)?zt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(c):t.set(c,e),a=(c,t,e,n)=>(Gt(c,t,"write to private field"),n?n.call(c,e):t.set(c,e),e),y=(c,t,e)=>(Gt(c,t,"access private method"),e);var Xt=(c,t,e,n)=>({set _(s){a(c,t,s,e)},get _(){return i(c,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const Ft={GAME_WIDTH:244,GAME_HEIGHT:192,SELECTED_PARTICLE:10,SELECTED_CATEGORY:1,BRUSH_MAX_SIZE:42,BRUSH_CUR_SIZE:4,BRUSH_SENSITIVITY:.02,CURRENT_PRESSURE:0,CURRENT_CONCENTRATION:1,DEBUG_START_ENABLED:!0,DEBUG_OVERLAY_START_ENABLED:!1,RENDER_UPDATE_INTERVAL:16.667,PHYSICS_UPDATE_INTERVAL:25},Wt={lerp(c,t,e){return c+(t-c)*e},shuffleArray(c){const t=[...c];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t},calculateRepose(c){let t=Math.max(10,Math.min(c,80));const e=t*Math.PI/180;let n=[];if(n.push([{dx:0,dy:-1}]),t<50){n.push([{dx:1,dy:-1},{dx:-1,dy:-1}]);const s=Math.round(1/Math.tan(e));n.push([{dx:s,dy:-1},{dx:s*-1,dy:-1}])}else{const s=Math.round(Math.tan(e));n.push([{dx:1,dy:-s},{dx:-1,dy:-s}])}return n}};async function he(c){try{const t=await fetch(c);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return await t.text()}catch(t){throw console.error(`Failed to read particle data from ${c}:`,t),new Error("Failed to load particle data.")}}async function de(c){const t=await he(c);let e={},n=new Set,s=null;for(const r of t.split(`
`)){const l=r.trim();if(!(l.length===0||l.startsWith("#"))){if(l.startsWith("[")&&l.endsWith("]")){const u=l.slice(1,-1),h=parseInt(u,10);if(isNaN(h)||h<10){s=null;continue}if(n.has(h)){console.warn(`[Loader] Duplicate ID found: ${h}. Ignoring.`),s=null;continue}n.add(h),s=h,e[h]={};continue}if(s!==null){const u=l.split(":").map(h=>h.trim());if(u.length===2){const h=u[0],p=u[1],f=e[s];switch(h){case"name":f.name=p;break;case"category":f.category=parseInt(p,10);break;case"base_color":f.base_color=p;break;case"variant_color":f.variant_color=p;break;case"is_movable":f.is_movable=p==="true";break;case"density":f.density=parseFloat(p);break;case"max_concentration":f.max_concentration=parseInt(p);break;case"repose_angle":f.repose_angle=parseFloat(p);break}}}}}const o={};for(const r in e){const l=e[r],u=parseInt(r,10);if(l.name===void 0||l.category===void 0||l.base_color===void 0||l.variant_color===void 0||l.is_movable===void 0||l.density===void 0){console.warn(`[Loader] Corrupted particle block found of ID: ${u}. Missing core properties.`);continue}let h={id:u,name:l.name,baseColor:l.base_color,variantColor:l.variant_color,isMovable:l.is_movable,density:l.density};l.category===1?o[u]={...h,category:1}:l.category===2?o[u]={...h,maxConcentration:l.max_concentration,category:2}:l.category===3?o[u]={...h,category:3}:l.category===4?o[u]={...h,category:4,reposeAngle:l.repose_angle,reposeDirections:Wt.calculateRepose(l.repose_angle)}:l.category===5&&(o[u]={...h,category:5})}return o[0]={id:0,name:"Empty",category:0,baseColor:"#0E0E11",variantColor:"#0E0E11",isMovable:!0,density:0},o}var Y,k,H,U,B,Q,W,Z,jt,Kt,Zt;class ue{constructor(t,e){d(this,Z);d(this,Y);d(this,k);d(this,H);d(this,U);d(this,B);d(this,Q);d(this,W);a(this,Y,t),a(this,k,i(this,Y).getContext("2d")),a(this,H,e.GAME_WIDTH),a(this,U,e.GAME_HEIGHT),a(this,B,new Uint8ClampedArray(i(this,H)*i(this,U)*4)),a(this,Q,[]),a(this,W,new Map),i(this,Y).width=i(this,H),i(this,Y).height=i(this,U),i(this,k).imageSmoothingEnabled=!1,i(this,k).translate(0,i(this,Y).height),i(this,k).scale(1,-1)}queueParticles(t,e){if(i(this,Q).push(...t),e){const n=i(this,H),s=i(this,U);for(const o of t){const l=(s-1-o.position.y)*n+o.position.x;i(this,W).set(l,e)}}}queueOverlayPixels(t){for(const e of t)i(this,W).set(e.index,e.value)}renderThisFrame(){y(this,Z,jt).call(this);let t=new Uint8ClampedArray(i(this,B));y(this,Z,Zt).call(this,t);const e=new ImageData(t,i(this,H),i(this,U));i(this,k).putImageData(e,0,0),i(this,Q).length=0,i(this,W).clear()}}Y=new WeakMap,k=new WeakMap,H=new WeakMap,U=new WeakMap,B=new WeakMap,Q=new WeakMap,W=new WeakMap,Z=new WeakSet,jt=function(){const t=i(this,Q),e=i(this,H),n=i(this,U);for(const s of t){const o=s.position.x,r=s.position.y,u=(n-1-r)*e+o;let h=y(this,Z,Kt).call(this,s);i(this,B)[u*4+0]=h[0],i(this,B)[u*4+1]=h[1],i(this,B)[u*4+2]=h[2],i(this,B)[u*4+3]=h[3]}},Kt=function(t){return t.color},Zt=function(t){const e=i(this,W);if(e.size!==0)for(const[n,s]of e){const o=t[n*4+0],r=t[n*4+1],l=t[n*4+2],u=t[n*4+3],h=s[0],p=s[1],f=s[2],g=s[3],E=g/255,I=Math.round(h*E+o*(1-E)),D=Math.round(p*E+r*(1-E)),R=Math.round(f*E+l*(1-E)),q=Math.min(u,g);t[n*4+0]=I,t[n*4+1]=D,t[n*4+2]=R,t[n*4+3]=q}};const Vt=Object.freeze({WHITE:new Uint8ClampedArray([255,255,255,255]),BLACK:new Uint8ClampedArray([0,0,0,255]),GRAY:new Uint8ClampedArray([128,128,128,255]),RED:new Uint8ClampedArray([255,0,0,255]),GREEN:new Uint8ClampedArray([0,255,0,255]),BLUE:new Uint8ClampedArray([0,0,255,255]),YELLOW:new Uint8ClampedArray([255,255,0,255]),CYAN:new Uint8ClampedArray([0,255,255,255]),MAGENTA:new Uint8ClampedArray([255,0,255,255]),TRANSPARENT_BLACK:new Uint8ClampedArray([0,0,0,0]),SEMI_TRANSPARENT_WHITE:new Uint8ClampedArray([255,255,255,128])}),ct={createColor(c){return this.hexToColor(c)},hexToColor(c){if(c==null)return Vt.BLACK;let t=c.replace("#","");if(t.length===6)t+="FF";else if(t.length===3){let n="";for(const s of t)n+=s,n+=s;t=n+"FF"}else return Vt.BLACK;const e=parseInt(t,16);return new Uint8ClampedArray([e>>24&255,e>>16&255,e>>8&255,e&255])},colorToHex(c){const[t,e,n,s]=c,o=r=>r.toString(16).padStart(2,"0");return`#${o(t)}${o(e)}${o(n)}${o(s)}`},lerpColor(c,t,e){const n=c[0]+(t[0]-c[0])*e,s=c[1]+(t[1]-c[1])*e,o=c[2]+(t[2]-c[2])*e,r=c[3]+(t[3]-c[3])*e;return new Uint8ClampedArray([n,s,o,r])},createColorRamp(c,t,e){if(e<2)return[c,t];const n=1/(e-1),s=new Array(e);for(let o=0;o<e;o++){const r=o*n;s[o]=this.lerpColor(c,t,r)}return s},invertColor(c){const t=255-c[0],e=255-c[1],n=255-c[2],s=c[3];return new Uint8ClampedArray([t,e,n,s])},getLuminance(c){const t=c[0],e=c[1],n=c[2];return .299*t+.587*e+.114*n}},pe=Object.freeze({ALL_NEIGHBORS:[{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}]}),Tt=Object.freeze({UP_LEFT:{dx:-1,dy:1},UP:{dx:0,dy:1},UP_RIGHT:{dx:1,dy:1},LEFT:{dx:-1,dy:0},RIGHT:{dx:1,dy:0},DOWN_LEFT:{dx:-1,dy:-1},DOWN:{dx:0,dy:-1},DOWN_RIGHT:{dx:1,dy:-1}});var b,z,nt,qt,Jt;class fe{constructor(t,e,n){d(this,nt);d(this,b);d(this,z);this.width=t,this.height=e,a(this,b,new Array(t*e)),a(this,z,new Set),this.ParticleDataBlueprint=n,y(this,nt,Jt).call(this,0)}get data(){return i(this,b)}get dirtyParticles(){return i(this,z)}createParticleAt(t,e,n,s,o){if(!this.isInBounds(t,e))return!1;let r=y(this,nt,qt).call(this,n);return r.position.x=t,r.position.y=e,r.index=e*this.width+t,s&&this.markDirty(r,o),i(this,b)[e*this.width+t]=r,!0}getParticleAt(t,e){return this.isInBounds(t,e)?i(this,b)[e*this.width+t]:null}tryMoveParticle(t,e,n=!1,s=!1,o=!1){for(const r of e){if(!r)continue;const l=Wt.shuffleArray(r);for(const u of l){let h=u.dx;n&&Math.random()>.5&&(h=u.dx*-1);const p=t.position.x+h,f=t.position.y+u.dy,g=this.getParticleAt(p,f);if(g&&g.isMovable&&t.density>g.density){i(this,b)[g.index]=t,i(this,b)[t.index]=g;const E={x:t.position.x,y:t.position.y},I=t.index;return t.position=g.position,t.index=g.index,g.position=E,g.index=I,s&&(this.markDirty(t,o),this.markDirty(g,o)),g}}}return null}swapParticles(t,e,n,s){i(this,b)[t.index]=e,i(this,b)[e.index]=t;const o={x:t.position.x,y:t.position.y},r=t.index;t.position=e.position,t.index=e.index,e.position=o,e.index=r,n&&(this.markDirty(t,s),this.markDirty(e,s))}getNeighborOf(t,e){const n=t.position.x+e.dx,s=t.position.y+e.dy;return this.getParticleAt(n,s)}getNeighborsOf(t,e,n,s){return e.map(r=>this.getNeighborOf(t,r)).filter(r=>r!==null).filter(r=>{const l=n===void 0||r.category===n,u=s===void 0||r.id===s;return l&&u})}markDirty(t,e){if(i(this,z).add(t.index),e){const n=this.getNeighborsOf(t,pe.ALL_NEIGHBORS);for(const s of n)i(this,z).add(s.index)}}isInBounds(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}fillCircleAt(t,e,n,s){for(let o=-n;o<=n;o++)for(let r=-n;r<=n;r++){if(o*o+r*r>n*n)continue;const l=t+o,u=e+r;if(!this.isInBounds(l,u))continue;const h=this.getParticleAt(l,u);(s===0||h===null||h.id===0)&&this.createParticleAt(l,u,s,!0,!0)}}}b=new WeakMap,z=new WeakMap,nt=new WeakSet,qt=function(t){const e=this.ParticleDataBlueprint[t];if(!e)return null;let s=Math.random(),r=6-1,l=Math.round(s*r)/r;const u=ct.hexToColor(e.baseColor),h=ct.hexToColor(e.variantColor),p=ct.lerpColor(u,h,l);let f={handle:-1,id:e.id,name:e.name,color:p,position:{x:-1,y:-1},index:0,isMovable:e.isMovable,density:e.density};return e.category===0?{...f,category:0}:e.category===1?{...f,category:1}:e.category===2?{...f,category:2,concentration:0,maxConcentration:e.maxConcentration}:e.category===3?{...f,category:3}:e.category===4?{...f,category:4,reposeAngle:e.reposeAngle,reposeDirections:e.reposeDirections}:e.category===5?{...f,category:5,node:-1}:null},Jt=function(t){const e=this.width,n=this.height;a(this,b,new Array(e*n));for(let s=0;s<n;s++)for(let o=0;o<e;o++){let r=s*e+o,l=y(this,nt,qt).call(this,t);l&&(l.position.x=o,l.position.y=s,l.index=r,i(this,b)[r]=l,i(this,z).add(l.index))}};const $t=Object.keys(Tt);var tt,mt,Et,xt,Ct,v,P,X,G,Mt,lt,V,$,ht,A,Qt,te,ee,ie,se;class ge{constructor(t,e,n,s,o){d(this,A);d(this,tt);d(this,mt);d(this,Et);d(this,xt);d(this,Ct);d(this,v);d(this,P);d(this,X);d(this,G);d(this,Mt);d(this,lt);d(this,V);d(this,$);d(this,ht,t=>{if(!i(this,X))return;if(!i(this,V)){a(this,V,t),a(this,G,requestAnimationFrame(i(this,ht)));return}const e=t-i(this,V);a(this,V,t),i(this,mt).processInput(i(this,v),i(this,tt)),a(this,$,i(this,$)+e);let n=0;for(;i(this,$)>=i(this,lt);){const s=[];for(const o of i(this,v).dirtyParticles)s.push(i(this,v).data[o]);i(this,v).dirtyParticles.clear(),i(this,tt).queueParticles(s),y(this,A,Qt).call(this,s),this.tickCount++,a(this,$,i(this,$)-i(this,lt)),n++,n>60&&a(this,$,0)}i(this,tt).renderThisFrame(),i(this,Et).updateDisplay(t,this),a(this,G,requestAnimationFrame(i(this,ht)))});a(this,tt,n),a(this,mt,s),a(this,Et,o),a(this,xt,e.GAME_WIDTH),a(this,Ct,e.GAME_HEIGHT),a(this,v,new fe(i(this,xt),i(this,Ct),t)),a(this,P,new Set),a(this,X,!1),a(this,G,null),a(this,Mt,Ft.RENDER_UPDATE_INTERVAL),a(this,lt,Ft.PHYSICS_UPDATE_INTERVAL),a(this,V,null),a(this,$,0),this.tickCount=0}start(){i(this,X)||(a(this,X,!0),i(this,ht).call(this,0))}stop(){a(this,X,!1),i(this,G)&&(cancelAnimationFrame(i(this,G)),a(this,G,null))}groupParticles(t,e){const n=t.width,s=t.height,o=[],r=[],l={};for(let h=s-1;h>=0;h--)for(let p=0;p<n;p++){const f=h*n+p,g=t.getParticleAt(p,h);if(!g||g.category!==e||g.category!==e)continue;const E=t.getNeighborOf(g,Tt.UP),I=t.getNeighborOf(g,Tt.LEFT),D=E&&E.id===g.id,R=I&&I.id===g.id;let q=-1;R&&(q=h*n+(p-1));let ot=-1;D&&(ot=(h+1)*n+p);const J=E&&E.id===0;if(!R&&!D){const m=r.length;o.push([f]),r.push({liquidParticle:[],emptyParticle:[]}),J&&(r[m].liquidParticle.push(g),r[m].emptyParticle.push(E)),l[f]=m}else if(R&&!D){const m=l[q];o[m].push(f),J&&(r[m].liquidParticle.push(g),r[m].emptyParticle.push(E)),l[f]=m}else if(!R&&D){const m=l[ot];o[m].push(f),J&&(r[m].liquidParticle.push(g),r[m].emptyParticle.push(E)),l[f]=m}else{const m=l[ot];o[m].push(f),J&&(r[m].liquidParticle.push(g),r[m].emptyParticle.push(E)),l[f]=m;const N=l[q];if(N!==m){const rt=r[N];for(const O of rt.liquidParticle)r[m].liquidParticle.push(O);for(const O of rt.emptyParticle)r[m].emptyParticle.push(O);const yt=o[N];for(const O of yt)l[O]=m;o[N]=[],r[N]={liquidParticle:[],emptyParticle:[]}}}}return r.filter(h=>h.liquidParticle.length>30)}}tt=new WeakMap,mt=new WeakMap,Et=new WeakMap,xt=new WeakMap,Ct=new WeakMap,v=new WeakMap,P=new WeakMap,X=new WeakMap,G=new WeakMap,Mt=new WeakMap,lt=new WeakMap,V=new WeakMap,$=new WeakMap,ht=new WeakMap,A=new WeakSet,Qt=function(t){i(this,P).clear(),t=Wt.shuffleArray(t),t.sort((n,s)=>n.position.y-s.position.y);for(const n of t)if(n&&!i(this,P).has(n.index))switch(n.category){case 1:break;case 2:y(this,A,te).call(this,n);break;case 3:y(this,A,ee).call(this,n);break;case 4:y(this,A,ie).call(this,n);break;case 5:break;default:continue}let e=this.groupParticles(i(this,v),2);y(this,A,se).call(this,e)},te=function(t){let e=[[{dx:0,dy:-1}],[{dx:-1,dy:-1},{dx:1,dy:-1}],[{dx:-1,dy:0},{dx:1,dy:0}]];const n=i(this,v).tryMoveParticle(t,e,!1,!0,!0);n&&(i(this,P).add(t.index),i(this,P).add(n.index))},ee=function(t){const e=$t[Math.floor(Math.random()*$t.length)];let s=[[Tt[e]]];const o=i(this,v).tryMoveParticle(t,s,!1,!0,!0);o&&(i(this,P).add(t.index),i(this,P).add(o.index))},ie=function(t){let e=t.reposeDirections;const n=i(this,v).tryMoveParticle(t,e,!0,!0,!0);n&&(i(this,P).add(t.index),i(this,P).add(n.index))},se=function(t){for(const e of t){const n=e.liquidParticle.sort((u,h)=>h.position.y-u.position.y),s=e.emptyParticle.sort((u,h)=>u.position.y-h.position.y),o=n.length;let r=0;const l=o/4;for(let u=0;u<o;u++){const h=n[u],p=s[u];if(Math.sqrt(h.position.x*p.position.x+h.position.y*p.position.y),h.position.y>p.position.y&&(i(this,v).swapParticles(h,p,!0,!0),i(this,P).add(h.index),i(this,P).add(p.index),r++,r>=l))break}}};var At,j,et,Pt,w,K,It,bt,F,T,M,_t,Dt,L,C,_,x,ne,Yt,kt,oe,at,re,ae,Lt,St,Rt,vt,wt,Nt,Ot,Ht,Ut,Bt;class ye{constructor(t,e,n,s,o){d(this,x);d(this,At);d(this,j);d(this,et);d(this,Pt);d(this,w);d(this,K);d(this,It);d(this,bt);d(this,F);d(this,T);d(this,M);d(this,_t);d(this,Dt);d(this,L);d(this,C);d(this,_);d(this,Lt,t=>{a(this,_,t.pointerId),t.button===0?(this.isPainting=!0,this.isErasing=!1,this.activeButton="left"):t.button===2?(this.isErasing=!0,this.isPainting=!1,this.activeButton="right"):(this.isPainting=!1,this.isErasing=!1,this.activeButton="none");try{i(this,w).setPointerCapture(t.pointerId)}catch{}const e=i(this,w).getBoundingClientRect(),n=i(this,j)/e.width,s=i(this,et)/e.height;this.latestMouseCoords.x=(t.clientX-e.left)*n,this.latestMouseCoords.y=i(this,w).height-(t.clientY-e.top)*s});d(this,St,t=>{if(i(this,_)===t.pointerId){a(this,_,null),this.activeButton="none";try{i(this,w).releasePointerCapture(t.pointerId)}catch{}}this.isPainting=!1,this.isErasing=!1});d(this,Rt,t=>{const e=i(this,w).getBoundingClientRect(),n=i(this,j)/e.width,s=i(this,w).height/e.height;if(this.latestMouseCoords.x=(t.clientX-e.left)*n,this.latestMouseCoords.y=i(this,w).height-(t.clientY-e.top)*s,typeof t.buttons=="number"){const o=(t.buttons&1)===1,r=(t.buttons&2)===2;this.isPainting=o,this.isErasing=r}});d(this,vt,t=>{if(this.isPainting=!1,this.isErasing=!1,i(this,_)===t.pointerId){try{i(this,w).releasePointerCapture(t.pointerId)}catch{}a(this,_,null),this.activeButton="none"}});d(this,wt,()=>{this.isPainting=!1,this.isErasing=!1,a(this,_,null),this.activeButton="none"});d(this,Nt,()=>{document.hidden&&(this.isPainting=!1,this.isErasing=!1,a(this,_,null),this.activeButton="none")});d(this,Ot,t=>{t.preventDefault(),this.shouldChangeBrushSize=!0,this.changeBrushSizeDir=t.deltaY});d(this,Ht,t=>{t.preventDefault()});d(this,Ut,t=>{this.isDrawingOverlay=!0});d(this,Bt,t=>{this.isDrawingOverlay=!1});a(this,At,o),a(this,j,s.GAME_WIDTH),a(this,et,s.GAME_HEIGHT),a(this,Pt,e),a(this,w,n),a(this,K,t),a(this,It,s.BRUSH_SENSITIVITY),a(this,bt,s.BRUSH_MAX_SIZE),a(this,F,s.SELECTED_PARTICLE),a(this,T,s.SELECTED_CATEGORY),a(this,M,s.BRUSH_CUR_SIZE),a(this,_t,s.CURRENT_PRESSURE),a(this,Dt,s.CURRENT_CONCENTRATION),a(this,L,null),a(this,C,null),a(this,_,null),this.isPainting=!1,this.isErasing=!1,this.isDrawingOverlay=!0,this.shouldChangeBrushSize=!1,this.changeBrushSizeDir=0,this.latestMouseCoords={x:0,y:0},this.activeButton="none";const r=document.getElementById("particle-category-bar");if(!r)throw new Error("DOM element of id 'particle-category-bar' does not exist.");y(this,x,oe).call(this,r);const l=document.getElementById("particle-button-container");if(!l)throw new Error("DOM element of id 'particle-button-container' does not exist.");y(this,x,re).call(this,l),y(this,x,ae).call(this),i(this,C)&&y(this,x,Yt).call(this,i(this,C))}processInput(t,e){const n=this.latestMouseCoords.x,s=this.latestMouseCoords.y,o={x:Math.floor(n),y:Math.floor(s)};if(this.isDrawingOverlay){const r=y(this,x,ne).call(this,o.x,o.y);e.queueOverlayPixels(r)}if(this.isPainting||this.isErasing){const r=o.x<i(this,j)+i(this,M)&&o.x>=0-i(this,M),l=o.y<i(this,et)+i(this,M)&&o.y>=0-i(this,M);if(r&&l){const u=o.x,h=o.y,p=this.isPainting?i(this,F):0;t.fillCircleAt(u,h-1,i(this,M),p)}}if(this.shouldChangeBrushSize){const r=this.changeBrushSizeDir*i(this,It);let l=i(this,M)-r;l=Math.floor(l),l=Math.min(i(this,bt),l),l=Math.max(0,l),a(this,M,l),this.changeBrushSizeDir=0}}}At=new WeakMap,j=new WeakMap,et=new WeakMap,Pt=new WeakMap,w=new WeakMap,K=new WeakMap,It=new WeakMap,bt=new WeakMap,F=new WeakMap,T=new WeakMap,M=new WeakMap,_t=new WeakMap,Dt=new WeakMap,L=new WeakMap,C=new WeakMap,_=new WeakMap,x=new WeakSet,ne=function(t,e){const n=i(this,M),s=[],o=227,r=227,l=227,u=180,h=i(this,j),p=i(this,et),f=[-1,1],g=(R,q)=>{for(const ot of f)for(const J of f){const m=t+R*J,N=e+q*ot,rt=t+q*J,yt=e+R*ot;if(m>=0&&m<h&&N>=0&&N<p){const O=(p-N)*h+m;s.push({index:O,value:new Uint8ClampedArray([o,r,l,u])})}if(rt>=0&&rt<h&&yt>=0&&yt<p){const O=(p-yt)*h+rt;s.push({index:O,value:new Uint8ClampedArray([o,r,l,u])})}}};let E=n,I=0,D=n-n;for(g(E,I);I<E;)I++,D<0?D+=2*I+1:(E--,D+=2*(I-E)+1),g(E,I);return s},Yt=function(t){i(this,C)&&i(this,C).classList.remove("selected"),t.classList.add("selected"),a(this,C,t);const e=parseInt(t.dataset.categoryId);a(this,T,e||1);let n=null;if(i(this,K)[i(this,F)]!==void 0){const s=i(this,K)[i(this,F)];s&&s.category===i(this,T)&&i(this,L)&&(n=i(this,L))}document.querySelectorAll(".particle-button").forEach(s=>{const o=s,r=o.dataset.category;r&&parseInt(r)===i(this,T)?(o.style.display="",n||(n=o)):o.style.display="none"}),y(this,x,kt).call(this,n)},kt=function(t){if(!t)return;i(this,L)&&i(this,L).classList.remove("selected"),t.classList.add("selected"),a(this,L,t);const e=parseInt(t.dataset.particleId);a(this,F,e||0)},oe=function(t){t.innerHTML="";let e=y(this,x,at).call(this,1,"Solids","./assets/icons/solid.svg");t.appendChild(e),i(this,T)==1&&a(this,C,e);let n=y(this,x,at).call(this,2,"Liquids","./assets/icons/liquid.svg");t.appendChild(n),i(this,T)==2&&a(this,C,n);let s=y(this,x,at).call(this,3,"Gases","./assets/icons/gas.svg");t.appendChild(s),i(this,T)==3&&a(this,C,s);let o=y(this,x,at).call(this,4,"Sands","./assets/icons/sand.svg");t.appendChild(o),i(this,T)==4&&a(this,C,o);let r=y(this,x,at).call(this,5,"Electronics","./assets/icons/electronics.svg");t.appendChild(r),i(this,T)==5&&a(this,C,r),i(this,C)||a(this,C,o)},at=function(t,e,n){const s=document.createElement("button");s.className="category-button";const o=document.createElement("img");return o.src=n,o.alt=e,o.classList.add("category-icon"),s.dataset.categoryId=t.toString(),s.appendChild(o),s},re=function(t){t.innerHTML="";for(const e in i(this,K)){const n=i(this,K)[e];if(!n)continue;const s=document.createElement("button");s.className="particle-button",s.textContent=n.name;const o=n.baseColor,r=n.variantColor,u=ct.getLuminance(ct.hexToColor(o))>210?"#323238":"#FFFFFFFF",h=ct.hexToColor(u);s.style.setProperty("--particle-button-base-color",o),s.style.setProperty("--particle-button-variant-color",r),s.style.color=u,s.style.textShadow=`1px 1px 2px rgba(${h[0]}, ${h[1]}, ${h[2]}, 0.6)`,s.dataset.particleId=n.id.toString(),s.dataset.category=n.category.toString(),t.appendChild(s),n.id===i(this,F)&&a(this,L,s)}},ae=function(){const t=i(this,w),e=document.getElementById("particle-category-bar"),n=document.getElementById("particle-button-container");if(!e||!n)throw new Error("Cannot find category bar and/ or button container");t.addEventListener("pointerdown",i(this,Lt)),t.addEventListener("pointermove",i(this,Rt)),t.addEventListener("pointerup",i(this,St)),t.addEventListener("pointercancel",i(this,vt)),t.addEventListener("lostpointercapture",i(this,vt)),t.addEventListener("pointerenter",i(this,Ut)),t.addEventListener("pointerleave",i(this,Bt)),t.addEventListener("wheel",i(this,Ot),{passive:!1}),i(this,Pt).addEventListener("contextmenu",i(this,Ht)),window.addEventListener("pointerup",i(this,wt)),window.addEventListener("mouseup",i(this,wt)),document.addEventListener("visibilitychange",i(this,Nt)),e.addEventListener("click",s=>{if(!s.target)return;const r=s.target.closest(".category-button");r&&r&&y(this,x,Yt).call(this,r)}),n.addEventListener("click",s=>{if(!s.target)return;const r=s.target.closest(".particle-button");r&&y(this,x,kt).call(this,r)})},Lt=new WeakMap,St=new WeakMap,Rt=new WeakMap,vt=new WeakMap,wt=new WeakMap,Nt=new WeakMap,Ot=new WeakMap,Ht=new WeakMap,Ut=new WeakMap,Bt=new WeakMap;var it,dt,S,st,ut,pt,ft,gt,ce,le;class me{constructor(t){d(this,gt);d(this,it);d(this,dt);d(this,S);d(this,st);d(this,ut);d(this,pt);d(this,ft);a(this,it,!1),a(this,dt,!1),a(this,S,new Map),a(this,st,0),a(this,ut,0),a(this,pt,0),a(this,ft,0),y(this,gt,le).call(this,t)}enableDebug(t){a(this,it,!0),t&&a(this,dt,!0)}disableDebug(){a(this,it,!1),a(this,dt,!1)}updateDisplay(t,e){if(!i(this,it))return;y(this,gt,ce).call(this,t,e);const n=i(this,S).get("fps");n&&(n.textContent=`FPS: ${i(this,ut).toFixed(2)}`);const s=i(this,S).get("tps");s&&(s.textContent=`TPS: ${i(this,pt).toFixed(2)}`)}}it=new WeakMap,dt=new WeakMap,S=new WeakMap,st=new WeakMap,ut=new WeakMap,pt=new WeakMap,ft=new WeakMap,gt=new WeakSet,ce=function(t,e){const n=t-i(this,ft);n>=1e3&&(a(this,ut,i(this,st)*1e3/n),a(this,pt,e.tickCount*1e3/n),a(this,st,0),e.tickCount=0,a(this,ft,t)),Xt(this,st)._++},le=function(t){const e=document.createElement("div");e.classList.add("debug-container"),t.appendChild(e),i(this,S).set("debug-container",e);const n=document.createElement("div");n.classList.add("debug-info-container"),e.appendChild(n),i(this,S).set("info-container",n);const s=document.createElement("div");s.classList.add("debug-info"),n.appendChild(s),i(this,S).set("fps",s);const o=document.createElement("div");o.classList.add("debug-info"),n.appendChild(o),i(this,S).set("tps",o)};async function Ee(){try{let c=Ft;const t=400,e=40,n=1e3,s=4;c.GAME_WIDTH=Math.max(e,Math.min(t,c.GAME_WIDTH)),c.GAME_HEIGHT=Math.max(e,Math.min(t,c.GAME_HEIGHT)),c.PHYSICS_UPDATE_INTERVAL=Math.max(s,Math.min(n,c.PHYSICS_UPDATE_INTERVAL)),Object.freeze(c);const o=document.getElementById("main-canvas");if(!(o instanceof HTMLCanvasElement))throw new Error("HTML element 'main-canvas' does not exist.");const r=document.getElementById("main-panel");if(!(r instanceof HTMLDivElement))throw new Error("HTML element 'main-panel' does not exist.");const l=new ue(o,c),u=await de("./src/data/particles.data"),h=new ye(u,r,o,c,l),p=new me(r);p.enableDebug(!0),new ge(u,c,l,h,p).start(),console.log(u)}catch(c){console.error("CRITICAL ERROR: Failed to initialize engine due to data loading failure.",c)}}Ee();
