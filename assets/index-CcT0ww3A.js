var vt=h=>{throw TypeError(h)};var gt=(h,t,e)=>t.has(h)||vt("Cannot "+e);var c=(h,t,e)=>(gt(h,t,"read from private field"),e?e.call(h):t.get(h)),_=(h,t,e)=>t.has(h)?vt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e),p=(h,t,e,n)=>(gt(h,t,"write to private field"),n?n.call(h,e):t.set(h,e),e),x=(h,t,e)=>(gt(h,t,"access private method"),e);var mt=(h,t,e,n)=>({set _(i){p(h,t,i,e)},get _(){return c(h,t,n)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const _t={GAME_WIDTH:244,GAME_HEIGHT:192,SELECTED_PARTICLE:10,SELECTED_CATEGORY:1,BRUSH_MAX_SIZE:42,BRUSH_CUR_SIZE:4,BRUSH_SENSITIVITY:.02,CURRENT_PRESSURE:0,CURRENT_CONCENTRATION:1,DEBUG_START_ENABLED:!0,DEBUG_OVERLAY_START_ENABLED:!1,RENDER_UPDATE_INTERVAL:16.667,PHYSICS_UPDATE_INTERVAL:25},Ct={lerp(h,t,e){return h+(t-h)*e},shuffleArray(h){const t=[...h];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t},calculateRepose(h){let t=Math.max(10,Math.min(h,80));const e=t*Math.PI/180;let n=[];if(n.push([{dx:0,dy:-1}]),t<50){n.push([{dx:1,dy:-1},{dx:-1,dy:-1}]);const i=Math.round(1/Math.tan(e));n.push([{dx:i,dy:-1},{dx:i*-1,dy:-1}])}else{const i=Math.round(Math.tan(e));n.push([{dx:1,dy:-i},{dx:-1,dy:-i}])}return n}};async function Nt(h){try{const t=await fetch(h);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return await t.text()}catch(t){throw console.error(`Failed to read particle data from ${h}:`,t),new Error("Failed to load particle data.")}}async function Ht(h){const t=await Nt(h);let e={},n=new Set,i=null;for(const s of t.split(`
`)){const r=s.trim();if(!(r.length===0||r.startsWith("#"))){if(r.startsWith("[")&&r.endsWith("]")){const d=r.slice(1,-1),a=parseInt(d,10);if(isNaN(a)||a<10){i=null;continue}if(n.has(a)){console.warn(`[Loader] Duplicate ID found: ${a}. Ignoring.`),i=null;continue}n.add(a),i=a,e[a]={};continue}if(i!==null){const d=r.split(":").map(a=>a.trim());if(d.length===2){const a=d[0],l=d[1],u=e[i];switch(a){case"name":u.name=l;break;case"category":u.category=parseInt(l,10);break;case"base_color":u.base_color=l;break;case"variant_color":u.variant_color=l;break;case"is_movable":u.is_movable=l==="true";break;case"density":u.density=parseFloat(l);break;case"max_concentration":u.max_concentration=parseInt(l);break;case"repose_angle":u.repose_angle=parseFloat(l);break}}}}}const o={};for(const s in e){const r=e[s],d=parseInt(s,10);if(r.name===void 0||r.category===void 0||r.base_color===void 0||r.variant_color===void 0||r.is_movable===void 0||r.density===void 0){console.warn(`[Loader] Corrupted particle block found of ID: ${d}. Missing core properties.`);continue}let a={id:d,name:r.name,baseColor:r.base_color,variantColor:r.variant_color,isMovable:r.is_movable,density:r.density};r.category===1?o[d]={...a,category:1}:r.category===2?o[d]={...a,maxConcentration:r.max_concentration,category:2}:r.category===3?o[d]={...a,category:3}:r.category===4?o[d]={...a,category:4,reposeAngle:r.repose_angle,reposeDirections:Ct.calculateRepose(r.repose_angle)}:r.category===5&&(o[d]={...a,category:5})}return o[0]={id:0,name:"Empty",category:0,baseColor:"#0E0E11",variantColor:"#0E0E11",isMovable:!0,density:0},o}var G,F,R,B,N,X,k,V,O,Lt,bt,yt;class Ot{constructor(t,e){_(this,O);_(this,G);_(this,F);_(this,R);_(this,B);_(this,N);_(this,X);_(this,k);_(this,V);p(this,G,t),p(this,F,c(this,G).getContext("2d")),p(this,R,e.GAME_WIDTH),p(this,B,e.GAME_HEIGHT),p(this,N,new Uint8ClampedArray(c(this,R)*c(this,B)*4)),p(this,X,[]),p(this,k,[]),p(this,V,[]),c(this,G).width=c(this,R),c(this,G).height=c(this,B),c(this,F).imageSmoothingEnabled=!1,c(this,F).translate(0,c(this,G).height),c(this,F).scale(1,-1)}queueUIPixels(t){p(this,V,[]),p(this,V,t)}queueParticles(t,e){if(c(this,X).push(...t),e){const n=c(this,R),i=c(this,B);for(const o of t){const r=(i-1-o.position.y)*n+o.position.x;c(this,k).push({index:r,value:e})}}}queueOverlayPixels(t){c(this,k).push(...t)}renderThisFrame(){x(this,O,Lt).call(this);let t=new Uint8ClampedArray(c(this,N));x(this,O,yt).call(this,t,c(this,k)),x(this,O,yt).call(this,t,c(this,V));const e=new ImageData(t,c(this,R),c(this,B));c(this,F).putImageData(e,0,0),c(this,X).length=0,p(this,k,[])}}G=new WeakMap,F=new WeakMap,R=new WeakMap,B=new WeakMap,N=new WeakMap,X=new WeakMap,k=new WeakMap,V=new WeakMap,O=new WeakSet,Lt=function(){const t=c(this,X),e=c(this,R),n=c(this,B);for(const i of t){const o=i.position.x,s=i.position.y,d=(n-1-s)*e+o;let a=x(this,O,bt).call(this,i);c(this,N)[d*4+0]=a[0],c(this,N)[d*4+1]=a[1],c(this,N)[d*4+2]=a[2],c(this,N)[d*4+3]=a[3]}},bt=function(t){return t.color},yt=function(t,e){for(const{index:n,value:i}of e){const o=t[n*4+0],s=t[n*4+1],r=t[n*4+2],d=t[n*4+3],a=i[0],l=i[1],u=i[2],g=i[3],m=g/255,w=Math.round(a*m+o*(1-m)),f=Math.round(l*m+s*(1-m)),y=Math.round(u*m+r*(1-m)),v=Math.min(d,g);t[n*4+0]=w,t[n*4+1]=f,t[n*4+2]=y,t[n*4+3]=v}};const xt=Object.freeze({WHITE:new Uint8ClampedArray([255,255,255,255]),BLACK:new Uint8ClampedArray([0,0,0,255]),GRAY:new Uint8ClampedArray([128,128,128,255]),RED:new Uint8ClampedArray([255,0,0,255]),GREEN:new Uint8ClampedArray([0,255,0,255]),BLUE:new Uint8ClampedArray([0,0,255,255]),YELLOW:new Uint8ClampedArray([255,255,0,255]),CYAN:new Uint8ClampedArray([0,255,255,255]),MAGENTA:new Uint8ClampedArray([255,0,255,255]),TRANSPARENT_BLACK:new Uint8ClampedArray([0,0,0,0]),SEMI_TRANSPARENT_WHITE:new Uint8ClampedArray([255,255,255,128])}),tt={createColor(h){return this.hexToColor(h)},hexToColor(h){if(h==null)return xt.BLACK;let t=h.replace("#","");if(t.length===6)t+="FF";else if(t.length===3){let n="";for(const i of t)n+=i,n+=i;t=n+"FF"}else return xt.BLACK;const e=parseInt(t,16);return new Uint8ClampedArray([e>>24&255,e>>16&255,e>>8&255,e&255])},colorToHex(h){const[t,e,n,i]=h,o=s=>s.toString(16).padStart(2,"0");return`#${o(t)}${o(e)}${o(n)}${o(i)}`},lerpColor(h,t,e){const n=h[0]+(t[0]-h[0])*e,i=h[1]+(t[1]-h[1])*e,o=h[2]+(t[2]-h[2])*e,s=h[3]+(t[3]-h[3])*e;return new Uint8ClampedArray([n,i,o,s])},createColorRamp(h,t,e){if(e<2)return[h,t];const n=1/(e-1),i=new Array(e);for(let o=0;o<e;o++){const s=o*n;i[o]=this.lerpColor(h,t,s)}return i},invertColor(h){const t=255-h[0],e=255-h[1],n=255-h[2],i=h[3];return new Uint8ClampedArray([t,e,n,i])},getLuminance(h){const t=h[0],e=h[1],n=h[2];return .299*t+.587*e+.114*n}},Ut=Object.freeze({ALL_NEIGHBORS:[{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}]}),ut=Object.freeze({UP_LEFT:{dx:-1,dy:1},UP:{dx:0,dy:1},UP_RIGHT:{dx:1,dy:1},LEFT:{dx:-1,dy:0},RIGHT:{dx:1,dy:0},DOWN_LEFT:{dx:-1,dy:-1},DOWN:{dx:0,dy:-1},DOWN_RIGHT:{dx:1,dy:-1}});var b,q,Q,wt,It;class Gt{constructor(t,e,n){_(this,Q);_(this,b);_(this,q);this.width=t,this.height=e,p(this,b,new Array(t*e)),p(this,q,new Set),this.ParticleDataBlueprint=n,x(this,Q,It).call(this,0)}get data(){return c(this,b)}get dirtyParticles(){return c(this,q)}createParticleAt(t,e,n,i,o){if(!this.isInBounds(t,e))return!1;let s=x(this,Q,wt).call(this,n);return s.position.x=t,s.position.y=e,s.index=e*this.width+t,i&&this.markDirty(s,o),c(this,b)[e*this.width+t]=s,!0}getParticleAt(t,e){return this.isInBounds(t,e)?c(this,b)[e*this.width+t]:null}tryMoveParticle(t,e,n=!1,i=!1,o=!1){for(const s of e){if(!s)continue;const r=Ct.shuffleArray(s);for(const d of r){let a=d.dx;n&&Math.random()>.5&&(a=d.dx*-1);const l=t.position.x+a,u=t.position.y+d.dy,g=this.getParticleAt(l,u);if(g&&g.isMovable&&t.density>g.density){c(this,b)[g.index]=t,c(this,b)[t.index]=g;const m={x:t.position.x,y:t.position.y},w=t.index;return t.position=g.position,t.index=g.index,g.position=m,g.index=w,i&&(this.markDirty(t,o),this.markDirty(g,o)),g}}}return null}swapParticles(t,e,n,i){c(this,b)[t.index]=e,c(this,b)[e.index]=t;const o={x:t.position.x,y:t.position.y},s=t.index;t.position=e.position,t.index=e.index,e.position=o,e.index=s,n&&(this.markDirty(t,i),this.markDirty(e,i))}getNeighborOf(t,e){const n=t.position.x+e.dx,i=t.position.y+e.dy;return this.getParticleAt(n,i)}getNeighborsOf(t,e,n,i){return e.map(s=>this.getNeighborOf(t,s)).filter(s=>s!==null).filter(s=>{const r=n===void 0||s.category===n,d=i===void 0||s.id===i;return r&&d})}markDirty(t,e){if(c(this,q).add(t.index),e){const n=this.getNeighborsOf(t,Ut.ALL_NEIGHBORS);for(const i of n)c(this,q).add(i.index)}}isInBounds(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}fillCircleAt(t,e,n,i){for(let o=-n;o<=n;o++)for(let s=-n;s<=n;s++){if(o*o+s*s>n*n)continue;const r=t+o,d=e+s;if(!this.isInBounds(r,d))continue;const a=this.getParticleAt(r,d);(i===0||a===null||a.id===0)&&this.createParticleAt(r,d,i,!0,!0)}}}b=new WeakMap,q=new WeakMap,Q=new WeakSet,wt=function(t){const e=this.ParticleDataBlueprint[t];if(!e)return null;let i=Math.random(),s=6-1,r=Math.round(i*s)/s;const d=tt.hexToColor(e.baseColor),a=tt.hexToColor(e.variantColor),l=tt.lerpColor(d,a,r);let u={handle:-1,id:e.id,name:e.name,color:l,position:{x:-1,y:-1},index:0,isMovable:e.isMovable,density:e.density};return e.category===0?{...u,category:0}:e.category===1?{...u,category:1}:e.category===2?{...u,category:2,concentration:0,maxConcentration:e.maxConcentration}:e.category===3?{...u,category:3}:e.category===4?{...u,category:4,reposeAngle:e.reposeAngle,reposeDirections:e.reposeDirections}:e.category===5?{...u,category:5,node:-1}:null},It=function(t){const e=this.width,n=this.height;p(this,b,new Array(e*n));for(let i=0;i<n;i++)for(let o=0;o<e;o++){let s=i*e+o,r=x(this,Q,wt).call(this,t);r&&(r.position.x=o,r.position.y=i,r.index=s,c(this,b)[s]=r,c(this,q).add(r.index))}};const Pt=Object.keys(ut);var j,dt,et,lt,ht,I,P,W,H,pt,it,Y,z,nt,ft,st,T,St,Tt,Dt,At,Mt;class Ft{constructor(t,e,n,i,o){_(this,T);_(this,j);_(this,dt);_(this,et);_(this,lt);_(this,ht);_(this,I);_(this,P);_(this,W);_(this,H);_(this,pt);_(this,it);_(this,Y);_(this,z);_(this,nt,0);_(this,ft,60);_(this,st,t=>{if(!c(this,W))return;if(!c(this,Y)){p(this,Y,t),p(this,H,requestAnimationFrame(c(this,st)));return}const e=t-c(this,Y);p(this,Y,t),c(this,dt).processInput(c(this,I),c(this,j)),p(this,z,c(this,z)+e);let n=0;for(;c(this,z)>=c(this,it);){const i=[];for(const s of c(this,I).dirtyParticles)i.push(c(this,I).data[s]);mt(this,nt)._++,c(this,nt)>c(this,ft)&&(c(this,I).dirtyParticles.clear(),p(this,nt,0));const o=new Uint8ClampedArray([210,55,55,180]);c(this,j).queueParticles(i,c(this,et).isOverlayEnabled?o:void 0),x(this,T,St).call(this,i),this.tickCount++,p(this,z,c(this,z)-c(this,it)),n++,n>60&&p(this,z,0)}c(this,j).renderThisFrame(),c(this,et).updateDisplay(t,this),p(this,H,requestAnimationFrame(c(this,st)))});p(this,j,n),p(this,dt,i),p(this,et,o),p(this,lt,e.GAME_WIDTH),p(this,ht,e.GAME_HEIGHT),p(this,I,new Gt(c(this,lt),c(this,ht),t)),p(this,P,new Set),p(this,W,!1),p(this,H,null),p(this,pt,_t.RENDER_UPDATE_INTERVAL),p(this,it,_t.PHYSICS_UPDATE_INTERVAL),p(this,Y,null),p(this,z,0),this.tickCount=0}start(){c(this,W)||(p(this,W,!0),c(this,st).call(this,0))}stop(){p(this,W,!1),c(this,H)&&(cancelAnimationFrame(c(this,H)),p(this,H,null))}groupParticles(t,e){const n=t.width,i=t.height,o=[],s=[],r={};for(let a=i-1;a>=0;a--)for(let l=0;l<n;l++){const u=a*n+l,g=t.getParticleAt(l,a);if(!g||g.category!==e||g.category!==e)continue;const m=t.getNeighborOf(g,ut.UP),w=t.getNeighborOf(g,ut.LEFT),f=m&&m.id===g.id,y=w&&w.id===g.id;let v=-1;y&&(v=a*n+(l-1));let D=-1;f&&(D=(a+1)*n+l);const U=m&&m.id===0;if(!y&&!f){const E=s.length;o.push([u]),s.push({liquidParticle:[],emptyParticle:[]}),U&&(s[E].liquidParticle.push(g),s[E].emptyParticle.push(m)),r[u]=E}else if(y&&!f){const E=r[v];o[E].push(u),U&&(s[E].liquidParticle.push(g),s[E].emptyParticle.push(m)),r[u]=E}else if(!y&&f){const E=r[D];o[E].push(u),U&&(s[E].liquidParticle.push(g),s[E].emptyParticle.push(m)),r[u]=E}else{const E=r[D];o[E].push(u),U&&(s[E].liquidParticle.push(g),s[E].emptyParticle.push(m)),r[u]=E;const L=r[v];if(L!==E){const C=s[L];for(const S of C.liquidParticle)s[E].liquidParticle.push(S);for(const S of C.emptyParticle)s[E].emptyParticle.push(S);const $=o[L];for(const S of $)r[S]=E;o[L]=[],s[L]={liquidParticle:[],emptyParticle:[]}}}}return s.filter(a=>a.liquidParticle.length>30)}}j=new WeakMap,dt=new WeakMap,et=new WeakMap,lt=new WeakMap,ht=new WeakMap,I=new WeakMap,P=new WeakMap,W=new WeakMap,H=new WeakMap,pt=new WeakMap,it=new WeakMap,Y=new WeakMap,z=new WeakMap,nt=new WeakMap,ft=new WeakMap,st=new WeakMap,T=new WeakSet,St=function(t){c(this,P).clear(),t=Ct.shuffleArray(t),t.sort((n,i)=>n.position.y-i.position.y);for(const n of t)if(n&&!c(this,P).has(n.index))switch(n.category){case 1:break;case 2:x(this,T,Tt).call(this,n);break;case 3:x(this,T,Dt).call(this,n);break;case 4:x(this,T,At).call(this,n);break;case 5:break;default:continue}let e=this.groupParticles(c(this,I),2);x(this,T,Mt).call(this,e)},Tt=function(t){let e=[[{dx:0,dy:-1}],[{dx:-1,dy:-1},{dx:1,dy:-1}],[{dx:-1,dy:0},{dx:1,dy:0}]];const n=c(this,I).tryMoveParticle(t,e,!1,!0,!0);n&&(c(this,P).add(t.index),c(this,P).add(n.index))},Dt=function(t){const e=Pt[Math.floor(Math.random()*Pt.length)];let i=[[ut[e]]];const o=c(this,I).tryMoveParticle(t,i,!1,!0,!0);o&&(c(this,P).add(t.index),c(this,P).add(o.index))},At=function(t){let e=t.reposeDirections;const n=c(this,I).tryMoveParticle(t,e,!0,!0,!0);n&&(c(this,P).add(t.index),c(this,P).add(n.index))},Mt=function(t){for(const e of t){const n=e.liquidParticle.sort((d,a)=>a.position.y-d.position.y),i=e.emptyParticle.sort((d,a)=>d.position.y-a.position.y),o=n.length;let s=0;const r=o/4;for(let d=0;d<o;d++){const a=n[d],l=i[d];if(Math.sqrt(a.position.x*l.position.x+a.position.y*l.position.y),a.position.y>l.position.y&&(c(this,I).swapParticles(a,l,!0,!0),c(this,P).add(a.index),c(this,P).add(l.index),s++,s>=r))break}}};const M=class M{constructor(t,e,n,i,o,s,r,d,a){this._containers=[],this._categoryButtons=[],this._onFocus=()=>{this._isFocused||(M.currentZIndex++,this._window.style.zIndex=M.currentZIndex.toString())},this._onPointerDown=l=>{if(l.stopPropagation(),this._onFocus(),l.button===0){this._titlebar.setPointerCapture(l.pointerId);const u=this._window.getBoundingClientRect();this._dragOffset.x=l.clientX-u.left,this._dragOffset.y=l.clientY-u.top,this._isDragging=!0}else this._isDragging=!1},this._onPointerUp=l=>{this._isDragging&&(this._titlebar.releasePointerCapture(l.pointerId),this._isDragging=!1)},this._onPointerMove=l=>{if(this._isDragging){const u=l.clientX-this._dragOffset.x,g=l.clientY-this._dragOffset.y;this._moveWindow(u,g)}},this._onCloseButtonClick=l=>{this._closeWindow()},this._onViewportResize=()=>{this._snapWindowBacc()},this._stopDragPropagation=l=>{l.stopPropagation()},this._handleGlobalClick=l=>{document.querySelectorAll(".dropdown-list.is-open").forEach(u=>{const g=u.closest(".custom-dropdown-container");g&&!g.contains(l.target)&&u.classList.remove("is-open")})},this.hostElement=t,i.width=Math.max(40,Math.min(i.width,o.width)),i.height=Math.max(40,Math.min(i.height,o.height)),this._size=i,this._maxSize=o,this._isFocused=!1,this._isDragging=!1,this._dragOffset={x:0,y:0},this._selectedCategory=0,this._initWindow(e,n,s,r,d,a),this._addEventListener(),this._onFocus(),document.addEventListener("click",this._handleGlobalClick)}destroy(){this._closeWindow(),document.removeEventListener("click",this._handleGlobalClick)}_initWindow(t,e,n,i,o,s){const r=document.createElement("div");r.classList.add("ui-window"),this.hostElement.appendChild(r),this._window=r,this._window.style.left=`${e.x}px`,this._window.style.top=`${e.y}px`,this._window.style.width=`${this._size.width}px`,this._window.style.height=`${this._size.height}px`,this._window.style.maxWidth=`${this._maxSize.width}px`,this._window.style.maxHeight=`${this._maxSize.height}px`;const d=document.createElement("div");d.classList.add("ui-window__titlebar"),this._window.appendChild(d),this._titlebar=d;const a=document.createElement("span");a.classList.add("ui-window__title"),a.textContent=t,d.appendChild(a);const l=document.createElement("div");l.classList.add("ui-window__controls"),this._titlebar.appendChild(l);const u=document.createElement("button");u.classList.add("ui-window__title-button");const g=document.createElement("img");g.src="./assets/icons/close.svg",u.appendChild(g),l.appendChild(u),this._closeButton=u;const m=document.createElement("div");m.classList.add("ui-window__content-area"),m.style.flexDirection=n==="left"||n==="right"?"row":"column",this._window.appendChild(m),this._contentArea=m;const w=document.createElement("div");w.classList.add("ui-window__category-strip",`strip-${n}`),this._categoryStrip=w;const f=document.createElement("div");f.classList.add("ui-window__content-container"),this._contentContainer=f,n==="left"||n==="top"?(m.appendChild(w),m.appendChild(f)):(m.appendChild(f),m.appendChild(w));let y=null;s?y=s:(y=document.createElement("div"),y.classList.add("ui-window__content")),y.id="container-0",f.appendChild(y),this._containers.push(y),this._createNewCategory(i,o,0)}_addEventListener(){this._window.addEventListener("mousedown",this._onFocus),this._titlebar.addEventListener("pointerdown",this._onPointerDown),this._titlebar.addEventListener("pointermove",this._onPointerMove),this._titlebar.addEventListener("pointerup",this._onPointerUp),this._closeButton.addEventListener("click",this._onCloseButtonClick),this._closeButton.addEventListener("pointerdown",this._stopDragPropagation),window.addEventListener("resize",this._onViewportResize)}_closeWindow(){window.removeEventListener("resize",this._onViewportResize),this._titlebar.removeEventListener("pointerdown",this._onPointerDown),this._titlebar.removeEventListener("pointermove",this._onPointerMove),this._titlebar.removeEventListener("pointerup",this._onPointerUp),this._window.removeEventListener("mousedown",this._onFocus),this._window&&this._window.parentElement&&this._window.parentElement.removeChild(this._window)}_moveWindow(t,e){const n=this._window.offsetWidth,i=this._window.offsetHeight,o=Math.max(0,Math.min(t,window.innerWidth-n)),s=Math.max(0,Math.min(e,window.innerHeight-i));this._window.style.left=`${o}px`,this._window.style.top=`${s}px`}_snapWindowBacc(){const t=this._window.offsetWidth,e=this._window.offsetHeight,n=Math.max(0,window.innerWidth-t),i=Math.max(0,window.innerHeight-e),o=this._window.offsetLeft,s=this._window.offsetTop;let r=o,d=s;o>n?r=n:o<0&&(r=0),s>i?d=i:s<0&&(d=0),(r!==o||d!==s)&&(this._window.style.left=`${r}px`,this._window.style.top=`${d}px`)}_showCategory(t){this._selectedCategory=t,this._containers.forEach((n,i)=>{n.style.display=i===t?"":"none"}),this._categoryStrip.querySelectorAll(".ui-window__category-button").forEach((n,i)=>{i===t?n.classList.add("active"):n.classList.remove("active")})}_createNewCategory(t,e,n){const i=document.createElement("button");i.classList.add("ui-window__category-button");const o=document.createElement("img");return o.alt=t,o.src=e,i.title=t,o.classList.add("ui-window__category-icon"),i.appendChild(o),this._categoryButtons.push(i),this._categoryStrip.appendChild(i),i.addEventListener("click",()=>this._showCategory(n)),i}getAllCategoryContainer(){return this._containers}getAllCategoryButtons(){return this._categoryButtons}addCategory(t,e,n){let i=this._containers.length,o=null;n?o=n:(o=document.createElement("div"),o.classList.add("ui-window__content")),o.id="container-"+i,o.style.display="none",this._contentContainer.appendChild(o),this._containers.push(o);const s=this._createNewCategory(t,e,i);return this._categoryStrip.style.display="flex",s}addCategorySpacer(){const t=document.createElement("div");return t.classList.add("ui-flex-spacer"),this._categoryStrip.appendChild(t),t}addCategoryDivider(){const t=document.createElement("div");return t.classList.add("ui-flex-divider"),this._categoryStrip.appendChild(t),t}addTitle(t,e){const n=this._containers[t];if(!n)return null;const i=document.createElement("h2");return i.classList.add("ui-title"),i.textContent=e,n.appendChild(i),i}addSection(t,e){const n=this._containers[t];if(!n)return null;const i=document.createElement("h4");return i.classList.add("ui-section"),i.textContent=e,n.appendChild(i),i}addDivider(t){const e=this._containers[t];if(!e)return null;const n=document.createElement("div");return n.classList.add("ui-window__divider"),e.appendChild(n),n}addText(t,e,n,i,o){const s=this._containers[t];if(!s)return null;const r=document.createElement("p");return r.classList.add("ui-text"),r.textContent=e,n&&(r.style.color=n),o&&(r.id=o),i&&(r.style.fontWeight=i),s.appendChild(r),r}addLink(t,e,n){const i=this._containers[t];if(!i)return null;const o=document.createElement("p");o.classList.add("ui-text");const s=document.createElement("a");return s.href=n,s.textContent=e,s.target="_blank",o.appendChild(s),i.appendChild(o),o}addBulletedList(t,e){const n=this._containers[t];if(!n)return null;const i=document.createElement("ul");return i.classList.add("ui-text"),e.forEach(o=>{const s=document.createElement("li");s.textContent=o,i.appendChild(s)}),n.appendChild(i),i}addNumberedList(t,e){const n=this._containers[t];if(!n)return null;const i=document.createElement("ol");return i.classList.add("ui-text"),e.forEach(o=>{const s=document.createElement("li");s.textContent=o,i.appendChild(s)}),n.appendChild(i),i}addImage(t,e,n,i){const o=this._containers[t];if(!o)return null;const s=document.createElement("img");return s.classList.add("ui-image"),s.src=e,s.alt=n,s.width=i.width,s.height=i.height,o.appendChild(s),s}addSlider(t,e,n,i,o){const s=this._containers[t];if(!s)return null;const r=document.createElement("div");r.classList.add("flex-row");const d=document.createElement("label");d.textContent=e+":",r.appendChild(d);const a=document.createElement("input");a.type="range",a.id=n+"-range",a.min=i.x.toString(),a.max=i.y.toString(),a.value=o.toString(),i.y-i.x<2&&i.y>i.x&&(a.step=.01.toString()),r.appendChild(a);const l=document.createElement("input");return l.style.minWidth="40px",l.type="number",l.id=n+"-number",l.min=i.x.toString(),l.max=i.y.toString(),l.value=o.toString(),a.oninput=()=>l.value=a.value,l.onchange=()=>{const u=Math.max(i.x,Math.min(i.y,parseInt(l.value))).toString();a.value=u,l.value=u},r.appendChild(l),s.appendChild(r),r}addTextInput(t,e,n,i,o){const s=this._containers[t];if(!s)return null;const r=document.createElement("div");r.classList.add("flex-row","ui-text-input-container");const d=document.createElement("label");d.textContent=e+":",d.htmlFor=o,r.appendChild(d);const a=document.createElement("input");return a.type="text",a.id=o,a.placeholder=n,a.value=i,r.appendChild(a),s.appendChild(r),r}addButton(t,e,n,i){const o=this._containers[t];if(!o)return null;const s=document.createElement("button");return s.classList.add("ui-window__content__Button"),s.textContent=e,s.id=n,i&&(s.style.backgroundColor=i),o.appendChild(s),s}addDropdown(t,e,n,i){const o=this._containers[t];if(!o)return null;const s=document.createElement("div");s.classList.add("flex-row");const r=document.createElement("label");r.textContent=e+":",s.appendChild(r);const d=document.createElement("div");d.classList.add("custom-dropdown-container");const a=document.createElement("div");a.classList.add("dropdown-button"),a.innerHTML=`
          <span id="${n}-display">${i[0]}</span>
      `,d.appendChild(a);const l=document.createElement("ul");l.classList.add("dropdown-list"),l.id=n+"-list",d.appendChild(l);let u=0,g=[];return i.forEach((m,w)=>{const f=document.createElement("li");f.style.marginBottom="0px",f.classList.add("dropdown-item"),f.textContent=m,f.dataset.value=m.toLowerCase().replace(/\s/g,"-"),f.dataset.index=w.toString(),w===u&&f.classList.add("is-selected"),f.addEventListener("click",y=>{y.stopPropagation(),g[u].classList.remove("is-selected"),u=w,f.classList.add("is-selected"),document.getElementById(`${n}-display`).textContent=m,l.classList.remove("is-open")}),l.appendChild(f),g.push(f)}),a.addEventListener("click",m=>{if(m.stopPropagation(),document.querySelectorAll(".dropdown-list.is-open").forEach(f=>{f!==l&&f.classList.remove("is-open")}),l.classList.toggle("is-open")){const f=M.DROPDOWN_ITEM_HEIGHT,y=M.DROPDOWN_BUTTON_HEIGHT,v=u*f,D=y-v;l.style.transform=`translateY(${D-y-6}px)`,l.style.top="0px",l.scrollTop=v}}),s.appendChild(d),o.appendChild(s),s}addToggleSwitch(t,e,n,i=!1){const o=this._containers[t];if(!o)return null;const s=document.createElement("div");s.classList.add("flex-row");const r=document.createElement("label");r.textContent=e+":",s.appendChild(r);const d=document.createElement("div");d.classList.add("toggle-container");const a=document.createElement("div");return a.classList.add("toggle-switch"),a.id=n+"-switch",i&&a.classList.add("is-on"),a.innerHTML=`
          <span class="toggle-indicator indicator-o">O</span> 
          <span class="toggle-indicator indicator-i">I</span> 
          <div class="toggle-slider"></div>
      `,a.addEventListener("click",()=>{a.classList.toggle("is-on")}),d.appendChild(a),s.appendChild(d),o.appendChild(s),s}};M.currentZIndex=100,M.DROPDOWN_ITEM_HEIGHT=30,M.DROPDOWN_BUTTON_HEIGHT=30;let Et=M;class kt{constructor(t,e,n,i,o){this._onPointerDown=s=>{this._activePointerId=s.pointerId,s.button===0?(this.isPainting=!0,this.isErasing=!1,this.activeButton="left"):s.button===2?(this.isErasing=!0,this.isPainting=!1,this.activeButton="right"):(this.isPainting=!1,this.isErasing=!1,this.activeButton="none");try{this._canvas.setPointerCapture(s.pointerId)}catch{}const r=this._canvas.getBoundingClientRect(),d=this._width/r.width,a=this._height/r.height;this.latestMouseCoords.x=(s.clientX-r.left)*d,this.latestMouseCoords.y=this._canvas.height-(s.clientY-r.top)*a},this._onPointerUp=s=>{if(this._activePointerId===s.pointerId){this._activePointerId=null,this.activeButton="none";try{this._canvas.releasePointerCapture(s.pointerId)}catch{}}this.isPainting=!1,this.isErasing=!1},this._onPointerMove=s=>{const r=this._canvas.getBoundingClientRect(),d=this._width/r.width,a=this._canvas.height/r.height;if(this.latestMouseCoords.x=(s.clientX-r.left)*d,this.latestMouseCoords.y=this._canvas.height-(s.clientY-r.top)*a,typeof s.buttons=="number"){const l=(s.buttons&1)===1,u=(s.buttons&2)===2;this.isPainting=l,this.isErasing=u}},this._onPointerCancel=s=>{if(this.isPainting=!1,this.isErasing=!1,this._activePointerId===s.pointerId){try{this._canvas.releasePointerCapture(s.pointerId)}catch{}this._activePointerId=null,this.activeButton="none"}},this._onWindowPointerUp=()=>{this.isPainting=!1,this.isErasing=!1,this._activePointerId=null,this.activeButton="none"},this._onVisibilityChange=()=>{document.hidden&&(this.isPainting=!1,this.isErasing=!1,this._activePointerId=null,this.activeButton="none")},this._onWheel=s=>{s.preventDefault(),this.shouldChangeBrushSize=!0,this.changeBrushSizeDir=s.deltaY},this._onContextMenu=s=>{s.preventDefault()},this._onPointerEnter=s=>{this.isDrawingOverlay=!0},this._onPointerLeave=s=>{this.isDrawingOverlay=!1},this._mainContainer=e,this._canvas=n,this._renderer=o,this._width=i.GAME_WIDTH,this._height=i.GAME_HEIGHT,this._brushSizeSensitivity=i.BRUSH_SENSITIVITY,this._maxBrushSize=i.BRUSH_MAX_SIZE,this._selectedParticle=i.SELECTED_PARTICLE,this._selectedCategory=i.SELECTED_CATEGORY,this._currentBrushSize=i.BRUSH_CUR_SIZE,this._currentPressure=i.CURRENT_PRESSURE,this._currentConcentration=i.CURRENT_CONCENTRATION,this._activePointerId=null,this.isPainting=!1,this.isErasing=!1,this.isDrawingOverlay=!0,this.shouldChangeBrushSize=!1,this.changeBrushSizeDir=0,this.latestMouseCoords={x:0,y:0},this.activeButton="none",this._addEventListeners(),this._addParticlePalette(t)}processInput(t,e){const n=this.latestMouseCoords.x,i=this.latestMouseCoords.y,o={x:Math.floor(n),y:Math.floor(i)};if(this.isDrawingOverlay){const s=this._calculateBrushOutline(o.x,o.y);e.queueUIPixels(s)}if(this.isPainting||this.isErasing){const s=o.x<this._width+this._currentBrushSize&&o.x>=0-this._currentBrushSize,r=o.y<this._height+this._currentBrushSize&&o.y>=0-this._currentBrushSize;if(s&&r){const d=o.x,a=o.y,l=this.isPainting?this._selectedParticle:0;t.fillCircleAt(d,a-1,this._currentBrushSize,l)}}if(this.shouldChangeBrushSize){const s=this.changeBrushSizeDir*this._brushSizeSensitivity;let r=this._currentBrushSize-s;r=Math.floor(r),r=Math.min(this._maxBrushSize,r),r=Math.max(0,r),this._currentBrushSize=r,this.changeBrushSizeDir=0}}_addEventListeners(){const t=this._canvas;t.addEventListener("pointerdown",this._onPointerDown),t.addEventListener("pointermove",this._onPointerMove),t.addEventListener("pointerup",this._onPointerUp),t.addEventListener("pointercancel",this._onPointerCancel),t.addEventListener("lostpointercapture",this._onPointerCancel),t.addEventListener("pointerenter",this._onPointerEnter),t.addEventListener("pointerleave",this._onPointerLeave),t.addEventListener("wheel",this._onWheel,{passive:!1}),this._mainContainer.addEventListener("contextmenu",this._onContextMenu),window.addEventListener("pointerup",this._onWindowPointerUp),window.addEventListener("mouseup",this._onWindowPointerUp),document.addEventListener("visibilitychange",this._onVisibilityChange)}_addParticlePalette(t){const e={x:320,y:300},n={width:250,height:200},i={width:420,height:400},o=document.createElement("div");o.classList.add("particle-palette-container");const s=new Et(this._mainContainer,"Particle Palette",e,n,i,"bottom","Solids","./assets/icons/solid.svg",o),r=document.createElement("div");r.classList.add("particle-palette-container"),s.addCategory("Liquids","./assets/icons/liquid.svg",r);const d=document.createElement("div");d.classList.add("particle-palette-container"),s.addCategory("Gases","./assets/icons/gas.svg",d);const a=document.createElement("div");a.classList.add("particle-palette-container"),s.addCategory("Sands","./assets/icons/sand.svg",a);const l=document.createElement("div");l.classList.add("particle-palette-container"),s.addCategory("Electronics","./assets/icons/electronics.svg",l),s.addCategorySpacer(),s.addCategory("Settings","./assets/icons/settings.svg"),s._showCategory(1),this._selectedCategory=2;const u=s.getAllCategoryContainer(),g=s.getAllCategoryButtons();for(let w=0;w<g.length-1;w++)g[w].addEventListener("click",()=>{for(const y of u){const v=y.querySelector(".selected");v&&v.classList.remove("selected")}const f=u[w];if(f){const y=f.querySelector(".particle-button");y&&(y.classList.add("selected"),this._selectedParticle=parseInt(y.dataset.particleId||"-1",10),this._selectedCategory=parseInt(y.dataset.category||"-1",10))}});let m=!1;for(const w in t){const f=t[w];if(!f)continue;const y=u[f.category-1];if(!y)continue;const v=f.baseColor,D=f.variantColor,E=tt.getLuminance(tt.hexToColor(v))>210?"#323238":"#FFFFFFFF",L=tt.hexToColor(E),C=document.createElement("button");C.className="particle-button",C.textContent=f.name,C.style.setProperty("--particle-button-base-color",v),C.style.setProperty("--particle-button-variant-color",D),C.style.color=E,C.style.textShadow=`1px 1px 2px rgba(${L[0]}, ${L[1]}, ${L[2]}, 0.6)`,C.dataset.particleId=f.id.toString(),C.dataset.category=f.category.toString(),C.addEventListener("click",()=>{for(const $ of u){const S=$.querySelector(".selected");S&&S.classList.remove("selected")}C.classList.add("selected"),this._selectedParticle=f.id,this._selectedCategory=f.category}),y.appendChild(C),!m&&f.category===this._selectedCategory&&(C.classList.add("selected"),this._selectedParticle=f.id,m=!0)}}_calculateBrushOutline(t,e){const n=this._currentBrushSize,i=[],o=227,s=227,r=227,d=180,a=this._width,l=this._height,u=[-1,1],g=(y,v)=>{for(const D of u)for(const U of u){const E=t+y*U,L=e+v*D,C=t+v*U,$=e+y*D;if(E>=0&&E<a&&L>=0&&L<l){const S=(l-L)*a+E;i.push({index:S,value:new Uint8ClampedArray([o,s,r,d])})}if(C>=0&&C<a&&$>=0&&$<l){const S=(l-$)*a+C;i.push({index:S,value:new Uint8ClampedArray([o,s,r,d])})}}};let m=n,w=0,f=n-n;for(g(m,w);w<m;)w++,f<0?f+=2*w+1:(m--,f+=2*(w-m)+1),g(m,w);return i}}var K,Z,A,J,ot,rt,at,ct,Rt,Bt;class qt{constructor(t){_(this,ct);_(this,K);_(this,Z);_(this,A);_(this,J);_(this,ot);_(this,rt);_(this,at);p(this,K,!1),p(this,Z,!1),p(this,A,new Map),p(this,J,0),p(this,ot,0),p(this,rt,0),p(this,at,0),x(this,ct,Bt).call(this,t)}get isOverlayEnabled(){return c(this,Z)}enableDebug(t){p(this,K,!0),t&&p(this,Z,!0)}disableDebug(){p(this,K,!1),p(this,Z,!1)}updateDisplay(t,e){if(!c(this,K))return;x(this,ct,Rt).call(this,t,e);const n=c(this,A).get("fps");n&&(n.textContent=`FPS: ${c(this,ot).toFixed(2)}`);const i=c(this,A).get("tps");i&&(i.textContent=`TPS: ${c(this,rt).toFixed(2)}`)}}K=new WeakMap,Z=new WeakMap,A=new WeakMap,J=new WeakMap,ot=new WeakMap,rt=new WeakMap,at=new WeakMap,ct=new WeakSet,Rt=function(t,e){const n=t-c(this,at);n>=1e3&&(p(this,ot,c(this,J)*1e3/n),p(this,rt,e.tickCount*1e3/n),p(this,J,0),e.tickCount=0,p(this,at,t)),mt(this,J)._++},Bt=function(t){const e=document.createElement("div");e.classList.add("debug-container"),t.appendChild(e),c(this,A).set("debug-container",e);const n=document.createElement("div");n.classList.add("debug-info-container"),e.appendChild(n),c(this,A).set("info-container",n);const i=document.createElement("div");i.classList.add("debug-info"),n.appendChild(i),c(this,A).set("fps",i);const o=document.createElement("div");o.classList.add("debug-info"),n.appendChild(o),c(this,A).set("tps",o)};async function Wt(){try{let h=_t;const t=400,e=40,n=1e3,i=4;h.GAME_WIDTH=Math.max(e,Math.min(t,h.GAME_WIDTH)),h.GAME_HEIGHT=Math.max(e,Math.min(t,h.GAME_HEIGHT)),h.PHYSICS_UPDATE_INTERVAL=Math.max(i,Math.min(n,h.PHYSICS_UPDATE_INTERVAL)),Object.freeze(h);const o=document.getElementById("main-canvas");if(!(o instanceof HTMLCanvasElement))throw new Error("HTML element 'main-canvas' does not exist.");const s=document.getElementById("main-panel");if(!(s instanceof HTMLDivElement))throw new Error("HTML element 'main-panel' does not exist.");const r=new Ot(o,h),d=await Ht("./src/data/particles.data"),a=new kt(d,s,o,h,r),l=new qt(s);l.enableDebug(!1),new Ft(d,h,r,a,l).start(),console.log(d)}catch(h){console.error("ERROR: Failed to initialize engine due to data loading failure.",h)}}Wt();
