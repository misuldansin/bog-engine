(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const T=Object.freeze({GAME_WIDTH:244,GAME_HEIGHT:192,SELECTED_PARTICLE:10,SELECTED_CATEGORY:1,BRUSH_MAX_SIZE:42,BRUSH_CUR_SIZE:4,BRUSH_SENSITIVITY:.02,CURRENT_PRESSURE:0,CURRENT_CONCENTRATION:1,DEBUG_START_ENABLED:!0,DEBUG_OVERLAY_START_ENABLED:!1,RENDER_UPDATE_INTERVAL:16.667,PHYSICS_UPDATE_INTERVAL:25}),L={lerp(c,t,e){return c+(t-c)*e},shuffleArray(c){const t=[...c];for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}return t},calculateRepose(c){let t=Math.max(10,Math.min(c,80));const e=t*Math.PI/180;let i=[];if(i.push([{dx:0,dy:-1}]),t<50){i.push([{dx:1,dy:-1},{dx:-1,dy:-1}]);const s=Math.round(1/Math.tan(e));i.push([{dx:s,dy:-1},{dx:s*-1,dy:-1}])}else{const s=Math.round(Math.tan(e));i.push([{dx:1,dy:-s},{dx:-1,dy:-s}])}return i}};async function M(c){try{const t=await fetch(c);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return await t.text()}catch(t){throw console.error(`Failed to read particle data from ${c}:`,t),new Error("Failed to load particle data.")}}async function _(c){const t=await M(c);let e={},i=new Set,s=null;for(const o of t.split(`
`)){const r=o.trim();if(!(r.length===0||r.startsWith("#"))){if(r.startsWith("[")&&r.endsWith("]")){const l=r.slice(1,-1),a=parseInt(l,10);if(isNaN(a)||a<10){s=null;continue}if(i.has(a)){console.warn(`[Loader] Duplicate ID found: ${a}. Ignoring.`),s=null;continue}i.add(a),s=a,e[a]={};continue}if(s!==null){const l=r.split(":").map(a=>a.trim());if(l.length===2){const a=l[0],d=l[1],h=e[s];switch(a){case"name":h.name=d;break;case"category":h.category=parseInt(d,10);break;case"base_color":h.base_color=d;break;case"variant_color":h.variant_color=d;break;case"is_movable":h.is_movable=d==="true";break;case"density":h.density=parseFloat(d);break;case"max_concentration":h.max_concentration=parseInt(d);break;case"repose_angle":h.repose_angle=parseFloat(d);break}}}}}const n={};for(const o in e){const r=e[o],l=parseInt(o,10);if(r.name===void 0||r.category===void 0||r.base_color===void 0||r.variant_color===void 0||r.is_movable===void 0||r.density===void 0){console.warn(`[Loader] Corrupted particle block found of ID: ${l}. Missing core properties.`);continue}let a={id:l,name:r.name,baseColor:r.base_color,variantColor:r.variant_color,isMovable:r.is_movable,density:r.density};r.category===1?n[l]={...a,category:1}:r.category===2?n[l]={...a,maxConcentration:r.max_concentration,category:2}:r.category===3?n[l]={...a,category:3}:r.category===4?n[l]={...a,category:4,reposeAngle:r.repose_angle,reposeDirections:L.calculateRepose(r.repose_angle)}:r.category===5&&(n[l]={...a,category:5})}return n[0]={id:0,name:"Empty",category:0,baseColor:"#0E0E11",variantColor:"#0E0E11",isMovable:!0,density:0},n}class R{#t;#s;#e;#r;#o;#i;#n;constructor(t,e,i){this.#t=i,this.#s=this.#t.getContext("2d"),this.#e=t,this.#r=e,this.#o=new Uint8ClampedArray(this.#e*this.#r*4),this.#i=[],this.#n=new Map,this.#t.width=this.#e,this.#t.height=this.#r,this.#s.imageSmoothingEnabled=!1,this.#s.translate(0,this.#t.height),this.#s.scale(1,-1)}queueParticles(t,e){if(this.#i.push(...t),e){const i=this.#e,s=this.#r;for(const n of t){const r=(s-1-n.position.y)*i+n.position.x;this.#n.set(r,e)}}}queueOverlayPixels(t){for(const e of t)this.#n.set(e.index,e.value)}renderThisFrame(){this.#d();let t=new Uint8ClampedArray(this.#o);this.#l(t);const e=new ImageData(t,this.#e,this.#r);this.#s.putImageData(e,0,0),this.#i.length=0,this.#n.clear()}#d(){const t=this.#i,e=this.#e,i=this.#r;for(const s of t){const n=s.position.x,o=s.position.y,l=(i-1-o)*e+n;let a=this.#a(s);this.#o[l*4+0]=a[0],this.#o[l*4+1]=a[1],this.#o[l*4+2]=a[2],this.#o[l*4+3]=a[3]}}#a(t){return t.color}#l(t){const e=this.#n;if(e.size!==0)for(const[i,s]of e){const n=t[i*4+0],o=t[i*4+1],r=t[i*4+2],l=t[i*4+3],a=s[0],d=s[1],h=s[2],u=s[3],f=u/255,g=Math.round(a*f+n*(1-f)),y=Math.round(d*f+o*(1-f)),m=Math.round(h*f+r*(1-f)),C=Math.min(l,u);t[i*4+0]=g,t[i*4+1]=y,t[i*4+2]=m,t[i*4+3]=C}}}const S=Object.freeze({WHITE:new Uint8ClampedArray([255,255,255,255]),BLACK:new Uint8ClampedArray([0,0,0,255]),GRAY:new Uint8ClampedArray([128,128,128,255]),RED:new Uint8ClampedArray([255,0,0,255]),GREEN:new Uint8ClampedArray([0,255,0,255]),BLUE:new Uint8ClampedArray([0,0,255,255]),YELLOW:new Uint8ClampedArray([255,255,0,255]),CYAN:new Uint8ClampedArray([0,255,255,255]),MAGENTA:new Uint8ClampedArray([255,0,255,255]),TRANSPARENT_BLACK:new Uint8ClampedArray([0,0,0,0]),SEMI_TRANSPARENT_WHITE:new Uint8ClampedArray([255,255,255,128])}),w={createColor(c){return this.hexToColor(c)},hexToColor(c){if(c==null)return S.BLACK;let t=c.replace("#","");if(t.length===6)t+="FF";else if(t.length===3){let i="";for(const s of t)i+=s,i+=s;t=i+"FF"}else return S.BLACK;const e=parseInt(t,16);return new Uint8ClampedArray([e>>24&255,e>>16&255,e>>8&255,e&255])},colorToHex(c){const[t,e,i,s]=c,n=o=>o.toString(16).padStart(2,"0");return`#${n(t)}${n(e)}${n(i)}${n(s)}`},lerpColor(c,t,e){const i=c[0]+(t[0]-c[0])*e,s=c[1]+(t[1]-c[1])*e,n=c[2]+(t[2]-c[2])*e,o=c[3]+(t[3]-c[3])*e;return new Uint8ClampedArray([i,s,n,o])},createColorRamp(c,t,e){if(e<2)return[c,t];const i=1/(e-1),s=new Array(e);for(let n=0;n<e;n++){const o=n*i;s[n]=this.lerpColor(c,t,o)}return s},invertColor(c){const t=255-c[0],e=255-c[1],i=255-c[2],s=c[3];return new Uint8ClampedArray([t,e,i,s])},getLuminance(c){const t=c[0],e=c[1],i=c[2];return .299*t+.587*e+.114*i}},O=Object.freeze({ALL_NEIGHBORS:[{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}]}),D=Object.freeze({UP_LEFT:{dx:-1,dy:1},UP:{dx:0,dy:1},UP_RIGHT:{dx:1,dy:1},LEFT:{dx:-1,dy:0},RIGHT:{dx:1,dy:0},DOWN_LEFT:{dx:-1,dy:-1},DOWN:{dx:0,dy:-1},DOWN_RIGHT:{dx:1,dy:-1}});class N{#t;#s;constructor(t,e,i){this.width=t,this.height=e,this.#t=new Array(t*e),this.#s=new Set,this.ParticleDataBlueprint=i,this.#r(0)}get data(){return this.#t}get dirtyParticles(){return this.#s}#e(t){const e=this.ParticleDataBlueprint[t];if(!e)return null;let s=Math.random(),o=6-1,r=Math.round(s*o)/o;const l=w.hexToColor(e.baseColor),a=w.hexToColor(e.variantColor),d=w.lerpColor(l,a,r);let h={handle:-1,id:e.id,name:e.name,color:d,position:{x:-1,y:-1},index:0,isMovable:e.isMovable,density:e.density};return e.category===0?{...h,category:0}:e.category===1?{...h,category:1}:e.category===2?{...h,category:2,concentration:0,maxConcentration:e.maxConcentration}:e.category===3?{...h,category:3}:e.category===4?{...h,category:4,reposeAngle:e.reposeAngle,reposeDirections:e.reposeDirections}:e.category===5?{...h,category:5,node:-1}:null}#r(t){const e=this.width,i=this.height;this.#t=new Array(e*i);for(let s=0;s<i;s++)for(let n=0;n<e;n++){let o=s*e+n,r=this.#e(t);r&&(r.position.x=n,r.position.y=s,r.index=o,this.#t[o]=r,this.#s.add(r.index))}}createParticleAt(t,e,i,s,n){if(!this.isInBounds(t,e))return!1;let o=this.#e(i);return o.position.x=t,o.position.y=e,o.index=e*this.width+t,s&&this.markDirty(o,n),this.#t[e*this.width+t]=o,!0}getParticleAt(t,e){return this.isInBounds(t,e)?this.#t[e*this.width+t]:null}tryMoveParticle(t,e,i=!1,s=!1,n=!1){for(const o of e){if(!o)continue;const r=L.shuffleArray(o);for(const l of r){let a=l.dx;i&&Math.random()>.5&&(a=l.dx*-1);const d=t.position.x+a,h=t.position.y+l.dy,u=this.getParticleAt(d,h);if(u&&u.isMovable&&t.density>u.density){this.#t[u.index]=t,this.#t[t.index]=u;const f={x:t.position.x,y:t.position.y},g=t.index;return t.position=u.position,t.index=u.index,u.position=f,u.index=g,s&&(this.markDirty(t,n),this.markDirty(u,n)),u}}}return null}swapParticles(t,e,i,s){this.#t[t.index]=e,this.#t[e.index]=t;const n={x:t.position.x,y:t.position.y},o=t.index;t.position=e.position,t.index=e.index,e.position=n,e.index=o,i&&(this.markDirty(t,s),this.markDirty(e,s))}getNeighborOf(t,e){const i=t.position.x+e.dx,s=t.position.y+e.dy;return this.getParticleAt(i,s)}getNeighborsOf(t,e,i,s){return e.map(o=>this.getNeighborOf(t,o)).filter(o=>o!==null).filter(o=>{const r=i===void 0||o.category===i,l=s===void 0||o.id===s;return r&&l})}markDirty(t,e){if(this.#s.add(t.index),e){const i=this.getNeighborsOf(t,O.ALL_NEIGHBORS);for(const s of i)this.#s.add(s.index)}}isInBounds(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}fillCircleAt(t,e,i,s){for(let n=-i;n<=i;n++)for(let o=-i;o<=i;o++){if(n*n+o*o>i*i)continue;const r=t+n,l=e+o;if(!this.isInBounds(r,l))continue;const a=this.getParticleAt(r,l);(s===0||a===null||a.id===0)&&this.createParticleAt(r,l,s,!0,!0)}}}const A=Object.keys(D);class B{#t;#s;#e;#r;#o;#i;#n;#d;#a;#l;#h;#f;#g;constructor(t,e,i,s,n,o){this.#t=s,this.#s=n,this.#e=o,this.#r=t,this.#o=e,this.#i=new N(t,e,i),this.#n=new Set,this.#d=!1,this.#a=null,this.#l=T.RENDER_UPDATE_INTERVAL,this.#h=T.PHYSICS_UPDATE_INTERVAL,this.#f=null,this.#g=0,this.tickCount=0}start(){this.#d||(this.#d=!0,this.#u(0))}stop(){this.#d=!1,this.#a&&(cancelAnimationFrame(this.#a),this.#a=null)}#u=t=>{if(!this.#d)return;if(!this.#f){this.#f=t,this.#a=requestAnimationFrame(this.#u);return}const e=t-this.#f;for(this.#f=t,this.#s.processInput(this.#i,this.#t),this.#g+=e;this.#g>=this.#h;){const i=[];for(const s of this.#i.dirtyParticles)i.push(this.#i.data[s]);this.#i.dirtyParticles.clear(),this.#t.queueParticles(i),this.#c(i),this.tickCount++,this.#g-=this.#h}this.#t.renderThisFrame(),this.#e.updateDisplay(t,this),this.#a=requestAnimationFrame(this.#u)};#c(t){this.#n.clear(),t=L.shuffleArray(t),t.sort((i,s)=>i.position.y-s.position.y);for(const i of t)if(i&&!this.#n.has(i.index))switch(i.category){case 1:break;case 2:this.#p(i);break;case 3:this.#x(i);break;case 4:this.#m(i);break;case 5:break;default:continue}let e=this.groupParticles(this.#i,2);this.#E(e)}#p(t){let e=[[{dx:0,dy:-1}],[{dx:-1,dy:-1},{dx:1,dy:-1}],[{dx:-1,dy:0},{dx:1,dy:0}]];const i=this.#i.tryMoveParticle(t,e,!1,!0,!0);i&&(this.#n.add(t.index),this.#n.add(i.index))}#x(t){const e=A[Math.floor(Math.random()*A.length)];let s=[[D[e]]];const n=this.#i.tryMoveParticle(t,s,!1,!0,!0);n&&(this.#n.add(t.index),this.#n.add(n.index))}#m(t){let e=t.reposeDirections;const i=this.#i.tryMoveParticle(t,e,!0,!0,!0);i&&(this.#n.add(t.index),this.#n.add(i.index))}#E(t){for(const e of t){const i=e.liquidParticle.sort((o,r)=>r.position.y-o.position.y),s=e.emptyParticle.sort((o,r)=>o.position.y-r.position.y),n=i.length;for(let o=0;o<n;o++){const r=i[o],l=s[o];r.position.y>l.position.y&&(this.#i.swapParticles(r,l,!0,!0),this.#n.add(r.index),this.#n.add(l.index))}}}groupParticles(t,e){const i=t.width,s=t.height,n=[],o=[],r={};for(let a=s-1;a>=0;a--)for(let d=0;d<i;d++){const h=a*i+d,u=t.getParticleAt(d,a);if(!u||u.category!==e)continue;const f=t.getNeighborOf(u,D.UP),g=t.getNeighborOf(u,D.LEFT),y=f&&f.category===e&&f.id===u.id,m=g&&g.category===e&&g.id===u.id;let C=-1;m&&(C=a*i+(d-1));let v=-1;y&&(v=(a+1)*i+d);const P=f&&f.id===0;if(!m&&!y){const p=o.length;n.push([h]),o.push({liquidParticle:[],emptyParticle:[]}),P&&(o[p].liquidParticle.push(u),o[p].emptyParticle.push(f)),r[h]=p}else if(m&&!y){const p=r[C];n[p].push(h),P&&(o[p].liquidParticle.push(u),o[p].emptyParticle.push(f)),r[h]=p}else if(!m&&y){const p=r[v];n[p].push(h),P&&(o[p].liquidParticle.push(u),o[p].emptyParticle.push(f)),r[h]=p}else{const p=r[v];n[p].push(h),P&&(o[p].liquidParticle.push(u),o[p].emptyParticle.push(f)),r[h]=p;const E=r[C];if(E!==p){const b=o[E];for(const x of b.liquidParticle)o[p].liquidParticle.push(x);for(const x of b.emptyParticle)o[p].emptyParticle.push(x);const I=n[E];for(const x of I)r[x]=p;n[E]=[],o[E]={liquidParticle:[],emptyParticle:[]}}}}return o.filter(a=>a.liquidParticle.length>30)}}class U{#t;#s;#e;#r;#o;#i;#n;#d;#a;#l;#h;#f;#g;#u;#c;#p;constructor(t,e,i,s,n,o,r){this.#t=r,this.#s=t,this.#e=e,this.#r=n,this.#o=o,this.#i=s,this.#n=i.BRUSH_SENSITIVITY,this.#d=i.BRUSH_MAX_SIZE,this.#a=i.SELECTED_PARTICLE,this.#l=i.SELECTED_CATEGORY,this.#h=i.BRUSH_CUR_SIZE,this.#f=i.CURRENT_PRESSURE,this.#g=i.CURRENT_CONCENTRATION,this.#u=null,this.#c=null,this.#p=null,this.isPainting=!1,this.isErasing=!1,this.isDrawingOverlay=!0,this.shouldChangeBrushSize=!1,this.changeBrushSizeDir=0,this.latestMouseCoords={x:0,y:0},this.activeButton="none";const l=document.getElementById("particle-category-bar");if(!l)throw new Error("DOM element of id 'particle-category-bar' does not exist.");this.#v(l);const a=document.getElementById("particle-button-container");if(!a)throw new Error("DOM element of id 'particle-button-container' does not exist.");this.#b(a),this.#w(),this.#c&&this.#m(this.#c)}processInput(t,e){const i=this.latestMouseCoords.x,s=this.latestMouseCoords.y,n={x:Math.floor(i),y:Math.floor(s)};if(this.isDrawingOverlay){const o=this.#x(n.x,n.y);e.queueOverlayPixels(o)}if(this.isPainting||this.isErasing){const o=n.x<this.#s+this.#h&&n.x>=0-this.#h,r=n.y<this.#e+this.#h&&n.y>=0-this.#h;if(o&&r){const l=n.x,a=n.y,d=this.isPainting?this.#a:0;t.fillCircleAt(l,a-1,this.#h,d)}}if(this.shouldChangeBrushSize){const o=this.changeBrushSizeDir*this.#n;let r=this.#h-o;r=Math.floor(r),r=Math.min(this.#d,r),r=Math.max(0,r),this.#h=r,this.changeBrushSizeDir=0}}#x(t,e){const i=this.#h,s=[],n=227,o=227,r=227,l=180,a=this.#s,d=this.#e,h=[-1,1],u=(m,C)=>{for(const v of h)for(const P of h){const p=t+m*P,E=e+C*v,b=t+C*P,I=e+m*v;if(p>=0&&p<a&&E>=0&&E<d){const x=(d-E)*a+p;s.push({index:x,value:new Uint8ClampedArray([n,o,r,l])})}if(b>=0&&b<a&&I>=0&&I<d){const x=(d-I)*a+b;s.push({index:x,value:new Uint8ClampedArray([n,o,r,l])})}}};let f=i,g=0,y=i-i;for(u(f,g);g<f;)g++,y<0?y+=2*g+1:(f--,y+=2*(g-f)+1),u(f,g);return s}#m(t){this.#c&&this.#c.classList.remove("selected"),t.classList.add("selected"),this.#c=t;const e=parseInt(t.dataset.categoryId);this.#l=e||1;let i=null;if(this.#i[this.#a]!==void 0){const s=this.#i[this.#a];s&&s.category===this.#l&&this.#u&&(i=this.#u)}document.querySelectorAll(".particle-button").forEach(s=>{const n=s,o=n.dataset.category;o&&parseInt(o)===this.#l?(n.style.display="",i||(i=n)):n.style.display="none"}),this.#E(i)}#E(t){if(!t)return;this.#u&&this.#u.classList.remove("selected"),t.classList.add("selected"),this.#u=t;const e=parseInt(t.dataset.particleId);this.#a=e||0}#v(t){t.innerHTML="";let e=this.#y(1,"Solids","./assets/icons/solid.svg");t.appendChild(e),this.#l==1&&(this.#c=e);let i=this.#y(2,"Liquids","./assets/icons/liquid.svg");t.appendChild(i),this.#l==2&&(this.#c=i);let s=this.#y(3,"Gases","./assets/icons/gas.svg");t.appendChild(s),this.#l==3&&(this.#c=s);let n=this.#y(4,"Sands","./assets/icons/sand.svg");t.appendChild(n),this.#l==4&&(this.#c=n);let o=this.#y(5,"Electronics","./assets/icons/electronics.svg");t.appendChild(o),this.#l==5&&(this.#c=o),this.#c||(this.#c=n)}#y(t,e,i){const s=document.createElement("button");s.className="category-button";const n=document.createElement("img");return n.src=i,n.alt=e,n.classList.add("category-icon"),s.dataset.categoryId=t.toString(),s.appendChild(n),s}#b(t){t.innerHTML="";for(const e in this.#i){const i=this.#i[e];if(!i)continue;const s=document.createElement("button");s.className="particle-button",s.textContent=i.name;const n=i.baseColor,o=i.variantColor,l=w.getLuminance(w.hexToColor(n))>210?"#323238":"#FFFFFFFF",a=w.hexToColor(l);s.style.setProperty("--particle-button-base-color",n),s.style.setProperty("--particle-button-variant-color",o),s.style.color=l,s.style.textShadow=`1px 1px 2px rgba(${a[0]}, ${a[1]}, ${a[2]}, 0.6)`,s.dataset.particleId=i.id.toString(),s.dataset.category=i.category.toString(),t.appendChild(s),i.id===this.#a&&(this.#u=s)}}#w(){const t=this.#o,e=document.getElementById("particle-category-bar"),i=document.getElementById("particle-button-container");if(!e||!i)throw new Error("Cannot find category bar and/ or button container");t.addEventListener("pointerdown",this.#I),t.addEventListener("pointermove",this.#D),t.addEventListener("pointerup",this.#T),t.addEventListener("pointercancel",this.#C),t.addEventListener("lostpointercapture",this.#C),t.addEventListener("pointerenter",this.#M),t.addEventListener("pointerleave",this.#_),t.addEventListener("wheel",this.#S,{passive:!1}),this.#r.addEventListener("contextmenu",this.#A),window.addEventListener("pointerup",this.#P),window.addEventListener("mouseup",this.#P),document.addEventListener("visibilitychange",this.#L),e.addEventListener("click",s=>{if(!s.target)return;const o=s.target.closest(".category-button");o&&o&&this.#m(o)}),i.addEventListener("click",s=>{if(!s.target)return;const o=s.target.closest(".particle-button");o&&this.#E(o)})}#I=t=>{this.#p=t.pointerId,t.button===0?(this.isPainting=!0,this.isErasing=!1,this.activeButton="left"):t.button===2?(this.isErasing=!0,this.isPainting=!1,this.activeButton="right"):(this.isPainting=!1,this.isErasing=!1,this.activeButton="none");try{this.#o.setPointerCapture(t.pointerId)}catch{}const e=this.#o.getBoundingClientRect(),i=this.#s/e.width,s=this.#e/e.height;this.latestMouseCoords.x=(t.clientX-e.left)*i,this.latestMouseCoords.y=this.#o.height-(t.clientY-e.top)*s};#T=t=>{if(this.#p===t.pointerId){this.#p=null,this.activeButton="none";try{this.#o.releasePointerCapture(t.pointerId)}catch{}}this.isPainting=!1,this.isErasing=!1};#D=t=>{const e=this.#o.getBoundingClientRect(),i=this.#s/e.width,s=this.#o.height/e.height;if(this.latestMouseCoords.x=(t.clientX-e.left)*i,this.latestMouseCoords.y=this.#o.height-(t.clientY-e.top)*s,typeof t.buttons=="number"){const n=(t.buttons&1)===1,o=(t.buttons&2)===2;this.isPainting=n,this.isErasing=o}};#C=t=>{if(this.isPainting=!1,this.isErasing=!1,this.#p===t.pointerId){try{this.#o.releasePointerCapture(t.pointerId)}catch{}this.#p=null,this.activeButton="none"}};#P=()=>{this.isPainting=!1,this.isErasing=!1,this.#p=null,this.activeButton="none"};#L=()=>{document.hidden&&(this.isPainting=!1,this.isErasing=!1,this.#p=null,this.activeButton="none")};#S=t=>{t.preventDefault(),this.shouldChangeBrushSize=!0,this.changeBrushSizeDir=t.deltaY};#A=t=>{t.preventDefault()};#M=t=>{this.isDrawingOverlay=!0};#_=t=>{this.isDrawingOverlay=!1}}class G{#t;#s;#e;#r;#o;#i;#n;constructor(t){this.#t=!1,this.#s=!1,this.#e=new Map,this.#r=0,this.#o=0,this.#i=0,this.#n=0,this.#a(t)}enableDebug(t){this.#t=!0,t&&(this.#s=!0)}disableDebug(){this.#t=!1,this.#s=!1}updateDisplay(t,e){if(!this.#t)return;this.#d(t,e);const i=this.#e.get("fps");i&&(i.textContent=`FPS: ${this.#o.toFixed(2)}`);const s=this.#e.get("tps");s&&(s.textContent=`TPS: ${this.#i.toFixed(2)}`)}#d(t,e){const i=t-this.#n;i>=1e3&&(this.#o=this.#r*1e3/i,this.#i=e.tickCount*1e3/i,this.#r=0,e.tickCount=0,this.#n=t),this.#r++}#a(t){const e=document.createElement("div");e.classList.add("debug-container"),t.appendChild(e),this.#e.set("debug-container",e);const i=document.createElement("div");i.classList.add("debug-info-container"),e.appendChild(i),this.#e.set("info-container",i);const s=document.createElement("div");s.classList.add("debug-info"),i.appendChild(s),this.#e.set("fps",s);const n=document.createElement("div");n.classList.add("debug-info"),i.appendChild(n),this.#e.set("tps",n)}}async function H(){try{const c=T.GAME_WIDTH,t=T.GAME_HEIGHT,e=document.getElementById("main-canvas");if(!(e instanceof HTMLCanvasElement))throw new Error("HTML element 'main-canvas' does not exist.");const i=document.getElementById("main-panel");if(!(i instanceof HTMLDivElement))throw new Error("HTML element 'main-panel' does not exist.");const s=new R(c,t,e),n=await _("./src/data/particles.data"),o=new U(c,t,T,n,i,e,s),r=new G(i);r.enableDebug(!0),new B(c,t,n,s,o,r).start(),console.log(n)}catch(c){console.error("CRITICAL ERROR: Failed to initialize engine due to data loading failure.",c)}}H();
