var r=(a,b)=>{if(!b.has(a))throw TypeError("Cannot read from private field");return b.get(a)},t=(a,b)=>{if(b.has(a))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(a):b.set(a,void 0)},w=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot write to private field");b.set(a,c)},x=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot access private method");return c};
(function(){function a(c){if(!c.xa){c.xa=!0;var d={};d=(c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d);fetch(c.href,d)}}const b=document.createElement("link").relList;if(!(b&&b.supports&&b.supports("modulepreload"))){for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);(new MutationObserver(c=>
{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)})).observe(document,{childList:!0,subtree:!0})}})();function aa(a,b,c){if(a.o.push(...b),c){const d=a.g.v,h=a.g.u;for(const e of b)a.m.push({index:(h-1-e.position.y)*d+e.position.x,value:c})}}
function ba(a,b,c){var d=a.g.N;const h=[],e=a.g.v,k=a.g.u,g=[-1,1];a=(m,n)=>{for(const p of g)for(const q of g){const v=b+m*q,u=c+n*p,H=b+n*q,I=c+m*p;v>=0&&v<e&&u>=0&&u<k&&h.push({index:(k-u)*e+v,value:new Uint8ClampedArray([227,227,227,180])});H>=0&&H<e&&I>=0&&I<k&&h.push({index:(k-I)*e+H,value:new Uint8ClampedArray([227,227,227,180])})}};let l=d,f=0;d-=d;for(a(l,f);f<l;)f++,d<0?d+=2*f+1:(l--,d+=2*(f-l)+1),a(l,f);return h}
function y(a,b){for(const {index:d,value:h}of b){var c=h[3];b=c/255;const e=Math.round(h[1]*b+a[d*4+1]*(1-b)),k=Math.round(h[2]*b+a[d*4+2]*(1-b));c=Math.min(a[d*4+3],c);a[d*4]=Math.round(h[0]*b+a[d*4]*(1-b));a[d*4+1]=e;a[d*4+2]=k;a[d*4+3]=c}}
class ca{constructor(a,b){this.g=a;this.h=b;this.l=this.h.getContext("2d");this.j=new Uint8ClampedArray(this.g.v*this.g.u*4);this.o=[];this.m=[];this.A=[];this.h.style.aspectRatio=(this.g.v/this.g.u).toString();this.h.width=this.g.v;this.h.height=this.g.u;this.l.imageSmoothingEnabled=!1;this.l.translate(0,this.h.height);this.l.scale(1,-1)}}
const z=Object.freeze({Ra:new Uint8ClampedArray([255,255,255,255]),ea:new Uint8ClampedArray([0,0,0,255]),Ja:new Uint8ClampedArray([128,128,128,255]),RED:new Uint8ClampedArray([255,0,0,255]),Ka:new Uint8ClampedArray([0,255,0,255]),Da:new Uint8ClampedArray([0,0,255,255]),Sa:new Uint8ClampedArray([255,255,0,255]),Ea:new Uint8ClampedArray([0,255,255,255]),La:new Uint8ClampedArray([255,0,255,255]),Oa:new Uint8ClampedArray([0,0,0,0]),Na:new Uint8ClampedArray([255,255,255,128])});
function A(a){if(a==null)return z.ea;a=a.replace("#","");if(a.length===6)a+="FF";else if(a.length===3){let c="";for(var b of a)c+=b,c+=b;a=c+"FF"}else return z.ea;b=parseInt(a,16);return new Uint8ClampedArray([b>>24&255,b>>16&255,b>>8&255,b&255])}function B(a){a=[...a];for(let b=a.length-1;b>0;b--){const c=Math.floor(Math.random()*(b+1));[a[b],a[c]]=[a[c],a[b]]}return a}
function da(a){var b=Math.max(10,Math.min(a,80));const c=b*Math.PI/180;a=[];(a.push([{dx:0,dy:-1}]),b<50)?(a.push([{dx:1,dy:-1},{dx:-1,dy:-1}]),b=Math.round(1/Math.tan(c)),a.push([{dx:b,dy:-1},{dx:b*-1,dy:-1}])):(b=Math.round(Math.tan(c)),a.push([{dx:1,dy:-b},{dx:-1,dy:-b}]));return a}
const ea=Object.freeze({na:[{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}]}),C=Object.freeze({Pa:{dx:-1,dy:1},va:{dx:0,dy:1},Qa:{dx:1,dy:1},ua:{dx:-1,dy:0},Ma:{dx:1,dy:0},Ga:{dx:-1,dy:-1},Fa:{dx:0,dy:-1},Ha:{dx:1,dy:-1}});var D,E,F,G,J;function K(a,b){r(a,E).add(b.index);b=fa(a,b);for(const c of b)r(a,E).add(c.index)}function L(a,b,c){return b>=0&&b<a.width&&c>=0&&c<a.height?r(a,D)[c*a.width+b]:null}
function M(a,b,c,d=!1){for(var h of c)if(h){c=B(h);for(const e of c)if(c=e.dx,d&&Math.random()>.5&&(c=e.dx*-1),(c=L(a,b.position.x+c,b.position.y+e.dy))&&c.T&&b.H>c.H)return r(a,D)[c.index]=b,r(a,D)[b.index]=c,d={x:b.position.x,y:b.position.y},h=b.index,b.position=c.position,b.index=c.index,c.position=d,c.index=h,K(a,b),K(a,c),c}return null}
function ha(a,b,c){r(a,D)[b.index]=c;r(a,D)[c.index]=b;const d={x:b.position.x,y:b.position.y},h=b.index;b.position=c.position;b.index=c.index;c.position=d;c.index=h;K(a,b);K(a,c)}function N(a,b,c){return L(a,b.position.x+c.dx,b.position.y+c.dy)}function fa(a,b){return ea.na.map(c=>N(a,b,c)).filter(c=>c!==null).filter(()=>!0)}
function O(a,b,c,d,h){for(let f=-d;f<=d;f++)for(let m=-d;m<=d;m++)if(!(f*f+m*m>d*d)){var e=b+f,k=c+m;if(e>=0&&e<a.width&&k>=0&&k<a.height){var g=L(a,e,k);if(h===0||g===null||g.id===0){g=a;var l=h;e>=0&&e<g.width&&k>=0&&k<g.height&&(l=x(g,F,G).call(g,l),l.position.x=e,l.position.y=k,l.index=k*g.width+e,K(g,l),r(g,D)[k*g.width+e]=l)}}}}
class ia{constructor(a,b,c){t(this,F);t(this,D);t(this,E);this.width=a;this.height=b;w(this,D,Array(a*b));w(this,E,new Set);this.W=c;x(this,F,J).call(this,0)}get data(){return r(this,D)}get g(){return r(this,E)}}D=new WeakMap;E=new WeakMap;F=new WeakSet;
G=function(a){a=this.W[a];if(!a)return null;var b=Math.round(Math.random()*5)/5;const c=A(a.S),d=A(a.ca);b=new Uint8ClampedArray([c[0]+(d[0]-c[0])*b,c[1]+(d[1]-c[1])*b,c[2]+(d[2]-c[2])*b,c[3]+(d[3]-c[3])*b]);b={handle:-1,id:a.id,name:a.name,color:b,position:{x:-1,y:-1},index:0,T:a.T,H:a.H};return a.i===0?{...b,i:0}:a.i===1?{...b,i:1}:a.i===2?{...b,i:2,Ta:0,ja:a.ja}:a.i===3?{...b,i:3}:a.i===4?{...b,i:4,ka:a.ka,aa:a.aa}:a.i===5?{...b,i:5,node:-1}:null};
J=function(a){const b=this.width,c=this.height;w(this,D,Array(b*c));for(let d=0;d<c;d++)for(let h=0;h<b;h++){let e=d*b+h,k=x(this,F,G).call(this,a);k&&(k.position.x=h,k.position.y=d,k.index=e,r(this,D)[e]=k,r(this,E).add(k.index))}};var P,Q;
function ja(a){var b=[];for(const c of a.B.g)b.push(a.B.data[c]);a.l++;a.l>2&&(a.B.g.clear(),a.l=0);aa(a.M,b,a.A.ya?new Uint8ClampedArray([210,55,55,180]):void 0);a.C.clear();b=B(b);b.sort((c,d)=>c.position.y-d.position.y);for(const c of b)if(c&&!a.C.has(c.index))switch(c.i){case 2:ka(a,c);break;case 3:la(a,c);break;case 4:x(a,P,Q).call(a,c)}b=ma(a.B);na(a,b)}
function ka(a,b){const c=M(a.B,b,[[{dx:0,dy:-1}],[{dx:-1,dy:-1},{dx:1,dy:-1}],[{dx:-1,dy:0},{dx:1,dy:0}]],!1);c&&(a.C.add(b.index),a.C.add(c.index))}function la(a,b){const c=M(a.B,b,[[C[a.L[Math.floor(Math.random()*a.L.length)]]]],!1);c&&(a.C.add(b.index),a.C.add(c.index))}
function ma(a){const b=a.width;var c=a.height;const d=[],h=[],e={};for(--c;c>=0;c--)for(let m=0;m<b;m++){var k=c*b+m,g=L(a,m,c);if(!g||g.i!==2||g.i!==2)continue;const n=N(a,g,C.va);var l=N(a,g,C.ua),f=n&&n.id===g.id;const p=l&&l.id===g.id;let q=-1;p&&(q=c*b+(m-1));let v=-1;f&&(v=(c+1)*b+m);l=n&&n.id===0;if(p||f)if(p&&!f)f=e[q],d[f].push(k),l&&(h[f].G.push(g),h[f].I.push(n)),e[k]=f;else if(!p&&f)f=e[v],d[f].push(k),l&&(h[f].G.push(g),h[f].I.push(n)),e[k]=f;else{if(f=e[v],d[f].push(k),l&&(h[f].G.push(g),
h[f].I.push(n)),e[k]=f,k=e[q],k!==f){g=h[k];for(const u of g.G)h[f].G.push(u);for(const u of g.I)h[f].I.push(u);g=d[k];for(const u of g)e[u]=f;d[k]=[];h[k]={G:[],I:[]}}}else f=h.length,d.push([k]),h.push({G:[],I:[]}),l&&(h[f].G.push(g),h[f].I.push(n)),e[k]=f}return h.filter(m=>m.G.length>30)}
function na(a,b){for(const c of b){b=c.G.sort((g,l)=>l.position.y-g.position.y);const d=c.I.sort((g,l)=>g.position.y-l.position.y),h=b.length;let e=0;const k=h/4;for(let g=0;g<h;g++){const l=b[g],f=d[g];if(Math.sqrt(l.position.x*f.position.x+l.position.y*f.position.y),l.position.y>f.position.y&&(ha(a.B,l,f),a.C.add(l.index),a.C.add(f.index),e++,e>=k))break}}}
class oa{constructor(a,b,c){t(this,P);this.m=!1;this.l=this.h=this.o=this.j=0;this.L=Object.keys(C);this.J=d=>{if(this.m){this.j===0&&(this.j=d);var h=d-this.j;this.j=d;var e=this.A;if(e.j){if(e.frameCount++,d>=e.g+1E3){var k=d-e.g;e.l=e.frameCount*1E3/k;e.m=this.o*1E3/k;this.o=e.frameCount=0;e.g=d}e.$&&(e.$.textContent=`FPS: ${e.l.toFixed(0)}`);e.ba&&(e.ba.textContent=`TPS: ${e.m.toFixed(0)}`)}this.g.D&&O(this.B,Math.floor(this.g.U),Math.floor(this.g.V),this.g.N,this.g.R);this.g.F&&O(this.B,Math.floor(this.g.U),
Math.floor(this.g.V),this.g.N,0);this.h+=h;for(d=0;this.h>=this.K;)if(ja(this),d++,this.o++,this.h-=this.K,d>60){this.h=0;break}d=this.M;d.g.O&&(d.A=ba(d,Math.floor(d.g.U),Math.floor(d.g.V)));k=d.o;h=d.g.v;e=d.g.u;for(var g of k){k=(e-1-g.position.y)*h+g.position.x;let l=g.color;d.j[k*4]=l[0];d.j[k*4+1]=l[1];d.j[k*4+2]=l[2];d.j[k*4+3]=l[3]}g=new Uint8ClampedArray(d.j);y(g,d.m);y(g,d.A);g=new ImageData(g,d.g.v,d.g.u);d.l.putImageData(g,0,0);d.o.length=0;d.m=[];d.A=[];requestAnimationFrame(this.J)}};
this.g=a;this.M=b;this.A=c;this.B=new ia(this.g.v,this.g.u,this.g.W);this.C=new Set;this.X=this.g.X;this.K=this.g.K}start(){this.m||(this.m=!0,this.j=0,requestAnimationFrame(this.J))}}P=new WeakSet;Q=function(a){const b=M(this.B,a,a.aa,!0);b&&(this.C.add(a.index),this.C.add(b.index))};
function pa(a,b,c,d){var h=R;const e=document.createElement("div");return e.classList.add("ui-window"),e.style.left=`${b.x}px`,e.style.top=`${b.y}px`,e.style.width=`${c.width}px`,e.style.height=`${c.height}px`,e.style.maxWidth=`${d.width}px`,e.style.maxHeight=`${d.height}px`,e.style.zIndex=h.toString(),e.addEventListener("mousedown",a.da),e}
function qa(a,b){const c=document.createElement("div");c.classList.add("ui-window__title-bar");const d=document.createElement("span");return d.classList.add("ui-window__title"),d.textContent=b,c.appendChild(d),c.addEventListener("pointerdown",a.pa),c.addEventListener("pointermove",a.ra),c.addEventListener("pointerup",a.sa),c}
function ra(a){const b=document.createElement("div");b.classList.add("ui-window__title-bar__button__wrapper");const c=document.createElement("button");c.classList.add("ui-window__title-bar__button");const d=document.createElement("img");return d.src="./assets/icons/close.svg",c.appendChild(d),b.appendChild(c),c.addEventListener("pointerdown",h=>{h.stopPropagation()}),c.addEventListener("click",()=>{S(a,!1)}),b}
function sa(){const a=document.createElement("div");return a.classList.add("ui-window__content__wrapper","left"),a}function ta(){const a=document.createElement("div");return a.classList.add("ui-window__content-bar"),a}function ua(){const a=document.createElement("div");return a.classList.add("ui-window__content-container"),a}function S(a,b){b?a.g.classList.add("is-visible"):a.g.classList.remove("is-visible");a.isVisible=b}
function T(a,b){a.l.classList.remove("top","bottom","left","right");a.l.classList.add(b)}function U(a,b){(b=a.h[b])&&va(a,b)}
function V(a,b,c,d){let h=a.h.length;a.h.length!==0&&(b.style.display="none");b.id="container-"+h;a.M.appendChild(b);const e=document.createElement("button");e.classList.add("ui-window__content-bar__button");e.title=c;a.o.appendChild(e);const k=document.createElement("img");k.classList.add("ui-window__content-bar__button__icon");k.alt=c;k.src=d;e.appendChild(k);e.addEventListener("click",()=>U(a,h));a.L.push(e);a.h.push(b)}
function va(a,b){const c=a.h;for(let d=0;d<c.length;d++){const h=c[d];if(h===b){a.h.forEach(e=>{e.style.display="none"});h.style.display="";a.L.forEach((e,k)=>{k===d?e.classList.add("active"):e.classList.remove("active")});break}}}function wa(a){const b=document.createElement("div");b.classList.add("ui-window__content-bar__separator");b.classList.add("is-spacer");a.o.appendChild(b)}
const W=class{constructor(a,b,c,d,h){this.h=[];this.L=[];this.m=!1;this.A={x:0,y:0};this.ta=()=>{const e=this.g.offsetLeft,k=this.g.offsetTop,g=Math.max(0,Math.min(e,Math.max(0,this.j.offsetWidth-this.g.offsetWidth))),l=Math.max(0,Math.min(k,Math.max(0,this.j.offsetHeight-this.g.offsetHeight)));(g!==e||l!==k)&&(this.g.style.left=`${g}px`,this.g.style.top=`${l}px`)};this.da=()=>{R++;this.g.style.zIndex=R.toString()};this.pa=e=>{if(e.stopPropagation(),this.da(),e.button===0){this.J.setPointerCapture(e.pointerId);
const k=this.g.getBoundingClientRect();this.A.x=e.clientX-k.left;this.A.y=e.clientY-k.top;this.m=!0}else this.m=!1};this.sa=e=>{this.m&&(this.J.releasePointerCapture(e.pointerId),this.m=!1)};this.ra=e=>{if(this.m){const k=this.j.getBoundingClientRect(),g=Math.max(0,Math.min(e.clientY-this.A.y-k.top,this.j.offsetHeight-this.g.offsetHeight));this.g.style.left=`${Math.max(0,Math.min(e.clientX-this.A.x-k.left,this.j.offsetWidth-this.g.offsetWidth))}px`;this.g.style.top=`${g}px`}};this.title=b;this.position=
c;this.size=d;this.isVisible=!1;this.j=a;this.g=pa(this,c,d,h);this.J=qa(this,b);this.oa=ra(this);this.l=sa();this.o=ta();this.M=ua();this.j.appendChild(this.g);this.J.appendChild(this.oa);this.g.appendChild(this.J);this.l.appendChild(this.o);this.l.appendChild(this.M);this.g.appendChild(this.l);window.addEventListener("resize",this.ta)}};var R=100;
function xa(a){var b=["Top","Left","Right","Bottom"];const c=document.createElement("div");c.classList.add("ui-window__helper__flex-row");const d=document.createElement("label");d.textContent="Orientation:";c.appendChild(d);const h=document.createElement("div");h.classList.add("ui-window__content__dropdown-button__wrapper");c.appendChild(h);const e=document.createElement("div");e.classList.add("ui-window__content__dropdown-button");const k=document.createElement("span");k.textContent=b[0]?b[0]:"Template Item";
k.id="palette-orientation-display";e.appendChild(k);h.appendChild(e);const g=document.createElement("ul");g.classList.add("ui-window__content__dropdown-list");g.id="palette-orientation-list";h.appendChild(g);let l=Math.max(0,Math.min(3,b.length-1));const f=[];for(let m=0;m<b.length;m++){const n=b[m],p=document.createElement("li");p.style.marginBottom="0px";p.classList.add("ui-window__content__dropdown-item");p.textContent=n;p.dataset.index=m.toString();p.dataset.value=n.toLowerCase().replace(/\s/g,
"-");m===l&&(p.classList.add("is-selected"),k.textContent=n);p.addEventListener("click",q=>{q.stopPropagation();f[l].classList.remove("is-selected");l=m;p.classList.add("is-selected");k.textContent=n;g.classList.remove("is-open")});g.appendChild(p);f.push(p)}return e.addEventListener("click",m=>{if(m.stopPropagation(),g.classList.toggle("is-open")){g.parentElement;g.dataset.Ba=h.id;document.body.appendChild(g);var n=e.getBoundingClientRect();m=g.getBoundingClientRect();m=g.scrollHeight||m.height;
const q=document.documentElement.clientHeight;g.style.position="absolute";g.style.left=`${n.left}px`;g.style.width=`${n.width}px`;g.style.zIndex="9999";var p=g.querySelector(".dropdown-item.is-selected");p?(p=p.offsetTop,n=n.top-p,n<0&&(n=0),n+m>q&&(n=Math.max(0,q-m)),g.style.top=`${Math.round(n)}px`,g.scrollTop=p):(n=n.bottom,n+m>q&&(n=Math.max(0,q-m)),g.style.top=`${Math.round(n)}px`,g.scrollTop=0)}else g.parentElement===document.body&&h.appendChild(g)}),a.g.appendChild(c),{button:e,items:f}}
class ya{constructor(){this.g=document.createElement("div");this.g.classList.add("ui-window__content")}}var X,Y=X||{};X=(Y[Y.fa=1]="Palette",Y[Y.qa=2]="DebugStats",Y[Y.Ia=3]="DebugQuickLook",Y);function za(){document.addEventListener("click",a=>{document.querySelectorAll(".ui-window__content__dropdown-list.is-open").forEach(b=>{var c=b.dataset.Ba;c=c?document.getElementById(c):null;b.contains(a.target)||c?.contains(a.target)||(b.classList.remove("is-open"),c?.appendChild(b))})})}
function Z(a,b){a:{var c=a.l.get(b);if(!c){switch(b){case 1:c=Aa(a);break;case 2:c=new W(a.j,"Debug Stats",{x:80,y:80},{width:260,height:46},{width:260,height:46});var d=document.createElement("div");d.classList.add("debug__stats-content");V(c,d,"Stats Content","./assets/icons/settings.svg");const h=document.createElement("div");h.classList.add("debug__stats-content__info-container");d.appendChild(h);const e=document.createElement("div");e.classList.add("debug__stats-content__info-container");d.appendChild(e);
if(d=a.g.ha)d.$=h,d.ba=e;break;default:a=void 0;break a}a.l.set(b,c)}a=c}a&&!a.isVisible&&S(a,!0)}
function Aa(a){var b=(g,l,f)=>{l.addEventListener("click",()=>{if(a.g.P!==f+1){a.h&&a.h.classList.remove("selected");var m=g.querySelector(".particle-button");m?(m.classList.add("selected"),a.h=m,a.g.R=parseInt(m.dataset.Ca||"0",10),a.g.P=parseInt(m.dataset.i||"0",10)):(a.g.R=0,a.g.P=0)}})};const c=g=>{const l=document.createElement("button");l.className="particle-button";l.textContent=g.name;var f=g.S;f=f.startsWith("#")?f.substring(1):f;f.length<6?f=0:(f=parseInt(f,16),f=.299*(f>>16&255)+.587*(f>>
8&255)+.114*(f&255));var m=f>210;f=m?"#323238":"#FFFFFF";m=m?"#FFFFFF":"#323238";return l.style.setProperty("--particle-button-base-color",g.S),l.style.setProperty("--particle-button-variant-color",g.ca),l.style.color=f,l.style.textShadow=`1px 1px 2px rgba(${m[0]}, ${m[1]}, ${m[2]}, 0.6)`,l.dataset.Ca=g.id.toString(),l.dataset.i=g.i.toString(),l},d=new W(a.j,"Particle Palette",{x:390,y:124},{width:332,height:206},{width:420,height:400}),h=(g=>{const l=[];var f=document.createElement("div");f.classList.add("particle-palette-container");
V(g,f,"Solids","./assets/icons/solid.svg");l.push(f);f=document.createElement("div");f.classList.add("particle-palette-container");V(g,f,"Liquids","./assets/icons/liquid.svg");l.push(f);f=document.createElement("div");f.classList.add("particle-palette-container");V(g,f,"Gases","./assets/icons/gas.svg");l.push(f);f=document.createElement("div");f.classList.add("particle-palette-container");V(g,f,"Sands","./assets/icons/sand.svg");l.push(f);f=document.createElement("div");f.classList.add("particle-palette-container");
V(g,f,"Electronics","./assets/icons/electronics.svg");l.push(f);f=new ya;let {items:m}=xa(f);return m.forEach(n=>{n.addEventListener("click",()=>{const p=n.dataset.value;p&&T(g,p)})}),wa(g),V(g,f.g,"Settings","./assets/icons/settings.svg"),l.push(f.g),l})(d);for(var e=0;e<h.length-1;e++){var k=h[e];const g=d.L[e];g!==void 0&&b(k,g,e)}d.o.classList.add("is-visible");T(d,"bottom");U(d,1);b=a.g.W;e=null;for(const g in b){const l=b[g];k=h[l.i-1];if(!k)continue;const f=c(l);f.addEventListener("click",
()=>{a.h&&a.h.classList.remove("selected");f.classList.add("selected");a.h=f;a.g.R=l.id;a.g.P=l.i});k.appendChild(f);!e&&l.i===2&&(e=f,e.classList.add("selected"),a.h=e,a.g.R=l.id,a.g.P=l.i)}return d}class Ba{constructor(a,b){this.l=new Map;this.h=null;this.j=a;this.g=b;za()}}
function Ca(a){const b=[{id:"bog-menu-item",items:["Settings","Quit"]},{id:"world-item",items:["Particle Palette"]},{id:"debug-item",items:["Quick Look","Stats","Debug Menu"]},{id:"help-item",items:["About","Report Issue"]}],c=[];for(let h=0;h<b.length;h++){var d=b[h];if(!d)continue;const e=document.getElementById(d.id);if(!(e instanceof HTMLDivElement))continue;d=Da(e,d.items);d.items.forEach(g=>{c.push(g)});const k=d.Aa;e.addEventListener("click",g=>{g.stopPropagation();(g=document.querySelector(".app-menu__dropdown.is-open"))&&
g!==k&&g.classList.remove("is-open");a.l=k.classList.toggle("is-open")});e.addEventListener("mouseenter",()=>{if(a.l&&!k.classList.contains("is-open")){const g=document.querySelector(".app-menu__dropdown.is-open");g&&g!==k&&g.classList.remove("is-open");k.classList.add("is-open")}})}c.forEach(h=>{switch(h.textContent){case "Particle Palette":h.classList.remove("is-disabled");h.addEventListener("click",()=>{Z(a.m,X.fa)});break;case "Stats":h.classList.remove("is-disabled");h.addEventListener("click",
()=>{Z(a.m,X.qa)});break;case "About":h.classList.remove("is-disabled");h.addEventListener("click",()=>{window.open("https://github.com/misuldansin/bog-engine/","_blank")});break;case "Report Issue":h.classList.remove("is-disabled"),h.addEventListener("click",()=>{window.open("https://github.com/misuldansin/bog-engine/issues/new","_blank")})}})}
function Ea(a){const b=c=>{const d=a.h.getBoundingClientRect(),h=a.h.height-a.g.u/d.height*(c.clientY-d.top);a.g.U=a.g.v/d.width*(c.clientX-d.left);a.g.V=h};a.h.addEventListener("pointerdown",c=>{switch(b(c),c.button){case 0:a.g.D=!0;break;case 2:a.g.F=!0;break;default:a.g.D=!1,a.g.F=!1}try{a.h.setPointerCapture(c.pointerId)}catch{}a.j=c.pointerId});a.h.addEventListener("pointermove",c=>{b(c);typeof c.buttons=="number"&&(a.g.D=(c.buttons&1)===1,a.g.F=(c.buttons&2)===2)});a.h.addEventListener("pointerup",
c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("pointercancel",c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("lostpointercapture",c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("pointerenter",()=>{a.g.O=!0});a.h.addEventListener("pointerleave",()=>{a.g.O=!1});a.h.addEventListener("focus",
()=>{a.g.O=!0});a.h.addEventListener("blur",()=>{a.g.O=!1});a.h.addEventListener("wheel",c=>{c.preventDefault();a.g.N=Math.max(0,Math.min(Math.floor(a.g.N-c.deltaY*a.g.Z),a.g.Y))},{passive:!1});window.addEventListener("pointerup",()=>{a.g.D=!1;a.g.F=!1;a.j=null});document.addEventListener("visibilitychange",()=>{document.hidden&&(a.g.D=!1,a.g.F=!1,a.j=null)})}
function Da(a,b){const c=document.createElement("div");c.classList.add("app-menu__dropdown");let d=[];return b.forEach(h=>{const e=document.createElement("div");e.classList.add("app-menu__dropdown-item","is-disabled");e.textContent=h;c.appendChild(e);d.push(e)}),a.appendChild(c),{Aa:c,items:d}}
class Fa{constructor(a,b,c){this.j=null;this.l=!1;this.g=a;this.m=new Ba(b,a);this.o=b;this.h=c;Ca(this);Ea(this);this.o.addEventListener("contextmenu",d=>{d.preventDefault()});document.addEventListener("click",()=>{const d=document.querySelector(".app-menu__dropdown.is-open");d instanceof HTMLDivElement&&(d.classList.remove("is-open"),this.l=!1)});Z(this.m,X.fa)}}
class Ga{constructor(a){this.ba=this.$=null;this.g=this.m=this.l=this.frameCount=0;this.ya=this.j=!1;this.h=new Map;const b=document.createElement("div");b.classList.add("debug-container");a.appendChild(b);this.h.set("debug-container",b);a=document.createElement("div");a.classList.add("debug-info-container");b.appendChild(a);this.h.set("info-container",a)}}
async function Ha(a){try{const b=await fetch(a);if(!b.ok)throw Error(`HTTP error! Status: ${b.status}`);return await b.text()}catch(b){throw console.error(`Failed to read particle data from ${a}:`,b),Error("Failed to load particle data.");}}
async function Ia(){var a=await Ha("./src/data/particles.data");let b={};var c=new Set,d=null;for(var h of a.split("\n"))if(a=h.trim(),a.length!==0&&!a.startsWith("#"))if(a.startsWith("[")&&a.endsWith("]"))a=parseInt(a.slice(1,-1),10),isNaN(a)||a<10?d=null:c.has(a)?(console.warn(`[Loader] Duplicate ID found: ${a}. Ignoring.`),d=null):(c.add(a),d=a,b[a]={});else if(d!==null&&(a=a.split(":").map(e=>e.trim()),a.length===2)){const e=a[1],k=b[d];switch(a[0]){case "name":k.name=e;break;case "category":k.i=
parseInt(e,10);break;case "base_color":k.ga=e;break;case "variant_color":k.ma=e;break;case "is_movable":k.ia=e==="true";break;case "density":k.H=parseFloat(e);break;case "max_concentration":k.za=parseInt(e);break;case "repose_angle":k.la=parseFloat(e)}}c={};for(const e in b)d=b[e],h=parseInt(e,10),d.name===void 0||d.i===void 0||d.ga===void 0||d.ma===void 0||d.ia===void 0||d.H===void 0?console.warn(`[Loader] Corrupted particle block found of ID: ${h}. Missing core properties.`):(a={id:h,name:d.name,
S:d.ga,ca:d.ma,T:d.ia,H:d.H},d.i===1?c[h]={...a,i:1}:d.i===2?c[h]={...a,ja:d.za,i:2}:d.i===3?c[h]={...a,i:3}:d.i===4?c[h]={...a,i:4,ka:d.la,aa:da(d.la)}:d.i===5&&(c[h]={...a,i:5}));return c[0]={id:0,name:"Empty",i:0,S:"#0E0E11",ca:"#0E0E11",T:!0,H:0},c}
async function Ja(){var a,b,c,d,h,e,k,g,l,f=(await Ha("./src/data/settings.data")).split(/\r?\n/);for(const p of f){var m=p.trim();if(m.length===0||m.startsWith("#"))continue;var n=m.indexOf(".");const q=m.indexOf(":");if(!(q===-1||n===-1||n>=q)&&(f=m.substring(0,n).trim(),n=m.substring(n+1,q).trim(),m=m.substring(q+1).trim(),f&&n&&m!==void 0&&m.length!==0))if(f==="engine")switch(n){case "width":f=parseInt(m);isNaN(f)||(a=f);break;case "height":f=parseInt(m);isNaN(f)||(b=f);break;case "render_interval":f=
parseFloat(m);isNaN(f)||(c=f);break;case "physics_interval":f=parseFloat(m),isNaN(f)||(d=f)}else if(f==="input")switch(n){case "brush_size":f=parseInt(m);isNaN(f)||(h=f);break;case "brush_max_size":f=parseInt(m);isNaN(f)||(e=f);break;case "brush_sensitivity":f=parseFloat(m),isNaN(f)||(k=f)}else if(f==="debug")switch(n){case "start_enabled":m.toLowerCase()==="true"?g=!0:m.toLowerCase()==="false"&&(g=!1);break;case "overlay_start_enabled":m.toLowerCase()==="true"?l=!0:m.toLowerCase()==="false"&&(l=
!1)}}return{v:a??342,u:b??192,X:c??16.667,K:d??25,wa:h??4,Y:e??42,Z:k??.02,Ua:g??!1,Va:l??!1}}class Ka{constructor(a,b){this.ha=null;this.V=this.U=0;this.F=this.D=!1;this.O=!0;this.v=a.v;this.u=a.u;this.W=b;this.Y=a.Y;this.Z=a.Z;this.R=0;this.P=2;this.X=a.X;this.K=a.K;this.N=a.wa}}function La(a,b){const c=document.getElementById(a);if(!(c instanceof b))throw Error(`Missing or invalid <${b.name.toLowerCase()} id='${a}'> element in DOM.`);return c}
(async function(){try{const a=La("viewport",HTMLDivElement),b=La("render-surface",HTMLCanvasElement),c=await Ia();if(!c)throw Error('Failed to load particle data from "./src/data/particles.data"');const d=await Ja();if(!d)throw Error('Failed to load settings from "./src/data/settings.data"');const h=new Ka(d,c),e=new ca(h,b);new Fa(h,a,b);const k=new Ga(a);k.j=!0;h.ha=k;(new oa(h,e,k)).start()}catch(a){console.error("ERROR: Failed to initialize app:",a)}})();
