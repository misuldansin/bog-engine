var u=(a,b)=>{if(!b.has(a))throw TypeError("Cannot read from private field");return b.get(a)},v=(a,b)=>{if(b.has(a))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(a):b.set(a,void 0)},x=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot write to private field");b.set(a,c)},y=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot access private method");return c};
(function(){function a(c){if(!c.ua){c.ua=!0;var d={};d=(c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d);fetch(c.href,d)}}const b=document.createElement("link").relList;if(!(b&&b.supports&&b.supports("modulepreload"))){for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);(new MutationObserver(c=>
{for(const d of c)if(d.type==="childList")for(const e of d.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&a(e)})).observe(document,{childList:!0,subtree:!0})}})();
function aa(a,b,c){var d=a.g.M;const e=[],f=a.g.A,g=a.g.v,m=[-1,1];a=(l,n)=>{for(const r of m)for(const p of m){const q=b+l*p,t=c+n*r,w=b+n*p,M=c+l*r;q>=0&&q<f&&t>=0&&t<g&&e.push({index:(g-t)*f+q,value:new Uint8ClampedArray([227,227,227,180])});w>=0&&w<f&&M>=0&&M<g&&e.push({index:(g-M)*f+w,value:new Uint8ClampedArray([227,227,227,180])})}};let k=d,h=0;d-=d;for(a(k,h);h<k;)h++,d<0?d+=2*h+1:(k--,d+=2*(h-k)+1),a(k,h);return e}
function z(a,b){for(const {index:d,value:e}of b){var c=e[3];b=c/255;const f=Math.round(e[1]*b+a[d*4+1]*(1-b)),g=Math.round(e[2]*b+a[d*4+2]*(1-b));c=Math.min(a[d*4+3],c);a[d*4]=Math.round(e[0]*b+a[d*4]*(1-b));a[d*4+1]=f;a[d*4+2]=g;a[d*4+3]=c}}
class ba{constructor(a,b){this.g=a;this.h=b;this.l=this.h.getContext("2d");this.j=new Uint8ClampedArray(this.g.A*this.g.v*4);this.o=[];this.m=[];this.u=[];this.h.style.aspectRatio=(this.g.A/this.g.v).toString();this.h.width=this.g.A;this.h.height=this.g.v;this.l.imageSmoothingEnabled=!1;this.l.translate(0,this.h.height);this.l.scale(1,-1)}}
const A=Object.freeze({Na:new Uint8ClampedArray([255,255,255,255]),ca:new Uint8ClampedArray([0,0,0,255]),Fa:new Uint8ClampedArray([128,128,128,255]),RED:new Uint8ClampedArray([255,0,0,255]),Ga:new Uint8ClampedArray([0,255,0,255]),Aa:new Uint8ClampedArray([0,0,255,255]),Oa:new Uint8ClampedArray([255,255,0,255]),Ba:new Uint8ClampedArray([0,255,255,255]),Ha:new Uint8ClampedArray([255,0,255,255]),Ka:new Uint8ClampedArray([0,0,0,0]),Ja:new Uint8ClampedArray([255,255,255,128])});
function B(a){if(a==null)return A.ca;a=a.replace("#","");if(a.length===6)a+="FF";else if(a.length===3){let c="";for(var b of a)c+=b,c+=b;a=c+"FF"}else return A.ca;b=parseInt(a,16);return new Uint8ClampedArray([b>>24&255,b>>16&255,b>>8&255,b&255])}function ca(a){return.299*a[0]+.587*a[1]+.114*a[2]}function C(a){a=[...a];for(let b=a.length-1;b>0;b--){const c=Math.floor(Math.random()*(b+1));[a[b],a[c]]=[a[c],a[b]]}return a}
function da(a){var b=Math.max(10,Math.min(a,80));const c=b*Math.PI/180;a=[];(a.push([{dx:0,dy:-1}]),b<50)?(a.push([{dx:1,dy:-1},{dx:-1,dy:-1}]),b=Math.round(1/Math.tan(c)),a.push([{dx:b,dy:-1},{dx:b*-1,dy:-1}])):(b=Math.round(Math.tan(c)),a.push([{dx:1,dy:-b},{dx:-1,dy:-b}]));return a}
const ea=Object.freeze({oa:[{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}]}),D=Object.freeze({La:{dx:-1,dy:1},sa:{dx:0,dy:1},Ma:{dx:1,dy:1},ra:{dx:-1,dy:0},Ia:{dx:1,dy:0},Da:{dx:-1,dy:-1},Ca:{dx:0,dy:-1},Ea:{dx:1,dy:-1}});var E,F,G,H,I;function J(a,b){u(a,F).add(b.index);b=fa(a,b);for(const c of b)u(a,F).add(c.index)}function K(a,b,c){return b>=0&&b<a.width&&c>=0&&c<a.height?u(a,E)[c*a.width+b]:null}
function L(a,b,c,d=!1){for(var e of c)if(e){c=C(e);for(const f of c)if(c=f.dx,d&&Math.random()>.5&&(c=f.dx*-1),(c=K(a,b.position.x+c,b.position.y+f.dy))&&c.T&&b.H>c.H)return u(a,E)[c.index]=b,u(a,E)[b.index]=c,d={x:b.position.x,y:b.position.y},e=b.index,b.position=c.position,b.index=c.index,c.position=d,c.index=e,J(a,b),J(a,c),c}return null}
function ha(a,b,c){u(a,E)[b.index]=c;u(a,E)[c.index]=b;const d={x:b.position.x,y:b.position.y},e=b.index;b.position=c.position;b.index=c.index;c.position=d;c.index=e;J(a,b);J(a,c)}function N(a,b,c){return K(a,b.position.x+c.dx,b.position.y+c.dy)}function fa(a,b){return ea.oa.map(c=>N(a,b,c)).filter(c=>c!==null).filter(()=>!0)}
function O(a,b,c,d,e){for(let h=-d;h<=d;h++)for(let l=-d;l<=d;l++)if(!(h*h+l*l>d*d)){var f=b+h,g=c+l;if(f>=0&&f<a.width&&g>=0&&g<a.height){var m=K(a,f,g);if(e===0||m===null||m.id===0){m=a;var k=e;f>=0&&f<m.width&&g>=0&&g<m.height&&(k=y(m,G,H).call(m,k),k.position.x=f,k.position.y=g,k.index=g*m.width+f,J(m,k),u(m,E)[g*m.width+f]=k)}}}}
class ia{constructor(a,b,c){v(this,G);v(this,E);v(this,F);this.width=a;this.height=b;x(this,E,Array(a*b));x(this,F,new Set);this.ya=c;y(this,G,I).call(this,0)}get data(){return u(this,E)}get g(){return u(this,F)}}E=new WeakMap;F=new WeakMap;G=new WeakSet;
H=function(a){a=this.ya[a];if(!a)return null;var b=Math.round(Math.random()*5)/5;const c=B(a.Y),d=B(a.ba);b=new Uint8ClampedArray([c[0]+(d[0]-c[0])*b,c[1]+(d[1]-c[1])*b,c[2]+(d[2]-c[2])*b,c[3]+(d[3]-c[3])*b]);b={handle:-1,id:a.id,name:a.name,color:b,position:{x:-1,y:-1},index:0,T:a.T,H:a.H};return a.i===0?{...b,i:0}:a.i===1?{...b,i:1}:a.i===2?{...b,i:2,Pa:0,ka:a.ka}:a.i===3?{...b,i:3}:a.i===4?{...b,i:4,la:a.la,aa:a.aa}:a.i===5?{...b,i:5,node:-1}:null};
I=function(a){const b=this.width,c=this.height;x(this,E,Array(b*c));for(let d=0;d<c;d++)for(let e=0;e<b;e++){let f=d*b+e,g=y(this,G,H).call(this,a);g&&(g.position.x=e,g.position.y=d,g.index=f,u(this,E)[f]=g,u(this,F).add(g.index))}};var P,Q;function ja(a,b){a.C.clear();b=C(b);b.sort((c,d)=>c.position.y-d.position.y);for(const c of b)if(c&&!a.C.has(c.index))switch(c.i){case 2:ka(a,c);break;case 3:la(a,c);break;case 4:y(a,P,Q).call(a,c)}b=ma(a.B);na(a,b)}
function ka(a,b){const c=L(a.B,b,[[{dx:0,dy:-1}],[{dx:-1,dy:-1},{dx:1,dy:-1}],[{dx:-1,dy:0},{dx:1,dy:0}]],!1);c&&(a.C.add(b.index),a.C.add(c.index))}function la(a,b){const c=L(a.B,b,[[D[a.u[Math.floor(Math.random()*a.u.length)]]]],!1);c&&(a.C.add(b.index),a.C.add(c.index))}
function ma(a){const b=a.width;var c=a.height;const d=[],e=[],f={};for(--c;c>=0;c--)for(let l=0;l<b;l++){var g=c*b+l,m=K(a,l,c);if(!m||m.i!==2||m.i!==2)continue;const n=N(a,m,D.sa);var k=N(a,m,D.ra),h=n&&n.id===m.id;const r=k&&k.id===m.id;let p=-1;r&&(p=c*b+(l-1));let q=-1;h&&(q=(c+1)*b+l);k=n&&n.id===0;if(r||h)if(r&&!h)h=f[p],d[h].push(g),k&&(e[h].G.push(m),e[h].I.push(n)),f[g]=h;else if(!r&&h)h=f[q],d[h].push(g),k&&(e[h].G.push(m),e[h].I.push(n)),f[g]=h;else{if(h=f[q],d[h].push(g),k&&(e[h].G.push(m),
e[h].I.push(n)),f[g]=h,g=f[p],g!==h){m=e[g];for(const t of m.G)e[h].G.push(t);for(const t of m.I)e[h].I.push(t);m=d[g];for(const t of m)f[t]=h;d[g]=[];e[g]={G:[],I:[]}}}else h=e.length,d.push([g]),e.push({G:[],I:[]}),k&&(e[h].G.push(m),e[h].I.push(n)),f[g]=h}return e.filter(l=>l.G.length>30)}
function na(a,b){for(const c of b){b=c.G.sort((m,k)=>k.position.y-m.position.y);const d=c.I.sort((m,k)=>m.position.y-k.position.y),e=b.length;let f=0;const g=e/4;for(let m=0;m<e;m++){const k=b[m],h=d[m];if(Math.sqrt(k.position.x*h.position.x+k.position.y*h.position.y),k.position.y>h.position.y&&(ha(a.B,k,h),a.C.add(k.index),a.C.add(h.index),f++,f>=g))break}}}
class oa{constructor(a,b,c,d){v(this,P);this.m=!1;this.j=null;this.l=this.h=0;this.u=Object.keys(D);this.o=e=>{if(this.m){if(this.j){var f=e-this.j;this.j=e;this.g.D&&O(this.B,Math.floor(this.g.U),Math.floor(this.g.V),this.g.M,this.g.P);this.g.F&&O(this.B,Math.floor(this.g.U),Math.floor(this.g.V),this.g.M,0);this.h+=f;for(e=0;this.h>=this.K;){const n=[];for(var g of this.B.g)n.push(this.B.data[g]);this.l++;this.l>60&&(this.B.g.clear(),this.l=0);var m=new Uint8ClampedArray([210,55,55,180]);f=this.J;
var k=n;m=this.L.va?m:void 0;if(f.o.push(...k),m){const r=f.g.A,p=f.g.v;for(var h of k)f.m.push({index:(p-1-h.position.y)*r+h.position.x,value:m})}ja(this,n);this.h-=this.K;e++;e>60&&(this.h=0)}g=this.J;g.g.N&&(g.u=aa(g,Math.floor(g.g.U),Math.floor(g.g.V)));f=g.o;h=g.g.A;e=g.g.v;for(var l of f)f=(e-1-l.position.y)*h+l.position.x,k=l.color,g.j[f*4]=k[0],g.j[f*4+1]=k[1],g.j[f*4+2]=k[2],g.j[f*4+3]=k[3];l=new Uint8ClampedArray(g.j);z(l,g.m);z(l,g.u);l=new ImageData(l,g.g.A,g.g.v);g.l.putImageData(l,0,
0);g.o.length=0;g.m=[];g.u=[]}else this.j=e;requestAnimationFrame(this.o)}};this.g=a;this.J=b;this.L=c;this.B=new ia(this.g.A,this.g.v,d);this.C=new Set;this.W=this.g.W;this.K=this.g.K}start(){this.m||(this.m=!0,this.o(0))}}P=new WeakSet;Q=function(a){const b=L(this.B,a,a.aa,!0);b&&(this.C.add(a.index),this.C.add(b.index))};
function pa(a,b,c){a.g=document.createElement("div");a.g.classList.add("ui-window");a.g.style.left=`${c.x}px`;a.g.style.top=`${c.y}px`;a.g.style.width=`${a.size.width}px`;a.g.style.height=`${a.size.height}px`;a.g.style.maxWidth=`${a.ha.width}px`;a.g.style.maxHeight=`${a.ha.height}px`;a.g.style.zIndex=R.toString();a.u.appendChild(a.g);a.h=document.createElement("div");a.h.classList.add("ui-window__title-bar");c=document.createElement("span");c.classList.add("ui-window__title");c.textContent=b;a.h.appendChild(c);
a.g.appendChild(a.h);b=document.createElement("div");b.classList.add("ui-window__title-bar__button__wrapper");a.m=document.createElement("button");a.m.classList.add("ui-window__title-bar__button");c=document.createElement("img");c.src="./assets/icons/close.svg";a.m.appendChild(c);b.appendChild(a.m);a.h.appendChild(b);a.l=document.createElement("div");a.l.classList.add("ui-window__content__wrapper","left");a.g.appendChild(a.l);a.o=document.createElement("div");a.o.classList.add("ui-window__content-bar");
a.l.appendChild(a.o);a.S=document.createElement("div");a.S.classList.add("ui-window__content-container");a.l.appendChild(a.S);a=document.createElement("div");a.style.position="absolute";a.style.left="40px";a.style.borderRadius="0.6rem"}function qa(a,b){a.l.classList.remove("top","bottom","left","right");a.l.classList.add(b)}
function ra(a,b){const c=a.j[b];c&&(a.j.forEach(d=>{d.style.display="none"}),c.style.display="",a.R.forEach((d,e)=>{e===b?d.classList.add("active"):d.classList.remove("active")}))}
function S(a,b,c,d){let e=a.j.length;a.j.length!==0&&(b.style.display="none");b.id="container-"+e;a.S.appendChild(b);const f=document.createElement("button");f.classList.add("ui-window__content-bar__button");f.title=c;a.o.appendChild(f);const g=document.createElement("img");g.classList.add("ui-window__content-bar__button__icon");g.alt=c;g.src=d;f.appendChild(g);f.addEventListener("click",()=>ra(a,e));a.j.length>0&&(a.o.style.display="flex");a.R.push(f);a.j.push(b)}
function sa(a,b){const c=a.j;for(let d=0;d<c.length;d++){const e=c[d];if(e===b){a.j.forEach(f=>{f.style.display="none"});e.style.display="";a.R.forEach((f,g)=>{g===d?f.classList.add("active"):f.classList.remove("active")});break}}}function ta(a){const b=document.createElement("div");b.classList.add("ui-window__content-bar__separator");b.classList.add("is-spacer");a.o.appendChild(b)}
const ua=class{constructor(a,b,c,d,e){this.X=()=>{R++;this.g.style.zIndex=R.toString()};this.da=f=>{if(f.stopPropagation(),this.X(),f.button===0){this.h.setPointerCapture(f.pointerId);const g=this.g.getBoundingClientRect();this.L.x=f.clientX-g.left;this.L.y=f.clientY-g.top;this.J=!0}else this.J=!1};this.fa=f=>{this.J&&(this.h.releasePointerCapture(f.pointerId),this.J=!1)};this.ea=f=>{if(this.J){const g=this.u.getBoundingClientRect(),m=Math.max(0,Math.min(f.clientY-this.L.y-g.top,this.u.offsetHeight-
this.g.offsetHeight));this.g.style.left=`${Math.max(0,Math.min(f.clientX-this.L.x-g.left,this.u.offsetWidth-this.g.offsetWidth))}px`;this.g.style.top=`${m}px`}};this.pa=()=>{window.removeEventListener("resize",this.ga);this.h.removeEventListener("pointerdown",this.da);this.h.removeEventListener("pointermove",this.ea);this.h.removeEventListener("pointerup",this.fa);this.g.removeEventListener("mousedown",this.X);this.g&&this.g.parentElement&&this.g.parentElement.removeChild(this.g);this.g=null;this.h!=
null;this.m!=null;this.l!=null;this.o!=null;this.S!=null};this.ga=()=>{const f=this.g.offsetLeft,g=this.g.offsetTop,m=Math.max(0,Math.min(f,Math.max(0,this.u.offsetWidth-this.g.offsetWidth))),k=Math.max(0,Math.min(g,Math.max(0,this.u.offsetHeight-this.g.offsetHeight)));(m!==f||k!==g)&&(this.g.style.left=`${m}px`,this.g.style.top=`${k}px`)};this.qa=f=>{f.stopPropagation()};this.title=b;this.position=c;this.size=d;this.ha=e;this.R=[];this.j=[];this.u=a;pa(this,b,c);this.J=!1;this.L={x:0,y:0};this.g.addEventListener("mousedown",
this.X);this.h.addEventListener("pointerdown",this.da);this.h.addEventListener("pointermove",this.ea);this.h.addEventListener("pointerup",this.fa);this.m.addEventListener("click",this.pa);this.m.addEventListener("pointerdown",this.qa);window.addEventListener("resize",this.ga)}};var R=100;function T(a){const b=document.createElement("div");b.classList.add("ui-window__content__separator");b.style.height="1px";a.g.appendChild(b)}
function va(a,b){const c=document.createElement("h3");c.classList.add("ui-window__content__heading-title");c.textContent=b;a.g.appendChild(c)}function U(a,b){const c=document.createElement("h4");c.classList.add("ui-window__content__heading-section");c.textContent=b;a.g.appendChild(c)}
function V(a,b,c,d,e,f){const g=document.createElement("div");g.classList.add("ui-window__helper__flex-row");const m=document.createElement("label");m.textContent=b+":";g.appendChild(m);const k=document.createElement("input");k.type="range";k.min=c.toString();k.max=d.toString();k.value=e.toString();k.step=f.toString();g.appendChild(k);const h=document.createElement("input");h.style.minWidth="40px";h.type="number";h.min=c.toString();h.max=d.toString();h.value=e.toString();h.step=f.toString();g.appendChild(h);
k.oninput=()=>h.value=k.value;h.onchange=()=>{const l=Math.max(c,Math.min(d,parseInt(h.value))).toString();k.value=l;h.value=l};a.g.appendChild(g)}function W(a,b,c,d){const e=document.createElement("button");e.classList.add("ui-window__content__button");e.textContent=b;c!=null&&(e.id=c);d!=null&&(e.style.backgroundColor=d);a.g.appendChild(e)}
function X(a,b,c,d=0,e){const f=document.createElement("div");f.classList.add("ui-window__helper__flex-row");const g=document.createElement("label");g.textContent=b+":";f.appendChild(g);const m=document.createElement("div");m.classList.add("ui-window__content__dropdown-button__wrapper");f.appendChild(m);const k=document.createElement("div");k.classList.add("ui-window__content__dropdown-button");const h=document.createElement("span");h.textContent=c[0]?c[0]:"Template Item";e!=null&&(h.id=`${e}-display`);
k.appendChild(h);m.appendChild(k);const l=document.createElement("ul");l.classList.add("ui-window__content__dropdown-list");e!=null&&(l.id=`${e}-list`);m.appendChild(l);let n=Math.max(0,Math.min(d,c.length-1));const r=[];for(let p=0;p<c.length;p++){const q=c[p],t=document.createElement("li");t.style.marginBottom="0px";t.classList.add("ui-window__content__dropdown-item");t.textContent=q;t.dataset.index=p.toString();t.dataset.value=q.toLowerCase().replace(/\s/g,"-");p===n&&(t.classList.add("is-selected"),
h.textContent=q);t.addEventListener("click",w=>{w.stopPropagation();r[n].classList.remove("is-selected");n=p;t.classList.add("is-selected");h.textContent=q;l.classList.remove("is-open")});l.appendChild(t);r.push(t)}return k.addEventListener("click",p=>{if(p.stopPropagation(),l.classList.toggle("is-open")){l.parentElement;l.dataset.xa=m.id;document.body.appendChild(l);var q=k.getBoundingClientRect();p=l.getBoundingClientRect();p=l.scrollHeight||p.height;const w=document.documentElement.clientHeight;
l.style.position="absolute";l.style.left=`${q.left}px`;l.style.width=`${q.width}px`;l.style.zIndex="9999";var t=l.querySelector(".dropdown-item.is-selected");t?(t=t.offsetTop,q=q.top-t,q<0&&(q=0),q+p>w&&(q=Math.max(0,w-p)),l.style.top=`${Math.round(q)}px`,l.scrollTop=t):(q=q.bottom,q+p>w&&(q=Math.max(0,w-p)),l.style.top=`${Math.round(q)}px`,l.scrollTop=0)}else l.parentElement===document.body&&m.appendChild(l)}),a.g.appendChild(f),{button:k,items:r}}
function Y(a,b){const c=document.createElement("div");c.classList.add("ui-window__helper__flex-row");const d=document.createElement("label");d.textContent=b+":";c.appendChild(d);b=document.createElement("div");b.classList.add("ui-window__content__toggle-button__wrapper");c.appendChild(b);const e=document.createElement("div");e.classList.add("ui-window__content__toggle-button");e.dataset.state="off";b.appendChild(e);b=document.createElement("span");b.classList.add("ui-window__content__toggle-button__indicator",
"indicator-o");b.textContent="O";e.appendChild(b);b=document.createElement("span");b.classList.add("ui-window__content__toggle-button__indicator","indicator-i");b.textContent="I";e.appendChild(b);b=document.createElement("div");b.classList.add("ui-window__content__toggle-button__slider");e.appendChild(b);e.addEventListener("click",()=>{const f=e.classList.toggle("is-on");e.dataset.state=f?"on":"off"});a.g.appendChild(c)}
class Z{constructor(){this.g=document.createElement("div");this.g.classList.add("ui-window__content")}}
function wa(a,b){const c=new ua(a.h,"Particle Palette",{x:320,y:300},{width:250,height:200},{width:420,height:400});qa(c,"bottom");var d=document.createElement("div");d.classList.add("particle-palette-container");S(c,d,"Solids","./assets/icons/solid.svg");d=document.createElement("div");d.classList.add("particle-palette-container");S(c,d,"Liquids","./assets/icons/liquid.svg");var e=document.createElement("div");e.classList.add("particle-palette-container");S(c,e,"Gases","./assets/icons/gas.svg");
e=document.createElement("div");e.classList.add("particle-palette-container");S(c,e,"Sands","./assets/icons/sand.svg");e=document.createElement("div");e.classList.add("particle-palette-container");S(c,e,"Electronics","./assets/icons/electronics.svg");e=new Z;var {items:f}=X(e,"Orientation",["Top","Left","Right","Bottom"],3,"palette-orientation");f.forEach(m=>{m.addEventListener("click",()=>{const k=m.dataset.value;k&&qa(c,k)})});ta(c);S(c,e.g,"Settings","./assets/icons/settings.svg");sa(c,d);d=c.R;
const g=c.j;for(let m=0;m<d.length-1;m++)d[m].addEventListener("click",()=>{if(a.g.O!==m+1){for(var k of g){const h=k.querySelector(".selected");h&&h.classList.remove("selected")}if(k=g[m])(k=k.querySelector(".particle-button"))?(k.classList.add("selected"),a.g.P=parseInt(k.dataset.za||"0",10),a.g.O=parseInt(k.dataset.i||"0",10)):(a.g.P=0,a.g.O=0)}});d=!1;for(const m in b){const k=b[m];if(!k)continue;e=g[k.i-1];if(!e)continue;f=k.Y;const h=k.ba,l=ca(B(f))>210?"#323238":"#FFFFFFFF",n=B(l),r=document.createElement("button");
r.className="particle-button";r.textContent=k.name;r.style.setProperty("--particle-button-base-color",f);r.style.setProperty("--particle-button-variant-color",h);r.style.color=l;r.style.textShadow=`1px 1px 2px rgba(${n[0]}, ${n[1]}, ${n[2]}, 0.6)`;r.dataset.za=k.id.toString();r.dataset.i=k.i.toString();r.addEventListener("click",()=>{for(const p of g){const q=p.querySelector(".selected");q&&q.classList.remove("selected")}r.classList.add("selected");a.g.P=k.id;a.g.O=k.i});e.appendChild(r);!d&&k.i===
a.g.O&&(r.classList.add("selected"),a.g.P=k.id,d=!0)}}class xa{constructor(a,b){this.g=a;this.h=b;document.addEventListener("click",c=>{document.querySelectorAll(".ui-window__content__dropdown-list.is-open").forEach(d=>{var e=d.dataset.xa;e=e?document.getElementById(e):null;d.contains(c.target)||e?.contains(c.target)||(d.classList.remove("is-open"),e?.appendChild(d))})})}}
function ya(a){const b=(e,f)=>{const g=document.createElement("div");return g.classList.add("app-menu__dropdown"),g.style.display="none",f.forEach(m=>{const k=document.createElement("div");k.classList.add("app-menu__dropdown-item");k.textContent=m;g.appendChild(k)}),e.appendChild(g),g},c=(e,f)=>{e.addEventListener("click",g=>{g.stopPropagation();(g=document.querySelector(".app-menu__dropdown[style*='block']"))&&g!==f&&(g.style.display="none");f.style.display==="block"?(f.style.display="none",a.l=
!1):(f.style.display="block",a.l=!0)});e.addEventListener("mouseenter",()=>{if(a.l&&f.style.display!=="block"){const g=document.querySelector(".app-menu__dropdown[style*='block']");g&&g!==f&&(g.style.display="none");f.style.display="block"}})},d=(e,f)=>{e=document.getElementById(e);e instanceof HTMLDivElement&&(f=b(e,f),c(e,f))};d("bog-menu-item",["About bog engine","Settings","Quit"]);d("file-item",["Save","Load","New scene","Exit"]);d("edit-item",["Undo","Redo","Preferences"]);d("view-item",["Zoom In",
"Zoom Out","Reset View"]);d("help-item",["Documentation","Report Issue"])}
function za(a){const b=c=>{const d=a.h.getBoundingClientRect(),e=a.h.height-a.g.v/d.height*(c.clientY-d.top);a.g.U=a.g.A/d.width*(c.clientX-d.left);a.g.V=e};a.h.addEventListener("pointerdown",c=>{switch(b(c),c.button){case 0:a.g.D=!0;break;case 2:a.g.F=!0;break;default:a.g.D=!1,a.g.F=!1}try{a.h.setPointerCapture(c.pointerId)}catch{}a.j=c.pointerId});a.h.addEventListener("pointermove",c=>{b(c);typeof c.buttons=="number"&&(a.g.D=(c.buttons&1)===1,a.g.F=(c.buttons&2)===2)});a.h.addEventListener("pointerup",
c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("pointercancel",c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("lostpointercapture",c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("pointerenter",()=>{a.g.N=!0});a.h.addEventListener("pointerleave",()=>{a.g.N=!1});a.h.addEventListener("focus",
()=>{a.g.N=!0});a.h.addEventListener("blur",()=>{a.g.N=!1});a.h.addEventListener("wheel",c=>{c.preventDefault();a.g.M=Math.max(0,Math.min(Math.floor(a.g.M-c.deltaY*a.g.$),a.g.Z))},{passive:!1});window.addEventListener("pointerup",()=>{a.g.D=!1;a.g.F=!1;a.j=null});document.addEventListener("visibilitychange",()=>{document.hidden&&(a.g.D=!1,a.g.F=!1,a.j=null)})}
class Aa{constructor(a,b,c,d){this.j=null;this.l=!1;this.g=a;this.o=new xa(a,b);this.m=b;this.h=c;wa(this.o,d);ya(this);za(this);this.m.addEventListener("contextmenu",e=>{e.preventDefault()});document.addEventListener("click",e=>{this.l&&(e.target?.closest(".app-menu__menu-item")||(document.querySelectorAll(".app-menu__dropdown[style*='block']").forEach(f=>{f.style.display="none"}),this.l=!1))})}}
class Ba{constructor(a){this.frameCount=0;this.va=!1;this.g=new Map;var b=document.createElement("div");b.classList.add("debug-container");a.appendChild(b);this.g.set("debug-container",b);a=document.createElement("div");a.classList.add("debug-info-container");b.appendChild(a);this.g.set("info-container",a);b=document.createElement("div");b.classList.add("debug-info");a.appendChild(b);this.g.set("fps",b);b=document.createElement("div");b.classList.add("debug-info");a.appendChild(b);this.g.set("tps",
b)}}async function Ca(a){try{const b=await fetch(a);if(!b.ok)throw Error(`HTTP error! Status: ${b.status}`);return await b.text()}catch(b){throw console.error(`Failed to read particle data from ${a}:`,b),Error("Failed to load particle data.");}}
async function Da(){var a=await Ca("./src/data/particles.data");let b={};var c=new Set,d=null;for(var e of a.split("\n"))if(a=e.trim(),a.length!==0&&!a.startsWith("#"))if(a.startsWith("[")&&a.endsWith("]"))a=parseInt(a.slice(1,-1),10),isNaN(a)||a<10?d=null:c.has(a)?(console.warn(`[Loader] Duplicate ID found: ${a}. Ignoring.`),d=null):(c.add(a),d=a,b[a]={});else if(d!==null&&(a=a.split(":").map(f=>f.trim()),a.length===2)){const f=a[1],g=b[d];switch(a[0]){case "name":g.name=f;break;case "category":g.i=
parseInt(f,10);break;case "base_color":g.ia=f;break;case "variant_color":g.na=f;break;case "is_movable":g.ja=f==="true";break;case "density":g.H=parseFloat(f);break;case "max_concentration":g.wa=parseInt(f);break;case "repose_angle":g.ma=parseFloat(f)}}c={};for(const f in b)d=b[f],e=parseInt(f,10),d.name===void 0||d.i===void 0||d.ia===void 0||d.na===void 0||d.ja===void 0||d.H===void 0?console.warn(`[Loader] Corrupted particle block found of ID: ${e}. Missing core properties.`):(a={id:e,name:d.name,
Y:d.ia,ba:d.na,T:d.ja,H:d.H},d.i===1?c[e]={...a,i:1}:d.i===2?c[e]={...a,ka:d.wa,i:2}:d.i===3?c[e]={...a,i:3}:d.i===4?c[e]={...a,i:4,la:d.ma,aa:da(d.ma)}:d.i===5&&(c[e]={...a,i:5}));return c[0]={id:0,name:"Empty",i:0,Y:"#0E0E11",ba:"#0E0E11",T:!0,H:0},c}
async function Ea(){var a,b,c,d,e,f,g,m,k,h=(await Ca("./src/data/settings.data")).split(/\r?\n/);for(const r of h){var l=r.trim();if(l.length===0||l.startsWith("#"))continue;var n=l.indexOf(".");const p=l.indexOf(":");if(!(p===-1||n===-1||n>=p)&&(h=l.substring(0,n).trim(),n=l.substring(n+1,p).trim(),l=l.substring(p+1).trim(),h&&n&&l!==void 0&&l.length!==0))if(h==="engine")switch(n){case "width":h=parseInt(l);isNaN(h)||(a=h);break;case "height":h=parseInt(l);isNaN(h)||(b=h);break;case "render_interval":h=
parseFloat(l);isNaN(h)||(c=h);break;case "physics_interval":h=parseFloat(l),isNaN(h)||(d=h)}else if(h==="input")switch(n){case "brush_size":h=parseInt(l);isNaN(h)||(e=h);break;case "brush_max_size":h=parseInt(l);isNaN(h)||(f=h);break;case "brush_sensitivity":h=parseFloat(l),isNaN(h)||(g=h)}else if(h==="debug")switch(n){case "start_enabled":l.toLowerCase()==="true"?m=!0:l.toLowerCase()==="false"&&(m=!1);break;case "overlay_start_enabled":l.toLowerCase()==="true"?k=!0:l.toLowerCase()==="false"&&(k=
!1)}}return{A:a??342,v:b??192,W:c??16.667,K:d??25,ta:e??4,Z:f??42,$:g??.02,Qa:m??!1,Ra:k??!1}}class Fa{constructor(a){this.V=this.U=0;this.N=this.F=this.D=!1;this.A=a.A;this.v=a.v;this.Z=a.Z;this.$=a.$;this.P=0;this.O=2;this.W=a.W;this.K=a.K;this.M=a.ta}}function Ga(a,b){const c=document.getElementById(a);if(!(c instanceof b))throw Error(`Missing or invalid <${b.name.toLowerCase()} id='${a}'> element in DOM.`);return c}
(async function(){try{const a=Ga("viewport",HTMLDivElement),b=Ga("render-surface",HTMLCanvasElement),c=await Da();if(!c)throw Error('Failed to load particle data from "./src/data/particles.data"');const d=await Ea();if(!d)throw Error('Failed to load settings from "./src/data/settings.data"');const e=new Fa(d),f=new ba(e,b);new Aa(e,a,b,c);const g=new Ba(a);(new oa(e,f,g,c)).start();console.log(c);const m=new ua(a,"Demo Window",{x:80,y:80},{width:380,height:600},{width:800,height:1200}),k=new Z;va(k,
"Emitter Controls");const h=document.createElement("img");h.classList.add("ui-window__content__image");h.src="./assets/preview_image.jpg";h.alt="Windows XP Background Image";h.width=300;h.height=100;k.g.appendChild(h);const l=document.createElement("p");l.classList.add("ui-window__content__text");l.textContent="Server Status: Source code loaded.";l.style.color="#4cae50";k.g.appendChild(l);T(k);U(k,"Emitor Settings");V(k,"Emitor Size",0,38,14,1);V(k,"Opacity",0,1,.9,.01);Y(k,"Anti-aliasing");X(k,"GPU Render Mode",
["Fastest","High Quality","Wireframe","Debug"]);T(k);U(k,"Save & Load");W(k,"Save Emitor","save-emitor","#73a2e0ff");W(k,"Load Emitor","load-emitor","#84da62ff");W(k,"Delete Emitor","delete-emitor","#e04e4eff");S(m,k.g,"Emitor Controls","./assets/icons/electronics.svg");const n=new Z;va(n,"Application Settings");U(n,"Display");X(n,"Theme","Light;Dark;System Default;Cyan;party;Amogus;Sus;nerd;nerd2;nerd3".split(";"));V(n,"Brightness",0,100,75,1);Y(n,"Enable Animations");T(n);U(n,"Performance");X(n,
"Render Backend",["Auto","WebGPU","WebGL"]);Y(n,"Use Hardware Acceleration");V(n,"Max FPS",30,240,120,10);T(n);U(n,"System");W(n,"Reset Settings","reset-settings","#e04e4eff");W(n,"Check for Updates","check-updates");ta(m);S(m,n.g,"Settings","./assets/icons/settings.svg")}catch(a){console.error("ERROR: Failed to initialize app:",a)}})();
