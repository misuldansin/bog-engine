var r=(a,b)=>{if(!b.has(a))throw TypeError("Cannot read from private field");return b.get(a)},u=(a,b)=>{if(b.has(a))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(a):b.set(a,void 0)},w=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot write to private field");b.set(a,c)},x=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot access private method");return c};
(function(){function a(c){if(!c.ua){c.ua=!0;var d={};d=(c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d);fetch(c.href,d)}}const b=document.createElement("link").relList;if(!(b&&b.supports&&b.supports("modulepreload"))){for(const c of document.querySelectorAll('link[rel="modulepreload"]'))a(c);(new MutationObserver(c=>
{for(const d of c)if(d.type==="childList")for(const e of d.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&a(e)})).observe(document,{childList:!0,subtree:!0})}})();
function y(a,b,c){var d=a.g.N;const e=[],g=a.g.A,f=a.g.v,k=[-1,1];a=(n,m)=>{for(const p of k)for(const q of k){const t=b+n*q,v=c+m*p,G=b+m*q,H=c+n*p;t>=0&&t<g&&v>=0&&v<f&&e.push({index:(f-v)*g+t,value:new Uint8ClampedArray([227,227,227,180])});G>=0&&G<g&&H>=0&&H<f&&e.push({index:(f-H)*g+G,value:new Uint8ClampedArray([227,227,227,180])})}};let l=d,h=0;d-=d;for(a(l,h);h<l;)h++,d<0?d+=2*h+1:(l--,d+=2*(h-l)+1),a(l,h);return e}
function z(a,b){for(const {index:d,value:e}of b){var c=e[3];b=c/255;const g=Math.round(e[1]*b+a[d*4+1]*(1-b)),f=Math.round(e[2]*b+a[d*4+2]*(1-b));c=Math.min(a[d*4+3],c);a[d*4]=Math.round(e[0]*b+a[d*4]*(1-b));a[d*4+1]=g;a[d*4+2]=f;a[d*4+3]=c}}
class A{constructor(a,b){this.g=a;this.h=b;this.l=this.h.getContext("2d");this.j=new Uint8ClampedArray(this.g.A*this.g.v*4);this.o=[];this.m=[];this.u=[];this.h.style.aspectRatio=(this.g.A/this.g.v).toString();this.h.width=this.g.A;this.h.height=this.g.v;this.l.imageSmoothingEnabled=!1;this.l.translate(0,this.h.height);this.l.scale(1,-1)}}
const B=Object.freeze({Na:new Uint8ClampedArray([255,255,255,255]),ca:new Uint8ClampedArray([0,0,0,255]),Fa:new Uint8ClampedArray([128,128,128,255]),RED:new Uint8ClampedArray([255,0,0,255]),Ga:new Uint8ClampedArray([0,255,0,255]),Aa:new Uint8ClampedArray([0,0,255,255]),Oa:new Uint8ClampedArray([255,255,0,255]),Ba:new Uint8ClampedArray([0,255,255,255]),Ha:new Uint8ClampedArray([255,0,255,255]),Ka:new Uint8ClampedArray([0,0,0,0]),Ja:new Uint8ClampedArray([255,255,255,128])});
function C(a){if(a==null)return B.ca;a=a.replace("#","");if(a.length===6)a+="FF";else if(a.length===3){let c="";for(var b of a)c+=b,c+=b;a=c+"FF"}else return B.ca;b=parseInt(a,16);return new Uint8ClampedArray([b>>24&255,b>>16&255,b>>8&255,b&255])}function D(a){return.299*a[0]+.587*a[1]+.114*a[2]}function E(a){a=[...a];for(let b=a.length-1;b>0;b--){const c=Math.floor(Math.random()*(b+1));[a[b],a[c]]=[a[c],a[b]]}return a}
function F(a){var b=Math.max(10,Math.min(a,80));const c=b*Math.PI/180;a=[];(a.push([{dx:0,dy:-1}]),b<50)?(a.push([{dx:1,dy:-1},{dx:-1,dy:-1}]),b=Math.round(1/Math.tan(c)),a.push([{dx:b,dy:-1},{dx:b*-1,dy:-1}])):(b=Math.round(Math.tan(c)),a.push([{dx:1,dy:-b},{dx:-1,dy:-b}]));return a}
const aa=Object.freeze({oa:[{dx:-1,dy:1},{dx:0,dy:1},{dx:1,dy:1},{dx:-1,dy:0},{dx:1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}]}),I=Object.freeze({La:{dx:-1,dy:1},sa:{dx:0,dy:1},Ma:{dx:1,dy:1},ra:{dx:-1,dy:0},Ia:{dx:1,dy:0},Da:{dx:-1,dy:-1},Ca:{dx:0,dy:-1},Ea:{dx:1,dy:-1}});var J,K,L,M,N;function O(a,b){r(a,K).add(b.index);b=ba(a,b);for(const c of b)r(a,K).add(c.index)}function P(a,b,c){return b>=0&&b<a.width&&c>=0&&c<a.height?r(a,J)[c*a.width+b]:null}
function Q(a,b,c,d=!1){for(var e of c)if(e){c=E(e);for(const g of c)if(c=g.dx,d&&Math.random()>.5&&(c=g.dx*-1),(c=P(a,b.position.x+c,b.position.y+g.dy))&&c.T&&b.H>c.H)return r(a,J)[c.index]=b,r(a,J)[b.index]=c,d={x:b.position.x,y:b.position.y},e=b.index,b.position=c.position,b.index=c.index,c.position=d,c.index=e,O(a,b),O(a,c),c}return null}
function ca(a,b,c){r(a,J)[b.index]=c;r(a,J)[c.index]=b;const d={x:b.position.x,y:b.position.y},e=b.index;b.position=c.position;b.index=c.index;c.position=d;c.index=e;O(a,b);O(a,c)}function R(a,b,c){return P(a,b.position.x+c.dx,b.position.y+c.dy)}function ba(a,b){return aa.oa.map(c=>R(a,b,c)).filter(c=>c!==null).filter(()=>!0)}
function S(a,b,c,d,e){for(let h=-d;h<=d;h++)for(let n=-d;n<=d;n++)if(!(h*h+n*n>d*d)){var g=b+h,f=c+n;if(g>=0&&g<a.width&&f>=0&&f<a.height){var k=P(a,g,f);if(e===0||k===null||k.id===0){k=a;var l=e;g>=0&&g<k.width&&f>=0&&f<k.height&&(l=x(k,L,M).call(k,l),l.position.x=g,l.position.y=f,l.index=f*k.width+g,O(k,l),r(k,J)[f*k.width+g]=l)}}}}
class da{constructor(a,b,c){u(this,L);u(this,J);u(this,K);this.width=a;this.height=b;w(this,J,Array(a*b));w(this,K,new Set);this.ya=c;x(this,L,N).call(this,0)}get data(){return r(this,J)}get g(){return r(this,K)}}J=new WeakMap;K=new WeakMap;L=new WeakSet;
M=function(a){a=this.ya[a];if(!a)return null;var b=Math.round(Math.random()*5)/5;const c=C(a.Y),d=C(a.ba);b=new Uint8ClampedArray([c[0]+(d[0]-c[0])*b,c[1]+(d[1]-c[1])*b,c[2]+(d[2]-c[2])*b,c[3]+(d[3]-c[3])*b]);b={handle:-1,id:a.id,name:a.name,color:b,position:{x:-1,y:-1},index:0,T:a.T,H:a.H};return a.i===0?{...b,i:0}:a.i===1?{...b,i:1}:a.i===2?{...b,i:2,Pa:0,ka:a.ka}:a.i===3?{...b,i:3}:a.i===4?{...b,i:4,la:a.la,aa:a.aa}:a.i===5?{...b,i:5,node:-1}:null};
N=function(a){const b=this.width,c=this.height;w(this,J,Array(b*c));for(let d=0;d<c;d++)for(let e=0;e<b;e++){let g=d*b+e,f=x(this,L,M).call(this,a);f&&(f.position.x=e,f.position.y=d,f.index=g,r(this,J)[g]=f,r(this,K).add(f.index))}};var T,U;function ea(a,b){a.C.clear();b=E(b);b.sort((c,d)=>c.position.y-d.position.y);for(const c of b)if(c&&!a.C.has(c.index))switch(c.i){case 2:fa(a,c);break;case 3:ha(a,c);break;case 4:x(a,T,U).call(a,c)}b=ia(a.B);ja(a,b)}
function fa(a,b){const c=Q(a.B,b,[[{dx:0,dy:-1}],[{dx:-1,dy:-1},{dx:1,dy:-1}],[{dx:-1,dy:0},{dx:1,dy:0}]],!1);c&&(a.C.add(b.index),a.C.add(c.index))}function ha(a,b){const c=Q(a.B,b,[[I[a.L[Math.floor(Math.random()*a.L.length)]]]],!1);c&&(a.C.add(b.index),a.C.add(c.index))}
function ia(a){const b=a.width;var c=a.height;const d=[],e=[],g={};for(--c;c>=0;c--)for(let n=0;n<b;n++){var f=c*b+n,k=P(a,n,c);if(!k||k.i!==2||k.i!==2)continue;const m=R(a,k,I.sa);var l=R(a,k,I.ra),h=m&&m.id===k.id;const p=l&&l.id===k.id;let q=-1;p&&(q=c*b+(n-1));let t=-1;h&&(t=(c+1)*b+n);l=m&&m.id===0;if(p||h)if(p&&!h)h=g[q],d[h].push(f),l&&(e[h].G.push(k),e[h].I.push(m)),g[f]=h;else if(!p&&h)h=g[t],d[h].push(f),l&&(e[h].G.push(k),e[h].I.push(m)),g[f]=h;else{if(h=g[t],d[h].push(f),l&&(e[h].G.push(k),
e[h].I.push(m)),g[f]=h,f=g[q],f!==h){k=e[f];for(const v of k.G)e[h].G.push(v);for(const v of k.I)e[h].I.push(v);k=d[f];for(const v of k)g[v]=h;d[f]=[];e[f]={G:[],I:[]}}}else h=e.length,d.push([f]),e.push({G:[],I:[]}),l&&(e[h].G.push(k),e[h].I.push(m)),g[f]=h}return e.filter(n=>n.G.length>30)}
function ja(a,b){for(const c of b){b=c.G.sort((k,l)=>l.position.y-k.position.y);const d=c.I.sort((k,l)=>k.position.y-l.position.y),e=b.length;let g=0;const f=e/4;for(let k=0;k<e;k++){const l=b[k],h=d[k];if(Math.sqrt(l.position.x*h.position.x+l.position.y*h.position.y),l.position.y>h.position.y&&(ca(a.B,l,h),a.C.add(l.index),a.C.add(h.index),g++,g>=f))break}}}
class ka{constructor(a,b,c,d){u(this,T);this.m=!1;this.j=null;this.l=this.o=this.h=0;this.L=Object.keys(I);this.J=e=>{if(this.m){if(this.j){var g=e-this.j;this.j=e;this.g.D&&S(this.B,Math.floor(this.g.U),Math.floor(this.g.V),this.g.N,this.g.R);this.g.F&&S(this.B,Math.floor(this.g.U),Math.floor(this.g.V),this.g.N,0);this.h+=g;for(g=0;this.h>=this.M;){const p=[];for(var f of this.B.g)p.push(this.B.data[f]);this.l++;this.l>60&&(this.B.g.clear(),this.l=0);var k=new Uint8ClampedArray([210,55,55,180]),
l=this.K,h=p;k=this.u.va?k:void 0;if(l.o.push(...h),k){const q=l.g.A,t=l.g.v;for(var n of h)l.m.push({index:(t-1-n.position.y)*q+n.position.x,value:k})}ea(this,p);this.o++;this.h-=this.M;g++;g>60&&(this.h=0)}f=this.K;f.g.O&&(f.u=y(f,Math.floor(f.g.U),Math.floor(f.g.V)));l=f.o;n=f.g.A;g=f.g.v;for(var m of l)l=(g-1-m.position.y)*n+m.position.x,h=m.color,f.j[l*4]=h[0],f.j[l*4+1]=h[1],f.j[l*4+2]=h[2],f.j[l*4+3]=h[3];m=new Uint8ClampedArray(f.j);z(m,f.m);z(m,f.u);m=new ImageData(m,f.g.A,f.g.v);f.l.putImageData(m,
0,0);f.o.length=0;f.m=[];f.u=[];m=this.u;m.h&&(f=e-m.l,f>=1E3&&(m.j=m.frameCount*1E3/f,m.m=this.o*1E3/f,m.frameCount=0,this.o=0,m.l=e),m.frameCount++,(e=m.g.get("fps"))&&(e.textContent=`FPS: ${m.j.toFixed(0)}`),(e=m.g.get("tps"))&&(e.textContent=`TPS: ${m.m.toFixed(0)}`))}else this.j=e;requestAnimationFrame(this.J)}};this.g=a;this.K=b;this.u=c;this.B=new da(this.g.A,this.g.v,d);this.C=new Set;this.W=this.g.W;this.M=this.g.M}start(){this.m||(this.m=!0,this.J(0))}}T=new WeakSet;
U=function(a){const b=Q(this.B,a,a.aa,!0);b&&(this.C.add(a.index),this.C.add(b.index))};
function la(a,b){a.g=document.createElement("div");a.g.classList.add("ui-window");a.g.style.left=`${b.x}px`;a.g.style.top=`${b.y}px`;a.g.style.width=`${a.size.width}px`;a.g.style.height=`${a.size.height}px`;a.g.style.maxWidth=`${a.ha.width}px`;a.g.style.maxHeight=`${a.ha.height}px`;a.g.style.zIndex=V.toString();a.u.appendChild(a.g);a.h=document.createElement("div");a.h.classList.add("ui-window__title-bar");b=document.createElement("span");b.classList.add("ui-window__title");b.textContent="Particle Palette";
a.h.appendChild(b);a.g.appendChild(a.h);b=document.createElement("div");b.classList.add("ui-window__title-bar__button__wrapper");a.m=document.createElement("button");a.m.classList.add("ui-window__title-bar__button");const c=document.createElement("img");c.src="./assets/icons/close.svg";a.m.appendChild(c);b.appendChild(a.m);a.h.appendChild(b);a.l=document.createElement("div");a.l.classList.add("ui-window__content__wrapper","left");a.g.appendChild(a.l);a.o=document.createElement("div");a.o.classList.add("ui-window__content-bar");
a.l.appendChild(a.o);a.S=document.createElement("div");a.S.classList.add("ui-window__content-container");a.l.appendChild(a.S);a=document.createElement("div");a.style.position="absolute";a.style.left="40px";a.style.borderRadius="0.6rem"}function W(a,b){a.l.classList.remove("top","bottom","left","right");a.l.classList.add(b)}
function ma(a,b){const c=a.j[b];c&&(a.j.forEach(d=>{d.style.display="none"}),c.style.display="",a.K.forEach((d,e)=>{e===b?d.classList.add("active"):d.classList.remove("active")}))}
function X(a,b,c,d){let e=a.j.length;a.j.length!==0&&(b.style.display="none");b.id="container-"+e;a.S.appendChild(b);const g=document.createElement("button");g.classList.add("ui-window__content-bar__button");g.title=c;a.o.appendChild(g);const f=document.createElement("img");f.classList.add("ui-window__content-bar__button__icon");f.alt=c;f.src=d;g.appendChild(f);g.addEventListener("click",()=>ma(a,e));a.j.length>0&&(a.o.style.display="flex");a.K.push(g);a.j.push(b)}
function na(a,b){const c=a.j;for(let d=0;d<c.length;d++){const e=c[d];if(e===b){a.j.forEach(g=>{g.style.display="none"});e.style.display="";a.K.forEach((g,f)=>{f===d?g.classList.add("active"):g.classList.remove("active")});break}}}function oa(a){const b=document.createElement("div");b.classList.add("ui-window__content-bar__separator");b.classList.add("is-spacer");a.o.appendChild(b)}
const pa=class{constructor(a){var b={x:320,y:300};this.X=()=>{V++;this.g.style.zIndex=V.toString()};this.da=c=>{if(c.stopPropagation(),this.X(),c.button===0){this.h.setPointerCapture(c.pointerId);const d=this.g.getBoundingClientRect();this.L.x=c.clientX-d.left;this.L.y=c.clientY-d.top;this.J=!0}else this.J=!1};this.fa=c=>{this.J&&(this.h.releasePointerCapture(c.pointerId),this.J=!1)};this.ea=c=>{if(this.J){const d=this.u.getBoundingClientRect(),e=Math.max(0,Math.min(c.clientY-this.L.y-d.top,this.u.offsetHeight-
this.g.offsetHeight));this.g.style.left=`${Math.max(0,Math.min(c.clientX-this.L.x-d.left,this.u.offsetWidth-this.g.offsetWidth))}px`;this.g.style.top=`${e}px`}};this.pa=()=>{window.removeEventListener("resize",this.ga);this.h.removeEventListener("pointerdown",this.da);this.h.removeEventListener("pointermove",this.ea);this.h.removeEventListener("pointerup",this.fa);this.g.removeEventListener("mousedown",this.X);this.g&&this.g.parentElement&&this.g.parentElement.removeChild(this.g);this.g=null;this.h!=
null;this.m!=null;this.l!=null;this.o!=null;this.S!=null};this.ga=()=>{const c=this.g.offsetLeft,d=this.g.offsetTop,e=Math.max(0,Math.min(c,Math.max(0,this.u.offsetWidth-this.g.offsetWidth))),g=Math.max(0,Math.min(d,Math.max(0,this.u.offsetHeight-this.g.offsetHeight)));(e!==c||g!==d)&&(this.g.style.left=`${e}px`,this.g.style.top=`${g}px`)};this.qa=c=>{c.stopPropagation()};this.title="Particle Palette";this.position=b;this.size={width:250,height:200};this.ha={width:420,height:400};this.K=[];this.j=
[];this.u=a;la(this,b);this.J=!1;this.L={x:0,y:0};this.g.addEventListener("mousedown",this.X);this.h.addEventListener("pointerdown",this.da);this.h.addEventListener("pointermove",this.ea);this.h.addEventListener("pointerup",this.fa);this.m.addEventListener("click",this.pa);this.m.addEventListener("pointerdown",this.qa);window.addEventListener("resize",this.ga)}};var V=100;
function qa(a){var b=["Top","Left","Right","Bottom"];const c=document.createElement("div");c.classList.add("ui-window__helper__flex-row");const d=document.createElement("label");d.textContent="Orientation:";c.appendChild(d);const e=document.createElement("div");e.classList.add("ui-window__content__dropdown-button__wrapper");c.appendChild(e);const g=document.createElement("div");g.classList.add("ui-window__content__dropdown-button");const f=document.createElement("span");f.textContent=b[0]?b[0]:"Template Item";
f.id="palette-orientation-display";g.appendChild(f);e.appendChild(g);const k=document.createElement("ul");k.classList.add("ui-window__content__dropdown-list");k.id="palette-orientation-list";e.appendChild(k);let l=Math.max(0,Math.min(3,b.length-1));const h=[];for(let n=0;n<b.length;n++){const m=b[n],p=document.createElement("li");p.style.marginBottom="0px";p.classList.add("ui-window__content__dropdown-item");p.textContent=m;p.dataset.index=n.toString();p.dataset.value=m.toLowerCase().replace(/\s/g,
"-");n===l&&(p.classList.add("is-selected"),f.textContent=m);p.addEventListener("click",q=>{q.stopPropagation();h[l].classList.remove("is-selected");l=n;p.classList.add("is-selected");f.textContent=m;k.classList.remove("is-open")});k.appendChild(p);h.push(p)}return g.addEventListener("click",n=>{if(n.stopPropagation(),k.classList.toggle("is-open")){k.parentElement;k.dataset.xa=e.id;document.body.appendChild(k);var m=g.getBoundingClientRect();n=k.getBoundingClientRect();n=k.scrollHeight||n.height;
const q=document.documentElement.clientHeight;k.style.position="absolute";k.style.left=`${m.left}px`;k.style.width=`${m.width}px`;k.style.zIndex="9999";var p=k.querySelector(".dropdown-item.is-selected");p?(p=p.offsetTop,m=m.top-p,m<0&&(m=0),m+n>q&&(m=Math.max(0,q-n)),k.style.top=`${Math.round(m)}px`,k.scrollTop=p):(m=m.bottom,m+n>q&&(m=Math.max(0,q-n)),k.style.top=`${Math.round(m)}px`,k.scrollTop=0)}else k.parentElement===document.body&&e.appendChild(k)}),a.g.appendChild(c),{button:g,items:h}}
class ra{constructor(){this.g=document.createElement("div");this.g.classList.add("ui-window__content")}}
function sa(a,b){const c=new pa(a.h);W(c,"bottom");var d=document.createElement("div");d.classList.add("particle-palette-container");X(c,d,"Solids","./assets/icons/solid.svg");d=document.createElement("div");d.classList.add("particle-palette-container");X(c,d,"Liquids","./assets/icons/liquid.svg");var e=document.createElement("div");e.classList.add("particle-palette-container");X(c,e,"Gases","./assets/icons/gas.svg");e=document.createElement("div");e.classList.add("particle-palette-container");X(c,
e,"Sands","./assets/icons/sand.svg");e=document.createElement("div");e.classList.add("particle-palette-container");X(c,e,"Electronics","./assets/icons/electronics.svg");e=new ra;var {items:g}=qa(e);g.forEach(k=>{k.addEventListener("click",()=>{const l=k.dataset.value;l&&W(c,l)})});oa(c);X(c,e.g,"Settings","./assets/icons/settings.svg");na(c,d);d=c.K;const f=c.j;for(let k=0;k<d.length-1;k++)d[k].addEventListener("click",()=>{if(a.g.P!==k+1){for(var l of f){const h=l.querySelector(".selected");h&&h.classList.remove("selected")}if(l=
f[k])(l=l.querySelector(".particle-button"))?(l.classList.add("selected"),a.g.R=parseInt(l.dataset.za||"0",10),a.g.P=parseInt(l.dataset.i||"0",10)):(a.g.R=0,a.g.P=0)}});d=!1;for(const k in b){const l=b[k];if(!l)continue;e=f[l.i-1];if(!e)continue;g=l.Y;const h=l.ba,n=D(C(g))>210?"#323238":"#FFFFFFFF",m=C(n),p=document.createElement("button");p.className="particle-button";p.textContent=l.name;p.style.setProperty("--particle-button-base-color",g);p.style.setProperty("--particle-button-variant-color",
h);p.style.color=n;p.style.textShadow=`1px 1px 2px rgba(${m[0]}, ${m[1]}, ${m[2]}, 0.6)`;p.dataset.za=l.id.toString();p.dataset.i=l.i.toString();p.addEventListener("click",()=>{for(const q of f){const t=q.querySelector(".selected");t&&t.classList.remove("selected")}p.classList.add("selected");a.g.R=l.id;a.g.P=l.i});e.appendChild(p);!d&&l.i===a.g.P&&(p.classList.add("selected"),a.g.R=l.id,d=!0)}}
class ta{constructor(a,b){this.g=a;this.h=b;document.addEventListener("click",c=>{document.querySelectorAll(".ui-window__content__dropdown-list.is-open").forEach(d=>{var e=d.dataset.xa;e=e?document.getElementById(e):null;d.contains(c.target)||e?.contains(c.target)||(d.classList.remove("is-open"),e?.appendChild(d))})})}}
function ua(a){const b=(e,g)=>{const f=document.createElement("div");return f.classList.add("app-menu__dropdown"),f.style.display="none",g.forEach(k=>{const l=document.createElement("div");l.classList.add("app-menu__dropdown-item");k!=="About"&&k!=="Report Issue"&&l.classList.add("is-disabled");l.textContent=k;f.appendChild(l)}),e.appendChild(f),f},c=(e,g)=>{e.addEventListener("click",f=>{f.stopPropagation();(f=document.querySelector(".app-menu__dropdown[style*='block']"))&&f!==g&&(f.style.display=
"none");g.style.display==="block"?(g.style.display="none",a.l=!1):(g.style.display="block",a.l=!0)});e.addEventListener("mouseenter",()=>{if(a.l&&g.style.display!=="block"){const f=document.querySelector(".app-menu__dropdown[style*='block']");f&&f!==g&&(f.style.display="none");g.style.display="block"}})},d=(e,g)=>{const f=document.getElementById(e);if(f instanceof HTMLDivElement){const k=b(f,g);c(f,k);e==="help-item"&&k.querySelectorAll(".app-menu__dropdown-item").forEach(l=>{const h=l.textContent;
l.addEventListener("click",n=>{n.stopPropagation();k.style.display="none";a.l=!1;h==="About"?window.open("https://github.com/misuldansin/bog-engine/","_blank"):h==="Report Issue"&&window.open("https://github.com/misuldansin/bog-engine/issues/new","_blank")})})}};d("bog-menu-item",["Settings","Quit"]);d("file-item",["Save","Load","Exit"]);d("edit-item",["Preferences","Undo","Redo"]);d("view-item",["Reset View"]);d("help-item",["About","Report Issue"])}
function va(a){const b=c=>{const d=a.h.getBoundingClientRect(),e=a.h.height-a.g.v/d.height*(c.clientY-d.top);a.g.U=a.g.A/d.width*(c.clientX-d.left);a.g.V=e};a.h.addEventListener("pointerdown",c=>{switch(b(c),c.button){case 0:a.g.D=!0;break;case 2:a.g.F=!0;break;default:a.g.D=!1,a.g.F=!1}try{a.h.setPointerCapture(c.pointerId)}catch{}a.j=c.pointerId});a.h.addEventListener("pointermove",c=>{b(c);typeof c.buttons=="number"&&(a.g.D=(c.buttons&1)===1,a.g.F=(c.buttons&2)===2)});a.h.addEventListener("pointerup",
c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("pointercancel",c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("lostpointercapture",c=>{if(a.j===c.pointerId){try{a.h.releasePointerCapture(c.pointerId)}catch{}a.j=null}a.g.D=!1;a.g.F=!1});a.h.addEventListener("pointerenter",()=>{a.g.O=!0});a.h.addEventListener("pointerleave",()=>{a.g.O=!1});a.h.addEventListener("focus",
()=>{a.g.O=!0});a.h.addEventListener("blur",()=>{a.g.O=!1});a.h.addEventListener("wheel",c=>{c.preventDefault();a.g.N=Math.max(0,Math.min(Math.floor(a.g.N-c.deltaY*a.g.$),a.g.Z))},{passive:!1});window.addEventListener("pointerup",()=>{a.g.D=!1;a.g.F=!1;a.j=null});document.addEventListener("visibilitychange",()=>{document.hidden&&(a.g.D=!1,a.g.F=!1,a.j=null)})}
class wa{constructor(a,b,c,d){this.j=null;this.l=!1;this.g=a;this.o=new ta(a,b);this.m=b;this.h=c;sa(this.o,d);ua(this);va(this);this.m.addEventListener("contextmenu",e=>{e.preventDefault()});document.addEventListener("click",e=>{this.l&&(e.target?.closest(".app-menu__menu-item")||(document.querySelectorAll(".app-menu__dropdown[style*='block']").forEach(g=>{g.style.display="none"}),this.l=!1))})}}
class xa{constructor(a){this.l=this.m=this.j=this.frameCount=0;this.va=this.h=!1;this.g=new Map;var b=document.createElement("div");b.classList.add("debug-container");a.appendChild(b);this.g.set("debug-container",b);a=document.createElement("div");a.classList.add("debug-info-container");b.appendChild(a);this.g.set("info-container",a);b=document.createElement("div");b.classList.add("debug-info");a.appendChild(b);this.g.set("fps",b);b=document.createElement("div");b.classList.add("debug-info");a.appendChild(b);
this.g.set("tps",b)}}async function Y(a){try{const b=await fetch(a);if(!b.ok)throw Error(`HTTP error! Status: ${b.status}`);return await b.text()}catch(b){throw console.error(`Failed to read particle data from ${a}:`,b),Error("Failed to load particle data.");}}
async function ya(){var a=await Y("./src/data/particles.data");let b={};var c=new Set,d=null;for(var e of a.split("\n"))if(a=e.trim(),a.length!==0&&!a.startsWith("#"))if(a.startsWith("[")&&a.endsWith("]"))a=parseInt(a.slice(1,-1),10),isNaN(a)||a<10?d=null:c.has(a)?(console.warn(`[Loader] Duplicate ID found: ${a}. Ignoring.`),d=null):(c.add(a),d=a,b[a]={});else if(d!==null&&(a=a.split(":").map(g=>g.trim()),a.length===2)){const g=a[1],f=b[d];switch(a[0]){case "name":f.name=g;break;case "category":f.i=
parseInt(g,10);break;case "base_color":f.ia=g;break;case "variant_color":f.na=g;break;case "is_movable":f.ja=g==="true";break;case "density":f.H=parseFloat(g);break;case "max_concentration":f.wa=parseInt(g);break;case "repose_angle":f.ma=parseFloat(g)}}c={};for(const g in b)d=b[g],e=parseInt(g,10),d.name===void 0||d.i===void 0||d.ia===void 0||d.na===void 0||d.ja===void 0||d.H===void 0?console.warn(`[Loader] Corrupted particle block found of ID: ${e}. Missing core properties.`):(a={id:e,name:d.name,
Y:d.ia,ba:d.na,T:d.ja,H:d.H},d.i===1?c[e]={...a,i:1}:d.i===2?c[e]={...a,ka:d.wa,i:2}:d.i===3?c[e]={...a,i:3}:d.i===4?c[e]={...a,i:4,la:d.ma,aa:F(d.ma)}:d.i===5&&(c[e]={...a,i:5}));return c[0]={id:0,name:"Empty",i:0,Y:"#0E0E11",ba:"#0E0E11",T:!0,H:0},c}
async function za(){var a,b,c,d,e,g,f,k,l,h=(await Y("./src/data/settings.data")).split(/\r?\n/);for(const p of h){var n=p.trim();if(n.length===0||n.startsWith("#"))continue;var m=n.indexOf(".");const q=n.indexOf(":");if(!(q===-1||m===-1||m>=q)&&(h=n.substring(0,m).trim(),m=n.substring(m+1,q).trim(),n=n.substring(q+1).trim(),h&&m&&n!==void 0&&n.length!==0))if(h==="engine")switch(m){case "width":h=parseInt(n);isNaN(h)||(a=h);break;case "height":h=parseInt(n);isNaN(h)||(b=h);break;case "render_interval":h=
parseFloat(n);isNaN(h)||(c=h);break;case "physics_interval":h=parseFloat(n),isNaN(h)||(d=h)}else if(h==="input")switch(m){case "brush_size":h=parseInt(n);isNaN(h)||(e=h);break;case "brush_max_size":h=parseInt(n);isNaN(h)||(g=h);break;case "brush_sensitivity":h=parseFloat(n),isNaN(h)||(f=h)}else if(h==="debug")switch(m){case "start_enabled":n.toLowerCase()==="true"?k=!0:n.toLowerCase()==="false"&&(k=!1);break;case "overlay_start_enabled":n.toLowerCase()==="true"?l=!0:n.toLowerCase()==="false"&&(l=
!1)}}return{A:a??342,v:b??192,W:c??16.667,M:d??25,ta:e??4,Z:g??42,$:f??.02,Qa:k??!1,Ra:l??!1}}class Aa{constructor(a){this.V=this.U=0;this.O=this.F=this.D=!1;this.A=a.A;this.v=a.v;this.Z=a.Z;this.$=a.$;this.R=0;this.P=2;this.W=a.W;this.M=a.M;this.N=a.ta}}function Z(a,b){const c=document.getElementById(a);if(!(c instanceof b))throw Error(`Missing or invalid <${b.name.toLowerCase()} id='${a}'> element in DOM.`);return c}
(async function(){try{const a=Z("viewport",HTMLDivElement),b=Z("render-surface",HTMLCanvasElement),c=await ya();if(!c)throw Error('Failed to load particle data from "./src/data/particles.data"');const d=await za();if(!d)throw Error('Failed to load settings from "./src/data/settings.data"');const e=new Aa(d),g=new A(e,b);new wa(e,a,b,c);const f=new xa(a);f.h=!0;(new ka(e,g,f,c)).start()}catch(a){console.error("ERROR: Failed to initialize app:",a)}})();
